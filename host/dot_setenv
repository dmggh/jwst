#-*-sh-*-

# WARNING
# WARNING  this script *instance* is a common shared element across all CRDS servers.
# WARNING  screwing up this one file can potentially take down all 6 servers since
# WARNING  ${HOME} is shared.
# WARNING

limit stacksize 64000k
# limit memorylocked 512k

setenv  CRDS_SERVER `uname -n | cut -d'.' -f1`

# CRDS and CRDS_STACK,  same pattern,  different dirs,  override below as needed
setenv CRDS /crds/data1/${CRDS_SERVER}
setenv XDG_CONFIG_HOME $CRDS/xdg_config
mkdir -p $XDG_CONFIG_HOME/astropy

setenv URP_TYPE crds

switch ($CRDS_SERVER)
       case dljwstcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda3-6
        setenv CRDS_PROJECT jwst
        setenv CRDS_USECASE dev
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu"
       breaksw
       case dlhstcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda3-6
        setenv CRDS_PROJECT hst
        setenv CRDS_USECASE dev
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu"
       breaksw

       case tljwstcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda3-6
        setenv CRDS_PROJECT jwst
        setenv CRDS_USECASE test
        # setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu"
       breaksw
       case tlhstcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda3-6
        setenv CRDS_PROJECT hst
        setenv CRDS_USECASE test
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
       breaksw

       case pljwstcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda3-6
        setenv CRDS_PROJECT jwst
        setenv CRDS_USECASE ops
        # setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu"
        setenv CRDS_GRP_CACHE_KEY 3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       breaksw

       case plhstcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda-3
        setenv CRDS_PROJECT hst
        setenv CRDS_USECASE ops
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
        setenv CRDS_PIPELINE_CACHE_KEY 12ca7bb2-dd3b-444a-8e6e-d8fd0bf559ed
        setenv CRDS_GRP_CACHE_KEY 78b96cd6-4295-4215-89ff-a588b2ea831a
       breaksw

       case iljwdmsacrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda
        setenv CRDS_PROJECT jwst
        setenv CRDS_USECASE b7it
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        setenv CRDS_GRP_CACHE_KEY 3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       breaksw

       case iljwdmsbcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda3-6
        setenv CRDS_PROJECT jwst
        setenv CRDS_USECASE bit
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        setenv CRDS_GRP_CACHE_KEY 3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       breaksw

       case iljwdmsccrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda
        setenv CRDS_PROJECT jwst
        setenv CRDS_USECASE b6it
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        setenv CRDS_GRP_CACHE_KEY 3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       breaksw

       case iljwdmsdcrdsv1:
        setenv CRDS_STACK ${CRDS}/crds_stacks/crds_conda-2
        setenv CRDS_PROJECT jwst
        setenv CRDS_USECASE dit
        setenv CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        setenv CRDS_GRP_CACHE_KEY 3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       breaksw
endsw

setenv META_PREFIX ${CRDS_STACK}

setenv CRDS_IFS /ifs/crds/${CRDS_PROJECT}/${CRDS_USECASE}
setenv CRDS_FILE_CACHE ${CRDS_IFS}/file_cache
setenv CRDS_SERVER_FILES ${CRDS_IFS}/server_files
setenv CRDS_CRON {$CRDS}/server/logs/cron
setenv CRDS_LOG_TIME 1
setenv CRDS_USE_PICKLED_CONTEXTS 1

# Enabling both of the below permits non-compliant keyword values (according to 
# SSB JWST data model schema) to be certied with a warning and added to rmaps.

# SSB JWST data model setting to avoid omitting keywords with invalid schema values.
# The default behavior is that the keyword is entirely suppressed and appears to be missing.
setenv PASS_INVALID_VALUES 1

# CRDS setting to keep SSB JWST data model warnings from being re-mapped to errors.
# setenv CRDS_ALLOW_SCHEMA_VIOLATIONS 1

setenv PATH ${CRDS}/python/bin:${CRDS}/CRDS_server/host:${CRDS_STACK}/bin:/usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin
# /usr/stsci/Python-2.7.4/bin:

setenv LD_LIBRARY_PATH ${CRDS_STACK}/lib # :/usr/stsci/Python-2.7.4/lib

if ! $?PYTHONPATH then
    setenv PYTHONPATH ${CRDS_STACK}/lib/python
else
    setenv PYTHONPATH ${PYTHONPATH}:${CRDS_STACK}/lib/python    
endif

setenv apachemod ${CRDS_STACK}/lib/apache/

setenv EDITOR emacs

# printenv | grep CRDS

