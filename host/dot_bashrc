#-*-sh-*-

# ulimit -s 64000k
# limit memorylocked 512k

export CRDS_SERVER=`uname -n | cut -d'.' -f1`

# CRDS and CRDS_STACK,  same pattern,  different dirs,  override below as needed
export CRDS=/crds/data1/${CRDS_SERVER}
export XDG_CONFIG_HOME=$CRDS/xdg_config

mkdir -p $XDG_CONFIG_HOME/astropy

export URP_TYPE=crds

case $CRDS_SERVER in 
      dljwstcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda3-6
        export CRDS_PROJECT=jwst
        export CRDS_USECASE=dev
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu"
       ;;
      dlhstcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda3-6
        export CRDS_PROJECT=hst
        export CRDS_USECASE=dev
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu"
       ;;

      tljwstcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda3-6
        export CRDS_PROJECT=jwst
        export CRDS_USECASE=test
        # export CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu"
       ;;
      tlhstcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda3-6
        export CRDS_PROJECT=hst
        export CRDS_USECASE=test
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
       ;;

      pljwstcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda3-6
        export CRDS_PROJECT=jwst
        export CRDS_USECASE=ops
        # export CRDS_AFFECTED_DATASETS_RECIPIENTS "jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu"
        export CRDS_GRP_CACHE_KEY=3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       ;;

      plhstcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda-3
        export CRDS_PROJECT=hst
        export CRDS_USECASE=ops
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu   crds_datamng@stsci.edu"
        export CRDS_PIPELINE_CACHE_KEY=12ca7bb2-dd3b-444a-8e6e-d8fd0bf559ed
        export CRDS_GRP_CACHE_KEY=78b96cd6-4295-4215-89ff-a588b2ea831a
       ;;

      iljwdmsacrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda
        export CRDS_PROJECT=jwst
        export CRDS_USECASE=b7it
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        export CRDS_GRP_CACHE_KEY=3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       ;;

      iljwdmsbcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda3-6
        export CRDS_PROJECT=jwst
        export CRDS_USECASE=bit
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        export CRDS_GRP_CACHE_KEY=3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       ;;

      iljwdmsccrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda
        export CRDS_PROJECT=jwst
        export CRDS_USECASE=b6it
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        export CRDS_GRP_CACHE_KEY=3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       ;;

      iljwdmsdcrdsv1)
        export CRDS_STACK=${CRDS}/crds_stacks/crds_conda-2
        export CRDS_PROJECT=jwst
        export CRDS_USECASE=dit
        export CRDS_AFFECTED_DATASETS_RECIPIENTS="jmiller@stsci.edu  crds_${CRDS_PROJECT}_${CRDS_USECASE}_reprocessing@maillist.stsci.edu"
        export CRDS_GRP_CACHE_KEY=3d15844c-62a0-4a00-bedc-fafdb34f4a2c
       ;;
esac

export META_PREFIX=${CRDS_STACK}

export CRDS_IFS=/ifs/crds/${CRDS_PROJECT}/${CRDS_USECASE}
export CRDS_FILE_CACHE=${CRDS_IFS}/file_cache
export CRDS_SERVER_FILES=${CRDS_IFS}/server_files
export CRDS_CRON={$CRDS}/server/logs/cron
export CRDS_LOG_TIME=1
export CRDS_USE_PICKLED_CONTEXTS=1

# Enabling both of the below permits non-compliant keyword values (according to 
# SSB JWST data model schema) to be certied with a warning and added to rmaps.

# SSB JWST data model setting to avoid omitting keywords with invalid schema values.
# The default behavior is that the keyword is entirely suppressed and appears to be missing.
export PASS_INVALID_VALUES=1

# CRDS setting to keep SSB JWST data model warnings from being re-mapped to errors.
# export CRDS_ALLOW_SCHEMA_VIOLATIONS 1

export PATH=${CRDS}/python/bin:${CRDS}/CRDS_server/host:${CRDS_STACK}/bin:/usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin
# /usr/stsci/Python-2.7.4/bin:

export LD_LIBRARY_PATH=${CRDS_STACK}/lib # :/usr/stsci/Python-2.7.4/lib

# if ! $?PYTHONPATH then
#     export PYTHONPATH=${CRDS_STACK}/lib/python
# else
#     export PYTHONPATH=${PYTHONPATH}:${CRDS_STACK}/lib/python    
# endif

export apachemod=${CRDS_STACK}/lib/apache/

export EDITOR=emacs

#######################################################################
#
# create new files with  read-only    permission for group/world
#        new directories read-execute permission for group/world
umask 022

#  Source code areas
alias crdsd="cd ${CRDS}/CRDS"
alias server="cd ${CRDS}/CRDS_server"
alias stack="cd /eng/ssb/crds/installer4/build"
alias installer="cd ${CRDS}/crds_stacks/installer4/build"

# Server maintenance areas
alias logs="cd ${CRDS}/server/logs"
alias backups="cd ${CRDS}/server/db_backups"

# CRDS code area
alias libpython="cd ${CRDS}/python/lib/python"

# Server working data files areas
alias deliveries="cd ${CRDS_SERVER_FILES}/deliveries"
alias catalogs="cd ${CRDS_SERVER_FILES}/catalogs"
alias ingest="cd ${CRDS_SERVER_FILES}/ingest"
alias file_cache="cd ${CRDS_FILE_CACHE}"

# Isilon and VM file systems
alias ifs="cd ${CRDS_IFS}"
alias data1="cd ${CRDS}"

