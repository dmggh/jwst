#! /usr/bin/env pysh
#-*-python-*-
# Command to switch Apache ports to hide server during system backup restores.

import sys

usage("set_backup_url <flag>", 1, 1)

is_backup = (sys.argv[1].upper() in ["1","T","TRUE"])

# It's important to signal "OFFLINE" before the server is offline
print("="*80, file=sys.stderr)
if is_backup:
    print("Switching to backup port, server offline.", file=sys.stderr)
    open("/home/crds/CRDS_SERVER_OFFLINE","w+").write("The server is on the backup port,  offline.")
    sh("rm -f /home/crds/CRDS_SERVER_ONLINE")
    sh("crontab </dev/null")
else:
    print("Switching to nominal operating port, server online.", file=sys.stderr)
    open("/home/crds/CRDS_SERVER_ONLINE","w+").write("The server is on the operational port,  online for users.")
    sh("rm -f /home/crds/CRDS_SERVER_OFFLINE")
    sh("crontab < host/crontab")
print("="*80, file=sys.stderr)

sh("./rerun >& /dev/null") #, trace_commands=True)

print("="*80, file=sys.stderr)

