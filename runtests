#! /bin/tcsh

# usage: ./runtests <parameters to "manage.py test"...>

cd ${CRDS}/CRDS_server

if ( $1 == "live") then
    shift;
    set switch_port=0
    echo "Testing on live server."
else 
    set switch_port=1
    echo "Testing on offline server."
endif

if ($switch_port) then
    tools/set_backup_url True
endif

source env.csh

setenv LOG ${CRDS}/CRDS_server/runtests.${CRDS_PROJECT}.${CRDS_USECASE}.err

cd sources
if ($# > 0) then
    echo "Using explicit tests " $1 $2 $3 $4 $5 $6 $7 $8 $9
    # subsequent parameters are apps to test
    python -u manage.py test $1 $2 $3 $4 $5 $6 $7 $8 $9 --verbosity=2 |& tee $LOG
else 
    echo "Using implied tests ALL"
    python -u manage.py test --verbosity=2 |& tee $LOG
endif

if ($switch_port) then
    cd ${CRDS}/CRDS_server
    tools/set_backup_url False
endif
