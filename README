1. General server setup flow is:

# Install third party database components, pyodbc and unixODBC/FreeTDS stack,
# as well as additional django applications.   This is a long (minutes) slow
# compile of third_party code. 
./init_pkgs [hst|jwst] [django|dev|test|prod]

# django    Django/SQLite django server
# dev  Apache/VM/Isilon/MySQL/Proxy/mod_wsgi development server
# test   Apache/VM/Isilon/MySQL/Proxy/mod_wsgi pipeline test server
# prod   Apache/VM/Isilon/MySQL/Proxy/mod_wsgi pipeline production server

# Install the code as indicated by the appropriate config file from
# sources/configs/config.<observatory>.<server_kind>
./install [hst|jwst]  [django|devtest|prod]

# Possibly re-run install if the first run failed due to missing packages
./install [hst|jwst]  [django|dev|test|prod]

# Initilize the CRDS catalog with existing reference files, deliver initial
# set of mappings.
# Enter system passwords.
./init [hst|jwst] [django|dev|test|prod]
<enter password for test user>

2. Procedure for starting the sever:

% ./run

3. Procedure for update not affecting the database:

% ./rerun [hst|jwst] [django|dev|test|prod]

4. Procedure for running a command line / ipython environment for debug

% ./shell

5. Procedure for running HST server self-tests.

% ./run hst django
% ./runtest hst django   (2nd terminal)

or 

6. Procedure for running Django management commands

% ./manage <additional parameters to django-admin.py>

e.g.


7. Database commands

% ./manage dbshell  # to open a SQL prompt to the CRDS server database

% ./manage dbbackup  # to create a django-dbbackup server database backup
% ./manage dbrestore <backup file>   # to revert to an older version of the database


8. Mirroring

First,  backup the database of the source server.  Copy the result to /home/crds.  chmod 700.

Second,  restore the database to the destination server.

Go to the destination server's CRDS_server directory. source env.csh

Set CRDS_SERVER_URL to the source server.

Run the sync tool to copy or update files from the source to the destination.   If you --purge, dry-run first.

    % python -m crds.sync --all --fetch-references --check-files --repair-files [--purge-mappings] [--purge-references]

Set CRDS_SERVER_URL to the destination server.  Run the sync tool to update the server config back to the destination server config.

    % python -m crds.sync --all #  (mappings only, already cached,  should update config)

Run the certify tool against all contexts to check that all files mentioned by mappings exist

    % python -m crds.certify `python -m crds.list --mappings` --exist

Run tools/orphan_files to look for discrepancies between the database, catalogs, and cache