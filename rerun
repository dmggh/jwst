#! /bin/tcsh

# Script to stop, re-install, and restart CRDS server

cd `dirname $0`

source env.csh

# (cd ../CRDS; svn update)

echo "==========================================================="
echo "Stopping server"
echo "==========================================================="
./stop  $CRDS_PROJECT $CRDS_USECASE
sleep 5
./stop  $CRDS_PROJECT $CRDS_USECASE  >& /dev/null
sleep 5


echo "==========================================================="
echo "Installing crds.server Python Django application"
echo "==========================================================="
./install $CRDS_PROJECT $CRDS_USECASE  |& tee install.${CRDS_PROJECT}.${CRDS_USECASE}.err

echo "==========================================================="
echo "Re-starting server"
echo "==========================================================="
./run $CRDS_PROJECT $CRDS_USECASE

if ($CRDS_USECASE != "dev") then
    sleep 10
    prime_web_cache
endif
