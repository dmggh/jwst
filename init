#! /bin/tcsh

# =======================================================================
# Init server environment

if (( "$1" != "hst") && ("$1" != "jwst")) then
	echo 'usage: ./init [jwst|hst]'
	exit -1;
endif

set observatory=$1
shift

if (( "$1" != "dev") && ("$1" != "test")) then
	echo 'usage: ./init [jwst|hst] [dev|test]'
	exit -1;
endif

set mode=$1
shift

cd `dirname $0`
source env.csh

cd `dirname $0`/tools

echo -n "Test account password? "
set password=$<
echo "Adding test user"
python adduser.py test jmiller@stsci.edu "$password"

# ========================================================================
#               Django database import for HST
# ========================================================================
# This initializes a developer database for the
# first time.  It creates database blobs for every file under the closure of
# hst.pmap,  references as well as mappings.   By default, potentially slow or
# non-essential stuff (sha1sum, instrument, filekind, serial) is not added by
# the trailing "0" flag.  Switch to "1" to add those.

if ($observatory == "hst") then
    echo -n "Database password for DADSOPS? "
    set password=$<
    set password_file=${CRDS_INSTALL_DIR}/python/lib/python/crds/server/interactive/db_password.dat
    echo $password >$password_file
    chmod 600 $password_file

    python import_files.py $observatory.pmap jmiller jmiller@stsci.edu "Initial import" 0
else if ($observatory == "jwst") then
    python import_files.py jwst.pmap jmiller jmiller@stsci.edu "Initial import" 0
    python import_files.py jwst_0000.pmap jmiller jmiller@stsci.edu "Initial import" 0
endif
