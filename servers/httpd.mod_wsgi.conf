###
### This is the mod_wsgi variant of the apache config for CRDS
###
### There are no virtual hosts here.
###

LoadModule wsgi_module SUB_APACHEMOD/mod_wsgi.so

# what port number will we listen on
Listen SUB_PORT

DirectoryIndex index.shtml index.html

AccessFileName .htaccess

Header set X-Frame-Options DENY

# The following lines prevent .htaccess and .htpasswd files from being 
# viewed by Web clients. 
#
<Files ~ "^\.ht">
    Order allow,deny
    Deny from all
</Files>


# Do not allow a single request to be larger than about 16G, good luck with that.  This is
# principally here to limit file uploads.
limitRequestBody 16000000000

# where are the server config/log files
ServerRoot	SUB_DIR/server

PidFile run/httpd.pid

ErrorLog logs/error_log

WSGIScriptAlias / SUB_DIR/server/wsgi-scripts/crds.wsgi
WSGIApplicationGroup %{GLOBAL}

<Directory SUB_DIR/server/wsgi-scripts>
Order allow,deny
Allow from all
</Directory>

Timeout 1800

KeepAlive Off

MaxKeepAliveRequests 100

KeepAliveTimeout 15


# prefork MPM
# StartServers: number of server processes to start
# MinSpareServers: minimum number of server processes which are kept spare
# MaxSpareServers: maximum number of server processes which are kept spare
# ServerLimit: maximum value for MaxClients for the lifetime of the server
# MaxClients: maximum number of server processes allowed to start
# MaxRequestsPerChild: maximum number of requests a server process serves
<IfModule prefork.c>
StartServers       15
MinSpareServers    15
MaxSpareServers    10
ServerLimit       30
MaxClients        30
MaxRequestsPerChild  400
</IfModule>


##


# ServerAdmin: Your address, where problems with the server should be
# e-mailed.  This address appears on some server-generated pages, such
# as error documents.  e.g. admin@your-domain.com
#
ServerAdmin guess

TypesConfig /etc/mime.types

#
# DefaultType text/plain
#
# The mod_mime_magic module allows the server to use various hints from the
# contents of the file itself to determine its type.  The MIMEMagicFile
# directive tells the module where the hint definitions are located.
#
<IfModule mod_mime_magic.c>
    MIMEMagicFile conf/magic
</IfModule>

HostnameLookups Off

<IfModule mod_headers.c>
  <FilesMatch ".(js|css|xml|gz|html)$">
    Header append Vary: Accept-Encoding
  </FilesMatch>
</IfModule>

ExpiresActive on

ExpiresByType application/javascript "access plus 1 week"
ExpiresByType application/x-javascript "access plus 1 week"
ExpiresByType application/ecmascript "access plus 1 week"
ExpiresByType text/javascript "access plus 1 week"
ExpiresByType text/ecmascript "access plus 1 week"

ExpiresByType text/css "access plus 1 week"
ExpiresByType image/png "access plus 1 week"

LogLevel warn

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent

# DONT LOG THESE URI's
SetEnvIf Request_URI "^/lock_status" dontlog
SetEnvIf Request_URI "^/jpoll/pull_messages" dontlog

CustomLog logs/access_log combined env=!dontlog

ServerSignature Off

# <Location /cgi-bin>
# 	Options +ExecCGI
# 	AddHandler cgi-script .cgi
# 	Order allow,deny
# 	Allow from all
# </Location>

IndexOptions VersionSort NameWidth=*

#
# IndexIgnore is a set of filenames which directory indexing should ignore
# and not include in the listing.  Shell-style wildcarding is permitted.
#
IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t


#
# Specify a default charset for all pages sent out. This is
# always a good idea and opens the door for future internationalisation
# of your web site, should you ever want it. Specifying it as
# a default does little harm; as the standard dictates that a page
# is in iso-8859-1 (latin1) unless specified otherwise i.e. you
# are merely stating the obvious. There are also some security
# reasons in browsers, related to javascript and URL parsing
# which encourage you to always set a default char set.
#
# Our development is mostly ascii, so 8859-1 is a good default.  Note,
# though, that django does everything as UTF-8.
# AddDefaultCharset iso-8859-1
AddDefaultCharset utf-8
#
AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz

#
# For server-parsed imagemap files:
#
AddHandler imap-file map

#
# Filters allow you to process content before it is sent to the client.
#
# To parse .shtml files for server-side includes (SSI):
# (You will also need to add "Includes" to the "Options" directive.)
#
AddType text/html .shtml
AddOutputFilter INCLUDES .shtml

#
# The following directives modify normal HTTP response behavior to
# handle known problems with browser implementations.
#
BrowserMatch "Mozilla/2" nokeepalive
BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
BrowserMatch "RealPlayer 4\.0" force-response-1.0
BrowserMatch "Java/1\.0" force-response-1.0
BrowserMatch "JDK/1\.0" force-response-1.0

#
# The following directive disables redirects on non-GET requests for
# a directory that does not include the trailing slash.  This fixes a 
# problem with Microsoft WebFolders which does not appropriately handle 
# redirects for folders with DAV methods.
# Same deal with Apple's DAV filesystem and Gnome VFS support for DAV.
#
BrowserMatch "Microsoft Data Access Internet Publishing Provider" redirect-carefully
BrowserMatch "^WebDrive" redirect-carefully
BrowserMatch "^WebDAVFS/1.[012]" redirect-carefully
BrowserMatch "^gnome-vfs" redirect-carefully

#
# Allow server status reports generated by mod_status,
# with the URL of http://servername/server-status
# Change the ".example.com" to match your domain to enable.
#
<Location /server-status>
    SetHandler server-status
    Order deny,allow
    Deny from all
    Allow from 130.167
</Location>
ExtendedStatus On

#
# Allow remote server configuration reports, with the URL of
#  http://servername/server-info (requires that mod_info.c be loaded).
# Change the ".example.com" to match your domain to enable.
#
<Location /server-info>
    SetHandler server-info
    Order deny,allow
    Deny from all
    Allow from 130.167
</Location>


TraceEnable Off

Alias /static SUB_DIR/static

<Location "/static">
	SetHandler None	
	Options None
#	AllowOverride None
#	Order allow,deny
#	Allow from all
</Location>

Alias /unchecked_get/references/hst SUB_CRDS_PATH/references/hst
<Location "/unchecked_get/references/hst">
	SetHandler None	
	Options None
#	AllowOverride None
#	Order allow,deny
#	Allow from all
</Location>

Alias /unchecked_get/mappings/hst SUB_CRDS_PATH/mappings/hst
<Location "/unchecked_get/mappings/hst">
	SetHandler None	
	Options None
#	AllowOverride None
#	Order allow,deny
#	Allow from all
</Location>

Alias /unchecked_get/references/jwst SUB_CRDS_PATH/references/jwst
<Location "/unchecked_get/references/jwst">
	SetHandler None	
	Options None
#	AllowOverride None
#	Order allow,deny
#	Allow from all
</Location>

Alias /unchecked_get/mappings/jwst SUB_CRDS_PATH/mappings/jwst
<Location "/unchecked_get/mappings/jwst">
	SetHandler None	
	Options None
#	AllowOverride None
#	Order allow,deny
#	Allow from all
</Location>

Alias /robots.txt SUB_DIR/static/robots/robots.txt
<Location "SUB_DIR/static/robots/robots.txt">
 SetHandler None
 Options None
</Location>


