{% extends "base.html" %}

{% load stdtags %}

{% block contents %}

<h2>
    Browse {{pmap.header.name|gray}}     
</h2> 

{% accordion pmap.header.name %}
    {% for pitem in pmap.selections %}
        {% accordion  pitem.0 %}
            {% for iitem in pitem.1.selections %}
                {% accordion iitem.0 iitem.1.header.name %}
                    <div class="rmap_tag" url="/context_table/{{iitem.1.header.name}}">{{iitem.1.header.name}}</div>        
                {% endaccordion %}
            {% endfor %}
        {% endaccordion %}
    {% endfor %}
{% endaccordion %}

<br/><br/>

<script type="text/javascript">
$(function () {
    $(".accordion").accordion({
        change: function( event, ui ) {
            console.log(event);
            var div = $(ui.newContent).find(".rmap_tag");
            var url = div.attr("url");
            console.log("Fetching " + url);
            $.ajax({
                url : url,
                context: document.body
            }).done(function (json) {
                    var table = crds.format_table(json["parameters"], json["selections"]);
                    div.html(table);
            });
        }
    });
});
</script>

{% endblock contents %}
