{% if disposition %}
    {% if disposition == "confirmed" %}
        <h2 class="success">{{disposition}}</h2>
    {% else %}
        <h2 class="error">{{disposition}}</h2>
    {% endif %}
{% else %}

    {% block head_overrides %}
        {% include "jpoll/jpoll_head_overrides.html" %}
    {% endblock %} 

    {% if is_authenticated %}
    <div id="confirm_or_cancel">
        <h3>Confirm or Cancel Submission</h3>
        <form method="post" action="/submit_confirm/" enctype="multipart/form-data"
            class="jpoll_ajax_html_form"
            onsubmit='return crds.submit_confirm_or_cancel();' >  {% csrf_token %}    
            <input type='hidden' name='results_id' value="{{results_id}}" />
            <input type="submit" name="button" value="confirm" class="green"
                   title="Approve submission results and proceed with delivery.">
            <input type="submit" name="button" value="cancel"  class="red"
                   title="Discard this submission.">
            <input type="submit" name="button" value="force"  class="orange"
                   title="Ignore locks and originating user.  Approve submission, may lead to collisions.">
        </form>
    </div>
    {% endif %}
{% endif %}
 
<script type="application/javascript">
    
    var submit_kind;    
    $("input[type='submit']").click(function () { submit_kind = this.value; });

    crds.submit_confirm_or_cancel = function () {
        // crds.setup_status_display("Confirmation Status");
        if (submit_kind == "force") {
            if (!confirm("CAUTION: Forcing confirmation can lead to colliding deliveries.")) {
               return false;
            };
        }
        if (submit_kind == "confirm" || submit_kind == "force") {
            crds.set_info_box({
                text: "CONFIRMING...  This may take a minute or so to update the database.",
                 css: {color: "green"},
            });
        } else {
            if (!confirm("Abort submission?")) {
                return false;
            };
            crds.set_info_box({
                text: "CANCELLING... This may take a minute or so to update the database.",
                 css: {color: "red"},
            });
        };
        $("input[type='submit']").hide();
        crds.lock_timeout_action = function () { };
        return true;
    };
    
    crds.lock_timeout_action = function () {
        $("input[value='confirm']").hide();
        $("input[value='cancel']").hide();
        $("input[value='force']").hide();
        $.ajax({url:"/logout/"});
        crds.set_info_box({
           text: "LOCK LOST...  Log back in to cancel or force delivery.",
           css: {color: "red"},
        });
    };

</script>
