{% extends "base.html" %}
{% load stdtags %}

{% block head_overrides %}
  <script src="/static/dataset_bestrefs.js" type="text/javascript"></script>
{% endblock head_overrides %}

{% block contents_both %}

<h2 title="Find best references for uploaded or archive database dataset parameters."
    >Dataset Best References</h2>

  <form id="raw_form" action="/bestrefs/" method="post" enctype="multipart/form-data"
        onsubmit="return validate(event);"> {% csrf_token %}
    <div>
    <h3 title="CRDS rules version used to find best references."
        >Context:</h3>

    {% include "select_pmap.html" %}
    </div>

    <h3 title="Choose one method to define dataset parameters.">Dataset:</h3>
    <table width="100%">
      <tr title="Find best references for uploaded dataset FITS parameters. Nominally this should be level-2b data but there are no formal restrictions on actual file use, experimentation is fine.  Uploads header metadata only.">
        <td class="h4">
            <input type="radio" name="dataset_mode" value="dataset_local" checked="checked" /><span>Upload FITS Header</span>
        </td>
        <td>
          {# see also set_radio_clear_fits() above #}
          <input type="file" id="dataset_local_file" onchange="crds.set_header_contents(this);" />
        </td>
      </tr>
      <tr title="Parameters taken from selected local FITS file,  may be edited.">
        <td></td>
        <td>
          <textarea name="dataset_local" id="dataset_local_textarea" rows="5" cols="40">{{dataset_local}}</textarea>
          <input type="text" name="dataset_name" id="dataset_name"
                 style="border:none; background:none; color:gray;" width="40"
                 >{{dataset_name}}</input>
        </td>
      </tr>
      {% if is_authenticated %}
      <tr title="Find best references for and uploaded dataset file.  While slower,  this may work in situations where Javascript header extraction above fails.">
        <td class="h4">
           <input type="radio" title="Find best references using an uploaded dataset file."
                  name="dataset_mode" value="dataset_uploaded">Upload Dataset</input>
        </td>
        <td align="left" id="dataset_uploaded_input_td">
           <input type="file" class="multi" maxlength="1" name="dataset_uploaded"
                    id="dataset_uploaded" onchange="crds.set_radio_clear_fits('dataset_uploaded');" />
        </td> 
      </tr>
      {% endif %}
      <tr title="Find best references using archive database parameters.">
        <td class="h4">
            <input type="radio" class="dataset_id"
                   name="dataset_mode" value="dataset_archive"/><span>Dataset ID</span>
        </td>
        <td align="left">
          <input type="text" size="50" name="dataset_archive"
                 id="dataset_archive"
                 class="black"
                 value="{{dataset_archive}}"
                 onchange="crds.set_radio_clear_fits('dataset_archive');" />
          {% if observatory == "jwst" %}
            <p class="hint">e.g. JW93135336001_02102_00001.MIRIFUSHORT</p>
          {% else %}
            <p class="hint">.e.g. ICXV23030</p>
          {% endif %}
        </td>
        <td>
        {% if mock_params %}
        <span class="label label-sm red">&nbsp;&nbsp;[MOCKED ARCV PARAMS
        {{mock_params}}]</span>
        {% else %}
        <span class="label label-sm green">&nbsp;&nbsp;[LIVE {{live_params}}]
        {% endif %}          
        </td>
      </tr>
    </table>
    
    <br/>
    <input class="btn btn-primary" type="submit" value="Submit" />
    
  </form>
{% endblock contents_both %}

{% block bottom_help %}
    {% include "bestrefs_bottom_help.html" %}
{% endblock bottom_help %}

