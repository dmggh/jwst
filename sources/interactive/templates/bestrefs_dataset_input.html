{% extends "base.html" %}

{% block head_overrides %}
  <script src="/static/dataset_bestrefs.js" type="text/javascript"></script>
{% endblock head_overrides %}

{% block column1 %}

  <form id="raw_form" action="/bestrefs/" method="post" enctype="multipart/form-data"
        onsubmit="return validate(event);"> {% csrf_token %}
    <h2>Dataset Best References</h2>
    
    <h3>Context:</h3>
    {% include "select_pmap.html" %}
    
    <h3>Dataset:</h3>
    <table>
      <tr>
        <td class="h4">
	{% if observatory == "jwst" and not is_authenticated %}
	    {# suppress radio button for anonymous JWST #}
            <input type="hidden" name="dataset_mode" value="dataset_local" checked="checked" />Upload FITS Header
	{% else %}
            <input type="radio" name="dataset_mode" value="dataset_local" checked="checked" />Upload FITS Header
	{% endif %}
        </td>
        <td>
          {# see also set_radio_clear_fits() above #}
          <input type="file" id="dataset_local_file" onchange="crds.set_header_contents(this);" />
          <input type="text" name="dataset_name" id="dataset_name"
                 style="border:none; background:none; color:gray;"
                 >{{dataset_name}}</input>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <textarea name="dataset_local" id="dataset_local_textarea" rows="5" cols="40">{{dataset_local}}</textarea>
      </tr>
      {% if is_authenticated %}
      <tr>
        <td class="h4">
           <input type="radio" name="dataset_mode" value="dataset_uploaded">Upload Dataset</input>
        </td>
        <td align="right" id="dataset_uploaded_input_td">
           <input type="file" class="multi" maxlength="1" name="dataset_uploaded"
                    id="dataset_uploaded" onchange="crds.set_radio_clear_fits('dataset_uploaded');" />
        </td> 
      </tr>
      {% endif %}
      {% if observatory != "jwst" %}
      <tr>
        <td class="h4">
            <input type="radio" name="dataset_mode" value="dataset_archive" />Dataset ID
        </td>
        <td align="left">
            <input type="text" width="32" name="dataset_archive" id="dataset_archive"
                    value="{{dataset_archive}}" 
                    onchange="crds.set_radio_clear_fits('dataset_archive');" />
            <span class="hint">.e.g. I9ZF01010</span>
        </td>
      </tr>
      {% endif %}
    </table>
    
    <br/>
    <input type="submit" value="Submit" />
    
  </form>
{% endblock column1 %}

{% block help %}
    <p><b>Dataset Best References</b> determines the best reference files 
    for an uploaded or cataloged dataset header.
    </p>

    <p/><p><b>Context</b> defines the version of rules that should be used to determine 
    best references.
    </p>

    <p/><p><b>Upload FITS Header</b> loads reference matching parameters from a FITS file on your local system;   
    the loaded matching parameters may be edited in the browser.    
    </p>

    {% if observatory != "jwst" %}
    <p/><p><b>Dataset ID</b> specifies the id of a cataloged parameter set for which to determine best references.  
    If the dataset id names an association,  the results returned are for the first member of the association.
    </p>
    {% endif %}

{% endblock help %}

{% block bottom_help %}
    {% include "bestrefs_bottom_help.html" %}
{% endblock bottom_help %}

