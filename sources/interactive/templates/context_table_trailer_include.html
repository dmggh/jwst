<script type="text/javascript">
$(function () {
    $("#contents").hide();
    $(".accordion").accordion({
        heightStyle: "content",
        autoWidth: false,
        activate: function( event, ui ) {
            console.log(event);
            var div = $(ui.newPanel).children("div.rmap_tag");
            if (div.html()) {
                console.log("table already intialized")
                return;
            };
            var mapping_name = div.attr("mapping_name");
            var url = "/context_table/" + mapping_name;
            if (!mapping_name) {
               console.log("no url,  skipping fetch.");
               return;
            };
            console.log("Fetching " + url);
            div.html($("<p class='green'>").html("Loading..."));
            $.ajax({
                url : url,
                context: document.body
            }).done(function (json) {
                console.log("accordion activate done.");
                json.aLengthMenu = [[100, 200, 500, 1000, 2000, 5000, -1], [100, 200, 500, 1000, 2000, 5000, "All"]];
                json.iDisplayLength = 200;
                div.hide();
                div.html("<table class='table table-striped table-bordered' width='100%' cellspacing='0'><thead></thead><tbody></tbody></table>");
                div.children()
                    .css({"font-size":"0.7em"})
                    .dataTable(json);
                $("#diff_button").css({"font-weight":"bold"});
                $("table.table > thead > tr")
                    .css({"border":"black"})
                    .addClass("bootstrap_a");
                div.show();
            });
        },
    });
    $("#contents").show();
});
</script>
