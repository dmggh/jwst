{% extends "table_base.html" %}

{% load stdtags %}

{% block column1 %}
    <div class="title_bar">
      <h3>Obtain Best Reference Files</h3>
    </div>
    <ol>
      <li><a href="/docs/cmdline_bestrefs/">Using the Command Line</a></li>
      <li><a href="/bestrefs/">From Dataset ID or FITS Header Upload</a></li>
      <li><a href="/bestrefs_explore/">Exploring with Instrument Parameters</a></li>
    </ol>
    
    <div class="title_bar">
      <h3>Reference File Database Services  
      </h3>
    </div>
    <ol>
      <li><a href="/browse_db/">Browse Database</a></li>
      <li><a href="/recent_activity/">Recent Activity</a></li>
    </ol>
{% endblock column1 %}        

{% block column2 %}

    {% if is_authenticated %}

      <div class="title_bar">
        <h3>Restricted Services
          {% if is_authenticated %}
          <span class='locked_instrument'>{{locked_instrument}}</span>  
          {% endif %}
        </h3>
      </div>
      <ol>
        <li><a href="/certify/">Certify Files</a></li>
        <li><a href="/difference/">Difference Files</a></li>
        <li><a href="/delivery_status/">Delivery Status</a></li>
        <li><a href="/set_password/">Change Password</a></li>
        {% if user|in_group:"file_submission" %}
        <li><a href="/set_default_context/">Set Context</a></li>
        {% endif %}
        {% if user|in_group:"file_submission" and locked_instrument %}
        <br/>
        <li><a href="/batch_submit_references/">Batch Submit References</a></li>
        <li><a href="/submit/reference/">Submit References</a></li>
        <li><a href="/submit/mapping/">Submit Mappings</a></li>
        <li><a href="/mark_bad/">Mark Files Bad</a></li>
        {% endif %}
      </ol>
      
      {% if is_superuser %}
      <div class="title_bar">
	    <h3>Super User Services</h3>
      </div>
      <ol>
        <li><a href="/version_info/">Server Version Info</a></li>
        <li><a href="/admin/">Admin</a></li>
        <br>
	    {% if locked_instrument %}
        <li><a href="/delete/reference/">Delete References (UNCONFIRMED)</a></li>
        <li><a href="/add_existing/reference/">Add References (UNCONFIRMED)</a></li>
        {% else %}
        <li><a href="/batch_submit_references/">Batch Submit References (UNLOCKED)</a></li>
        <li><a href="/submit/reference/">Submit References (UNLOCKED)</a></li>
        <li><a href="/submit/mapping/">Submit Mappings (UNLOCKED)</a></li>
        <li><a href="/create_contexts/">Create Contexts (UNCONFIRMED)</a></li>
	    {% endif  %}
        <br/>
      </ol>
      {% endif %}

      {% endif %}

{% endblock column2 %}

{% block contents_bottom %}
<div id="contents_top">
    <script type="text/javascript">
        $("#contents").hide();
    </script>
    <div id="operational_references_container" class="body_panel"> 
        <br/>
        <h3 style="margin-top: 0px;">Operational References <span style="font-size: 0.7em;" class="gray">(under context {{pmap.header.name|browse}})</span></h3>
        {% include "context_table_body_include.html" %}
    </div>


    {% if is_authenticated %}
    <div id="remote_contexts_container" class="body_panel"> 
        <br/>
        <h3 style="margin-top: 0px;">Actual Pipeline Contexts</h3>
        <table>
          <theader>
            <tr>
              <th>Pipeline</th>
              <th>Commanded Context</th>
              <th>Actual Context</th>
              <th>Status</th>
            </tr>
          </theader>
          <tbody>
            {% for remote in remote_contexts %}
            <tr>
              <td>{{remote.name}}</td>
              <td>{{pmap}}</td>
              <td>{{remote.context}}</td>
              {% if pmap == remote.context %}
              <span class="green">synced</span>
              {% else %}
              <span class="red">out of date</span>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
    </div>
    {% endif %}

    <div id="context_history_container" class="body_panel">
      <br/>
      <h3 style="margin-top: 0px;">Context History <a href="/display_context_history" class="label" style="font-size: 0.8em;">(more)</a></h3>
      {% include "context_history_include.html" %}        
    </div>        
</div>
{% endblock contents_bottom %}

{% block body_trailer %}
    {% include "context_table_trailer_include.html" %}
    <script type="text/javascript">
        $(function () {
            $("#column1").css("width", "35%");
            $("#column2").css("width", "35%");
            $("#contents").show();
        });
    </script>
{% endblock body_trailer %}
 
