{% extends "table_base.html" %}

{% load stdtags %}

{% block contents_both %}

    <div class="row">

        {% if is_authenticated %}
        <div class="col-md-6">
        {% else %}
        <div class="col-md-12">
        {% endif %}

            <div class="title_bar">
              <h3>Obtain Best Reference Files</h3>
            </div>
            <ol>
              <li><a href="/docs/cmdline_bestrefs/">Using the Command Line</a></li>
              <li><a href="/bestrefs/">From Dataset ID or FITS Header Upload</a></li>
              <li><a href="/bestrefs_explore/">Exploring with Instrument Parameters</a></li>
            </ol>
            
            <div class="title_bar">
              <h3>Reference File Database Services</h3>
            </div>
            <ol>
              <li><a href="/browse_db/">Browse Database</a></li>
              <li><a href="/recent_activity_input/">Recent Activity</a></li>
              {% if is_authenticated %}
              <li><a href="/display_all_contexts/">All Contexts</a></li>
              {% endif %}
              {% if is_superuser %}
              <li><a href="/old_results/">Old Results</a></li>
              {% endif %}
            </ol>

        </div>

        {% if is_authenticated %}
            <div class="col-md-6">
              <ol>
                <div class="title_bar" style="text-indent: -3em;">
                  <h3>Restricted Services
                  </h3>
                </div>
                <li><a href="/certify/" title="Check uploaded files using the same ceritfier used for file submissions" >Certify Files</a></li>
                <li><a href="/difference/" title="Compare two named or uploaded CRDS rules or reference files">Difference Files</a></li>
                <li><a href="/delivery_status/" title="Infer archiving status from files in the delivery directory">Delivery Status</a></li>
                <li><a href="/set_password/" title="Update your password">Change Password</a></li>
                {% if user|in_group:"file_submission" %}
                    <li><a href="/set_default_context/" title="Choose the context everyone should use by default.">Set Context</a></li>
                {% endif %}
                {% if user|in_group:"file_submission" and locked_instrument %}
                    <div class="title_bar" style="text-indent: -3em;">
                      <h3>Routine Submission Services</h3>
                    </div>
                    <li><a href="/batch_submit_references/" title="Submit new references and generate corresponding CRDS rules">Batch Submit References</a></li>
                    <li><a href="/submit/mapping/" title="Submit new rmaps, imaps, or pmaps.  Rmaps can also generate updated imaps and pmaps">Submit Mappings</a></li>
                    <div class="title_bar" style="text-indent: -3em;">
                      <h3>Advanced Services</h3>
                    </div>
                    <li><a href="/mark_bad/" title="Designate references or rules as scientifically invalid">Mark Files Bad</a></li>
                    <li><a href="/submit/reference/" title="Submit new references only, no rules generation">Submit References</a></li>
                    <li><a href="/add_existing/reference/" title="Add existing references into a context generating a new context">Add References</a></li>
                    <li><a href="/delete/reference/" title="Remove references from a context generating a new context without them">Delete References</a></li>
                {% endif %}
              </ol>
              
              {% if is_superuser %}
                  <div class="title_bar">
                    <h3>Super User Services</h3>
                  </div>
                  <ol>
                    <li><a href="/version_info/">Server Version Info</a></li>
                    <li><a href="/admin/">Admin</a></li>
                    <br>
                    {% if not locked_instrument %}
                        <li><a href="/batch_submit_references/">Batch Submit References (UNLOCKED)</a></li>
                        <li><a href="/submit/reference/">Submit References (UNLOCKED)</a></li>
                        <li><a href="/submit/mapping/">Submit Mappings (UNLOCKED)</a></li>
                        <li><a href="/create_contexts/">Create Contexts (UNCONFIRMED)</a></li>
                        <li><a href="/mark_bad/">Mark Files Bad (UNLOCKED)</a></li>
                        <li><a href="/add_existing/reference/">Add References</a></li>
                        <li><a href="/delete/reference/">Delete References</a></li>
                    {% endif  %}
                    <br/>
                  </ol>
              {% endif %}

            </div>
        {% endif %}
    </div>

{% endblock contents_both %}

{% block contents_bottom %}
<div id="contents_top">
    <script type="text/javascript">
        $("#contents").hide();
    </script>
    <div id="operational_references_container" class="body_panel"> 
        <h3 style="margin-top: 0px;" title="References in use in the pipeline.  This may lag deliveries">Operational References <span style="font-size: 0.7em;" class="gray">(under context {{pmap.header.name|browse}})</span></h3>
        {% include "context_table_body_include.html" %}
    </div>

    <div id="context_history_container" class="body_panel">
      <br/>
      <h3 style="margin-top: 0px;" title="Dates of context use in pipeline">Context History <a href="/display_context_history/" class="tdlabel" style="font-size: 0.8em;">(more)</a></h3>
      {% include "context_history_include.html" %}        
    </div>        

    {% if is_authenticated %}
    <div id="remote_contexts_container" class="body_panel"> 
        <br/>
        <h3 style="margin-top: 0px;" title="Shows pipeline CRDS cache synchronization status">Remote Contexts</h3>
        <table style="background-color: #EEEEEE;">
          <theader>
            <tr>
              <th class="center bold tdlabel ctx">Cache</th>
              <th class="center bold tdlabel ctx">Server Context</th>
              <th class="center bold tdlabel ctx">Cached Context</th>
              <th class="center bold tdlabel ctx">Cache Status</th>
            </tr>
          </theader>
          <tbody>
            {% for remote in remote_contexts %}
            <tr>
              <td class="center ctx">{{remote.name}}</td>
              <td class="center ctx">{{pmap_operational}}</td>
              <td class="center ctx">{{remote.context}}</td>
              <td class="center ctx">
                {% if pmap_operational == remote.context %}
                <span class="green">synced</span>
                {% else %}
                <span class="red">out of date</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
    </div>
    {% endif %}

</div>
{% endblock contents_bottom %}

{% block body_trailer %}
    {% include "context_table_trailer_include.html" %}
    <script type="text/javascript">
        $(function () {
            $("#column1").css("width", "35%");
            $("#column2").css("width", "35%");
            $("#contents").show();
        });
    </script>
{% endblock body_trailer %}
 
