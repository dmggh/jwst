{% extends "table_base.html" %}

{% load stdtags %}

{% block contents %}

    <h2>Recent Activity</h2>

    {% include "filters_include.html" %}
    
    <br/>

    <table border="1" id="recent_activity_table" class="crds_data_table">
        <thead>
            <tr>
                <th>Date</th>
		{% if is_superuser %}
                   <th>Naming</th>
		{% else %}
                   <th>Filename</th>
		{% endif %}
                <th>Action</th>
                {% if is_authenticated %}
                   <th>User</th>
                {% endif %}
                <th>Why</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in filtered_activities %}
            <tr>
                <td>{{activity.date|minutes}}</td>
		{% if is_superuser %}
                   <td>CRDS {{activity.filename|browse}} uploaded from {{fileblobs|lookup:activity.filename|lookup:"uploaded_as"|darkgreen}}</td>
		{% else %}
                   <td>{{activity.filename|browse}}</td>
		{% endif %}
                <td>{{activity.action}}</td>
                {% if is_authenticated %}
                   <td>{{activity.user}}</td>
                {% endif %}
                <td>{{activity.why}}</td>
                <td>{{activity.details|browsify|safe}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock contents %}

{% block body_trailer %}
<script type="text/javascript">
    $("#contents").hide();
    $(function() {
        $("th").css({align : "center", color : "darkblue"});
        var tables = $(".crds_data_table");
        tables.each(function (index, table) {
            $(table).hide();
            $(table).css({"font-size":"0.8em"});
            $(table).dataTable({
                bAutoWidth : false,
                aoColumns : [
                   {sWidth : "10%"},
                   {sWidth : "10%"},
                   {sWidth : "10%"},
                   {% if is_authenticated %}
                   {sWidth : "6%"},
                   {% endif %}
                   {sWidth : "28%"},
                   {sWidth : "35%"},
                 ],
                aLengthMenu : [[50, 500, 5000, -1], [50, 500, 5000, "All"]],
                order: [[ 0, "desc" ]] 
               iDisplayLength : -1,                  
            });
            $(table).show();
        });
        $("td").css({"text-align" : "center"});
        $("#contents").show();
    }); 
</script>
{% endblock body_trailer %}

