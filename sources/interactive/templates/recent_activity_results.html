{% extends "table_base.html" %}

{% load stdtags %}

{% block contents %}

    <h2>Recent Activity</h2>

    {% include "filters_include.html" %}
    
    <br/>

    <table border="1" id="recent_activity_table" class="crds_data_table table
                                                        table-striped table-bordered">
        <thead>
            <tr>
                <th>#</th>
                <th>Date</th>
		{% if is_superuser %}
                   <th>Naming</th>
		{% else %}
                   <th>Filename</th>
		{% endif %}
                <th>Action</th>
                {% if is_authenticated %}
                   <th>User</th>
                {% endif %}
                <th>Why</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in filtered_activities %}
            <tr>
                <td>{{forloop.counter}}</td>
                <td>{{activity.date|minutes}}</td>
                <td>{{activity.filename|browse}}</td>
                <td>{{activity.action}}</td>
                {% if is_authenticated %}
                   <td>{{activity.user}}</td>
                {% endif %}
                <td>{{activity.why}}</td>
                <td style="background-color:white;">
                  <table width='100%' class='table table-striped table-bordered'>
                    {{activity.details|browsify:crds_name_map|safe}}
                  </table>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock contents %}

{% block body_trailer %}
<script type="text/javascript">
    $("#contents").hide();
    $(function() {
        $("th").css({"text-align" : "center", "color" : "darkblue"});
        var tables = $(".crds_data_table");
        tables.each(function (index, table) {
            $(table).hide();
            $(table).css({"font-size":"0.8em"});
            $(table).dataTable({
                bAutoWidth : false,
                aoColumns : [
                   {sWidth : "5%"},
                   {sWidth : "8%"},
                   {sWidth : "10%"},
                   {sWidth : "10%"},
                   {% if is_authenticated %}
                   {sWidth : "6%"},
                   {% endif %}
                   {sWidth : "22%"},
                   {sWidth : "43%"},
                 ],
                aLengthMenu : [[50, 500, 5000, -1], [50, 500, 5000, "All"]],
                iDisplayLength : 50
            });
            $(table).show();
        });
        $("td").css({"text-align" : "left"});
        $("#contents").show();
        // $('.crds_data_table').DataTable();
    }); 
</script>
{% endblock body_trailer %}

