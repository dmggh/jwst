{% extends "table_base.html" %}

{% load stdtags %}

{% block contents %}

    <h2>Recent Activity</h2>

    <h3>Filters</h3>
    {% if filters %}
       <table>
            <tr>
                <th>Filter</th>
                <th>Value</th>
            </tr>
            {% for filter_name, filter_value in filters.items %}
            <tr>
                <td>{{filter_name}}</td>
                <td>{{filter_value}}</td>
            </tr>
            {% endfor %}
       </table>
    {% else %}
       <p>No filters.</p>
    {% endif %}
    
    <h3>Activity</h3>
    <table border="1">
        <thead>
            <tr>
                <th width="10%" align="center">Date</th>

		{% if is_superuser %}
                   <th width="10%" align="center">Naming</th>
		{% else %}
                   <th width="15%" align="center">Filename</th>
		{% endif %}

                <th width="10%" align="center">Action</th>

                {% if is_authenticated %}
                <th width="10%" align="center">User</th>
                {% endif %}

                <th width="30%" align="center">Why</th>
                <th width="20%" align="center">Details</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in filtered_activities %}
            <tr>
                <td align="center">{{activity.date|minutes}}</td>

                {% if is_superuser %}
                   <td align="center">File uploaded as {{fileblobs|lookup:activity.filename|lookup:"uploaded_as"|green}} was renamed to {{activity.filename|browse}}</td>
                {% else %}
                   <td align="center">{{activity.filename|browse}}</td>
                {% endif %}

                <td align="center">{{activity.action}}</td>

                {% if is_authenticated %}
                <td align="center">{{activity.user}}</td>
                {% endif %}

                <td align="center">{{activity.why}}</td>
                <td align="center">{{activity.details}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

<script type="text/javascript">
    $("#contents").hide();
    $("#crds_delivery_table").dataTable({
        "aaSorting" : ["desc"]
    });
    $("#crds_delivery_table").css({"class":"crds_data_table", "font-size":"0.8em"});
    $(function () {
        $("#contents").show();
    });
</script>

{% endblock contents %}
