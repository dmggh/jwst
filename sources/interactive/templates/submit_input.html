/{% extends "base.html" %}

{% load stdtags %}

{% block head_additions %}
    {% include "fileupload/picture_form_head_additions2.html" %}
{% endblock %}

{% block head_overrides %}
    {% include "jpoll/jpoll_head_overrides.html" %}
{% endblock %}

{% block contents_both %}

    <h2>Submit {{crds_filetype|capfirst}} Files</h2>

        {% include "select_files.html" %}        

        <form method="post" action="/submit/{{crds_filetype}}/" enctype="multipart/form-data"
            id="batch_submit_form" class="jpoll_ajax_html_form"
            onsubmit="return crds.validate_and_confirm_file_submit(this);" > {% csrf_token %}

            <input type='hidden' name='observatory' value='{{observatory}}' />
            
            <div title="Degree that new files are expected to impact science results.">
              <br/>
              <h3 style="display: inline;" >Change Level:</h3>
              <select style="font-size: 0.75em;" name='change_level' value="{{change_level}}">
                <option>SEVERE</option>
                <option>MODERATE</option>
                <option>TRIVIAL</option>
              </select>
            </div>

            <div title="Author of new reference files, generally not the submitter.">
              <br/>
              <h3 style="display: inline;">Creator:</h3>
              <input type='text' name='creator' id='creator' size="40" value="{{creator}}">
            </div>

            <div title="Information about file changes and expected impacts, include instrument and type.">
              <br/>
              <h3 style="display: inline;" >Description:</h3>
              <textarea name='description' id='description' rows="4" cols="50">{{description}}</textarea>
            </div>

            {% if crds_filetype == "reference" %}
                <div title="Compare new references with older versions during certification." > 
                  <br/>
                  <h3 style="display:inline;">Compare Old Reference: </h3> 
                  <input type="checkbox" name="compare_old_reference"
                         value='checked' {{compare_old_reference}} />
                </div>
                <div id="comparison-context-hide" title="Context to search for comparison references.">
                  <h3>Comparison Context:</h3>
                  {% include "select_pmap.html" %}
                </div>        
                <script type="text/javascript" language="javascript">
                    $("input[name='compare_old_reference']").change(function() {
                        var checkbox = $("input[name='compare_old_reference']");
                        if (checkbox.is(":checked")) {
                                $("#comparison-context-hide").show();
                        } else {
                                $("#comparison-context-hide").hide();
                        };
                    });
                </script>
            {% endif %}
            
            {% if crds_filetype == "mapping" %}
                <div title="Automatically generate new .pmap and .imap referring to new rmaps.">
                  <br/>
                  <h3 style="display: inline;">Generate Contexts:</h3>
                  <input name='generate_contexts' type='checkbox' value='checked' {{generate_contexts}}> 
                </div>
                <div id="derivation-context-hide" title="Version CRDS of rules to which new files are added.">
                  <h3>Derive From Context:</h3>
                  {% include "select_pmap.html" %}  
                </div>      
                <script type="text/javascript" language="javascript">
                    $("input[name='generate_contexts']").change(function() {
                        var checkbox = $("input[name='generate_contexts']");
                        if (checkbox.is(":checked")) {
                                $("#derivation-context-hide").show();
                        } else {
                                $("#derivation-context-hide").hide();
                        };
                    });
                </script>
            {% endif %}
            
            <div title="When checked, automatically rename the submitted files with CRDS generated names.">
              <br/>
              <h3 style="display: inline;">Auto-Rename:</h3>
              {% include "auto_rename_input.html" %}
            </div>
            
            <br/> 

          <input class="btn btn-primary" type="submit" value="Submit Files">
        </form>
{% endblock contents_both %}
        
{% block help %}
{% endblock help %}


{% block bottom_help %}

{% include "bluebar.html" %}

<div>

  </br>
  {% accordion "Procedures for manual .pmap and .imap updates" %}
  <ul>
    <li>At times it's necessary to change top level CRDS mappings without
    changing .rmaps.
    </li>
    <li>Submit Mappings does not support Generate Contexts for .imap-only (or
      .pmap-only) submissions.
    </li>
    <li>Submit Mappings does not support submitting inter-linked .imaps and
      .pmaps in the same submission.
    </li>
    <li>To perform a manual .imap update,  you must also perform a
      manual .pmap update as a second separate submission.
    </li>
    <li>New .pmaps not created by CRDS require manually updating
      the EDIT context using Set Context.
    </li>
  </ul>

  {% accordion "Manual .imap update:" %}
  <ol>
    <li>Identify the baseline context to derive from.</li>
    <li>Within that .pmap,  identify the .imap to modify.
    <li>Download or copy the identified .imap</li>
    <li>Manually edit the .imap to make your required changes, e.g. removing a
      type or setting a type to N/A.
    </li>
    <li>Submit the .imap using Submit Mappings with:
      <ul>
        <li>Generate Contexts OFF</li>
        <li>Auto-rename ON</li>
      </ul>
    </li>
    <li>Confirm your submission</li>
    <li>Follow the procedure for manually updating a .pmap to refer to
      your newly named .imap
    </li>
  </ol>
  {% endaccordion %}
    
  {% accordion "Manual .pmap update:" %}
  <ol>
    <li>Download or copy the .pmap you wish to start from</li>
    <li>Manually edit the .pmap to make any required changes</li>
    <li>Submit the .pmap using Submit Mappings with:
      <ul>
        <li>Generate Contexts OFF</li>
        <li>Auto-rename ON</li>
      </ul>
    </li>
    <li>Confirm your submission</li>
    <li>Use Set Context to update the <bold>EDIT context</bold> to this .pmap
      as the default starting point for subsequent file submissions.
    </li>
    <li>From here onward,  this should be a normal file submission,  with
      corrsponding processes to archive the files,  Set Context the default
      OPERATIONAL context,  and sync the pipeline's CRDS cache.
    </li>
  </ol>
  {% endaccordion %}
  
 {% accordion "Manually update the EDIT context." %}
  <p>The default starting point for new rules (Derive From Context) is defined by the
    Editing Context.
  </p>
  <p>When Generate Contexts is ON,  CRDS automatically sets the EDIT
    context to the generated .pmap.
  </p>
  <p>When Generate Contexts is OFF and a .pmap is manually updated, the Set
    Context page can/must be used to update the Editing Context so that future
    submissions will derive from the new .pmap by default.
  </p>
  {% endaccordion %}
  
  {% endaccordion %}

</div>

{% endblock bottom_help %}
