{% extends "base.html" %}

{% load stdtags %}

{% block contents_both %}
    <h2>Best References</h2>

    <div class="row">
        <div class="col-md-4">
          <p style="font-size: 1.1em;">{{dataset_name|gray}}</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <h3 title="Version of CRDS rules used to determine best references.">New Context</h3>
            <p>{{context_name|context_table}}</p>

            <h3 title="Dataset parameters from archive database used to compute
            best references">Input Parameters</h3>
            <table width="100%">

            {% for key, val in header_items %}
              {% if "CORR" not in key and "-OBS" not in key %}
              <tr>
                <td class="tdlabel" width="30%">{{key}}:</td>
                <td class="value" width="60%">{{val}}</td>
              </tr>
              {% endif %}
            {% endfor %}

            <tr><td> </td></tr>
            <tr><td> </td></tr>

            {% for key, val in header_items %}
              {% if "CORR" not in key and "-OBS" in key %}
              <tr>
                <td class="tdlabel" width="30%">{{key}}:</td>
                <td class="value" width="60%">{{val}}</td>
              </tr>
              {% endif %}
            {% endfor %}

            <tr><td> </td></tr>
            <tr><td> </td></tr>

            {% for key, val in header_items %}
              {% if "CORR" in key %}
              <tr>
                <td class="tdlabel" width="30%">{{key}}:</td>
                <td class="value" width="60%">{{val}}</td>
              </tr>
              {% endif %}
            {% endfor %}
            </table>

        </div>
    
        <div class="col-md-8">
            <table class="bestrefs_table" style="width:100%;">
              <thead class="bestrefs_header">
                <tr>
                  <td>
                    <h3 title="These downloads are intended for debug and quick reference.  
                               See the front page topic 'Using the command line' for information
                               on automatic downloads of complete sets of reference files.">Best References</h3>
                  </td>
                  <td>
                    <br/>
                    <input type="checkbox" name="hide_na" id="hide_na">Toggle N/A</input>
                  </td>
                </tr>
                <tr>
                  {% if old_bestrefs_items %}
                     <th class="bestrefs_header">Type</th>
                     <th class="bestrefs_header">Old Reference</th>
                     <th class="bestrefs_header">New Reference</th>
                     <th class="bestrefs_header">Changed</th>
                     <th class="bestrefs_header">Download</th>
                  {% else %}
                     <th class="bestrefs_header">Type</th>
                     <th class="bestrefs_header">Best Reference</th>
                     <th class="bestrefs_header">Download</th>
                  {% endif %}
                </tr>
              </thead>
              <tbody>
              {% for reftype, fname in bestrefs_items %}
                <tr class="data_row">
                  <td class="bestrefs_header" width="30%">
                    {% if rmap_names|lookup:reftype|file_exists %}
                       <a href="/browse/{{rmap_names|lookup:reftype}}">{{reftype}}</a>
                    {% else %}
                       {{reftype|gray}}
                    {% endif %}
                  </td>
                  {% if old_bestrefs_items %}
                     {% if old_bestrefs_items|lookup:reftype|file_exists %}
                         <td class="bestrefs_data" width="20%">
                           {{old_bestrefs_items|lookup:reftype|browse}}
                         </td> 
                     {% else %}
                         <td class="bestrefs_data error" width="60%">{{old_bestrefs_items|lookup:reftype}}</td>
                     {% endif %}
                  {% endif %}
                  {% if fname|file_exists %}
                    <td class="bestrefs_data" width="20%" title="File details">
                         {{fname|browse}}
                    </td>
                  {% else %}
                    <td class="bestrefs_data error" width="60%">{{fname}}</td>
                  {% endif %}
                  {% if old_bestrefs_items %}
                  <td class="bestrefs_data">
                    {% if fname != old_bestrefs_items|lookup:reftype  %}
                       <span class="green">yes</updated>
                    {% else %}
                       <span class="darkgray">no</span>
                    {% endif %}
                  </td>
                  {% endif %}
                  {% if fname|file_exists %}
                    <td class="bestrefs_data" width="20%" title="Obtain the reference.">
                      {{fname|download_link|safe}}
                    </td>
                  {% endif %}
                </tr>
              {% endfor %}
              </tbody>
            </table>
        </div>
    </div>         
</div>

<script>
  $("#hide_na").click(function() {
      console.log("hide_na.");
      // console.log($("td:contains('n/a')"));
      // console.log($("td:contains('n/a')").parent());
      $("td:contains('n/a')").parent().toggle();
  });
</script>

{% endblock contents_both %}

{% block contents_bottom %}
    <div id="bestrefs_debug_output_container" title="Debug trace of best
                                                     references lookup.">
      <br/>
    {% accordion  "Best References Debug Output" %}
      <pre id="bestrefs_debug_output">
{{bestrefs_debug_output.strip}}
      </pre>
    {% endaccordion %}
    </div>

    <br/>
    
    <div class="panel panel-default">
        <div class="panel-body">
    
        <p><b class="red" >No match found.</b>  No best reference could be
        found for the given type and parameter set.   CRDS did not rule the 
        type as not applicable for this parameter set.   This is an error
        and typically indicates missing reference coverage,  CRDS rmap/rules
        errors,  or parameter set errors.

        <p><p><b class="red">n/a</b>  The type is not applicable for the given matching parameters.
        
        <p><p><b class="red">parameter</b> A parameter was not valid (for that type).  CRDS did not
        rule the parameter as not applicable. 
        </div>
    </div>

{% endblock contents_bottom %}

{% block bottom_help %}
    <div id="bestrefs_diagnostics_disclaimer" sytle="color: darkgray;">
      {% include "bestrefs_bottom_help.html" %}
    </div>
{% endblock bottom_help %}

{% block crds_info_box %}
{% endblock crds_info_box %}

