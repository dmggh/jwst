{% extends "base.html" %}

{% load stdtags %}

{% block contents %}

<h2>
    Browse {{browsed_file|gray}}     

    &nbsp;&nbsp;
    <a href='{{browsed_file|download_url}}'>
        <span style="font-size: 0.75em;">download</span>
    </a>

    {% if is_superuser %}
    &nbsp;&nbsp;
    <a href='/admin/interactive/fileblob/{{fileblob.id}}'>
        <span style="font-size: 0.75em;">admin</span>
    </a>
    {% endif %}

    {% include "browse_results_diff_link.html" %}

</h2> 

{% accordion "Database" %}
        {% if fileblob %}        
            <table border="1">
                <tr>
                    <td width="20%" align="left" class="label">CRDS Name</td>
                    <td>{{fileblob.pathname|exists_color}}</td>
                </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Uploaded Name</td>
                    <td>{{fileblob.uploaded_as}}</td>
                 </tr>
                <tr>
                    <td width="20%" align="left" class="label">Sha1sum</td>
                    {% if fileblob.sha1sum %}
                        <td>{{fileblob.sha1sum}}</td>
                    {% else %}
                        <td class="orange">undefined</td>
                    {% endif %}
                </tr>
                <tr>
                    <td width="20%" align="left" class="label">Size (bytes)</td>
                    <td>{{fileblob.size}}</td>
                </tr>
                <tr>
                    <td width="20%" align="left" class="label">Status</td>
                    <td class="{{fileblob.status_class}}">{{fileblob.status}}</td>
                </tr>
                
                 {% if fileblob.blacklisted_by %}
                     <tr>
                        <td width="20%" align="left" class="label">Blacklisted By</td>
                        <td>
                            {% for bl in fileblob.blacklisted_by %}
                                <span class="red">{{bl}}</span> &nbsp;&nbsp;
                            {% endfor %}
                        </td>
                     </tr>
                 {% endif %}
                 <tr>
                    <td width="20%" align="left" class="label">Reject Flag</td>
                    <td>{{fileblob.rejected}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Replaced By File Name</td>
                    <td>{{fileblob.replaced_by_filename}}</td>
                 </tr>
                
                {% if is_authenticated %}
                 <tr>
                    <td width="20%" align="left" class="label">Submitter</td>
                    <td>{{fileblob.deliverer_user}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Submitter Email</td>
                    <td>{{fileblob.deliverer_email}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Creator Name</td>
                    <td>{{fileblob.creator_name}}</td>
                 </tr>
                {% endif %}

                <tr>
                    <td width="20%" align="left" class="label">Description</td>
                    <td>{{fileblob.description}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Derived From</td>
                    <td>{{fileblob.derived_from}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Change Level</td>
                    <td>{{fileblob.change_level}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Delivery Date</td>
                    <td>{{fileblob.delivery_date|seconds}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Activation Date</td>
                    <td>{{fileblob.activation_date|seconds}}</td>
                 </tr>
                 {% if fileblob.type == "reference" %}
                     <tr>
                        <td width="20%" align="left" class="label">Comment</td>
                        <td>{{fileblob.comment}}</td>
                     </tr>
                     <tr>
                        <td width="20%" align="left" class="label">Pedigree</td>
                        <td>{{fileblob.pedigree}}</td>
                     </tr>
                      <tr>
                        <td width="20%" align="left" class="label">Useafter Date</td>
                        <td>{{fileblob.useafter_date|seconds}}</td>
                     </tr>
                     <tr>
                        <td width="20%" align="left" class="label">Aperture</td>
                        <td>{{fileblob.aperture}}</td>
                     </tr>
                 {% endif %}
            </table>
        {% else %}
            <p class="error">Error loading database record for 
                <span class="gray">{{browsed_file}}</span>
            </p>
        {% endif %}
{% endaccordion %}

{% accordion "Contents" %}
    <div class='program' id="file_contents">
        {{ file_contents|safe }}
        <br/><br/>
    </div>
{% endaccordion %}

{% if certify_results %}
    {% accordion "Certify Results"  {{certify_results.0|color_status}} %}
    <div class='program' id="certify_results">
        <pre>
{{ certify_results.1|safe }}
        </pre>
    </div>
    {% endaccordion %}    
{% endif %}

{% accordion "Past Actions" %}
    <table border="1">
        <tr>
            <th width="15%" align="center">Date</th>
            <th width="10%" align="center">Action</th>
            <th width="10%" align="center">User</th>
            <th width="30%" align="center">Why</th>
            <th width="20%" align="center">Details</th>
        </tr>
        {% for action in related_actions %}
        <tr>
            <td align="center">{{action.date|minutes}}</td>
            <td align="center">{{action.action}}</td>
            <td align="center">{{action.user}}</td>
            <td align="center">{{action.why}}</td>
            <td align="center">{{action.details}}</td>
        </tr>
        {% endfor %}
    </table>
{% endaccordion %}

{% accordion "Used By Files" %}
    <p>
        {% if used_by_files %}
            {% for line in used_by_files %}
                {{line|browse}}, 
            {% endfor %}
        {% else %}
            <b>no files</b>
        {% endif %}
    </p>
{% endaccordion %}
    
{% if match_paths %}
    {% accordion "Lookup Patterns" %}
    <table border="1">
        {% if match_paths %}
            {% for item in match_paths.0 %}
                <td><b>{{item.0|upper}}</b></td>
            {% endfor %}
            {% for match in match_paths %}
                <tr>
                {% for item in match %}
                    <td>{{item.1}}</td>
                {% endfor %}
                </tr>
            {% endfor %}
        {% else %}
            <tr><td><b>no matches</b></td></tr>
        {% endif %}
    </table>
    {% endaccordion %}
</div>
{% endif %}   

{% if tpn_text %}
    {% accordion "Reference Constraints (.tpn)" %}
<div id="tpn_text">
<pre class="program">
{{tpn_text}}
</pre>
</div>
    {% endaccordion %}
{% endif %}

{% if ld_tpn_text %}
    {% accordion "Rmap Constraints (_ld.tpn)" %}
<div id="ld_tpn_text">
<pre class="program">
{{ld_tpn_text}}
</pre>
</div>
    {% endaccordion %}
{% endif %}

<br/><br/>

{% endblock contents %}
