{% extends "base.html" %}

{% load stdtags %}

{% block contents %}

{% include "accordion.html" %}

{% if ".rmap" in browsed_file and is_authenticated %}
     <FORM name="edit_form" method="LINK" action="/edit_rmap/{{browsed_file}}">                
           <h2>Browse {{browsed_file|grey}}
                &nbsp;
                <a href="/edit_rmap" onclick="document.edit_form.submit(); return false;">
                    <span style="font-size: 0.75em;">edit</span>
                </a> 
                &nbsp;
                <a href='{{browsed_file|download_url:"hst"}}'>
                    <span style="font-size: 0.75em;">download</span>
                </a>
            </h2> 
     </FORM>
{% else %}
    <h2>
        Browse {{browsed_file|grey}}     
        <a href='{{browsed_file|download_url:"hst"}}'>
            <span style="font-size: 0.75em;">download</span>
        </a>
    </h2> 
{% endif %}    

<div class="accordion">

<h3><a href="#">Database</a></h3>
<div>
        {% if fileblob %}        
            <table border="1">
                 <tr>
                    <td width="20%" align="left" class="label">Submit Date</td>
                    <td>{{fileblob.delivery_date|seconds}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Status</td>
                    <td class="{{fileblob.status_class}}">{{fileblob.status}}</td>
                 </tr>
                 
                 {% if fileblob.blacklisted_by %}
                     <tr>
                        <td width="20%" align="left" class="label">Blacklisted By</td>
                        <td>
                            {% for bl in fileblob.blacklisted_by %}
                                <span class="error">{{bl}}</span> &nbsp;&nbsp;
                            {% endfor %}
                        </td>
                     </tr>
                {% endif %}
                
        {% if is_authenticated %}
                 <tr>
                    <td width="20%" align="left" class="label">Path</td>
                    <td>{{fileblob.pathname|exists_color}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Submitter</td>
                    <td>{{fileblob.deliverer_user}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Submitter Email</td>
                    <td>{{fileblob.deliverer_email}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Creator Name</td>
                    <td>{{fileblob.creator_name}}</td>
                 </tr>
       {% endif %}

                <tr>
                    <td width="20%" align="left" class="label">Description</td>
                    <td>{{fileblob.description}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Uploaded Name</td>
                    <td>{{fileblob.uploaded_as}}</td>
                 </tr>
                 {% if not fileblob.checksum_ok %}
                     <tr>
                        <td width="20%" align="left" class="label">Sha1sum</td>
                        {% if fileblob.sha1sum %}
                            <td class="error">{{fileblob.sha1sum}}</td>
                        {% else %}
                            <td class="orange">undefined</td>
                        {% endif %}
                     </tr>
                 {% endif %}
            </table>
        {% else %}
            <p class="error">Error loading database record for 
                <span class="grey">{{browsed_file}}</span>
            </p>
        {% endif %}
</div>

<h3><a href="#">Contents</a></h3>
<div>
    <div class='program' id="file_contents">
        {{ file_contents|safe }}
        <br/><br/>
    </div>  <!-- program -->
</div>  <!-- contents -->

<h3><a href="#">Past Actions</a></h3>
<div>
    <table border="1">
        <tr>
            <th width="15%" align="center">Date</th>
            <th width="10%" align="center">Action</th>
            <th width="10%" align="center">User</th>
            <th width="30%" align="center">Why</th>
            <th width="20%" align="center">Details</th>
        </tr>
        {% for action in related_actions %}
        <tr>
            <td align="center">{{action.date|minutes}}</td>
            <td align="center">{{action.action}}</td>
            <td align="center">{{action.user}}</td>
            <td align="center">{{action.why}}</td>
            <td align="center">{{action.details}}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<h3><a href="#">Used By Files</a></h3>
<div>
    <table>
        {% if used_by_files %}
            {% for line in used_by_files %}
                <tr><td>{{line|browse}}</td></tr>
            {% endfor %}
        {% else %}
            <tr><td><b>no files</b></td></tr>
        {% endif %}
    </table>
</div>
    
{% if match_paths %}
<h3><a href="#">Lookup Patterns</a></h2>
<div>
    <table border="1">
        {% if match_paths %}
            {% for item in match_paths.0 %}
                <td><b>{{item.0|upper}}</b></td>
            {% endfor %}
            {% for match in match_paths %}
                <tr>
                {% for item in match %}
                    <td>{{item.1}}</td>
                {% endfor %}
                </tr>
            {% endfor %}
        {% else %}
            <tr><td><b>no matches</b></td></tr>
        {% endif %}
    </table>
</div>
{% endif %}   

</div> <!-- accordian -->

<br/><br/>

{% endblock contents %}
