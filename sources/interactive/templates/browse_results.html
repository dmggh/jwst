{% extends "base.html" %}

{% load stdtags %}

{% block contents %}

<h2>Browse <a href='{{browsed_file|download_url:"hst"}}'>{{browsed_file|grey}}</a>
</h2> 

{% if status == "OK" %}
    <h3 class="success">
{% else %}
    <h3 class="error">
{% endif %}
        {{status}}
    </h3>
    
{% if not uploaded %}
<h3>CRDS Database</h3>
        {% if fileblob %}        
            <table border="1">
                 <tr>
                    <td width="20%" align="left" class="label">Delivery Date</td>
                    <td>{{fileblob.delivery_date|seconds}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Status</td>
                    <td class="{{fileblob.status_class}}">{{fileblob.status}}</td>
                 </tr>

       {% if is_authenticated %}
                 <tr>
                    <td width="20%" align="left" class="label">Path</td>
                    <td>{{fileblob.pathname|exists_color}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Submitter</td>
                    <td>{{fileblob.deliverer_user}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Submitter Email</td>
                    <td>{{fileblob.deliverer_email}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Creator Name</td>
                    <td>{{fileblob.creator_name}}</td>
                 </tr>
       {% endif %}

                 <tr>
                    <td width="20%" align="left" class="label">Blacklisted By</td>
                    <td>
                        {% if fileblob.blacklisted_by %}
                            {% for bl in fileblob.blacklisted_by %}
                                {{bl|browse}} ,&nbsp;
                            {% endfor %}
                        {% else %}
                            none
                        {% endif %}
                    </td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Description</td>
                    <td>{{fileblob.description}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Uploaded Name</td>
                    <td>{{fileblob.uploaded_as}}</td>
                 </tr>
                 <tr>
                    <td width="20%" align="left" class="label">Sha1sum</td>
                    {% if fileblob.sha1sum %}
                        {% if fileblob.checksum_ok %}
                           <td class="success">{{fileblob.sha1sum}}</td>
                        {% else %}
                           <td class="error">{{fileblob.sha1sum}}</td>
                        {% endif %}
                    {% else %}
                           <td class="orange">undefined</td>
                    {% endif %}
                 </tr>
            </table>
        {% else %}
            <p class="error">Error loading database record for 
                <span class="grey">{{browsed_file}}</span>
            </p>
        {% endif %}
{% else %}
    <h3>No Database (uploaded)</h3>
{% endif %}
    
<h3>File Actions</h3>
    <table border="1">
        <tr>
            <th width="15%" align="center">Date</th>
            <th width="10%" align="center">Action</th>
            <th width="10%" align="center">User</th>
            <th width="30%" align="center">Why</th>
            <th width="20%" align="center">Details</th>
        </tr>
        {% for action in related_actions %}
        <tr>
            <td align="center">{{action.date|minutes}}</td>
            <td align="center">{{action.action}}</td>
            <td align="center">{{action.user}}</td>
            <td align="center">{{action.why}}</td>
            <td align="center">{{action.details}}</td>
        </tr>
        {% endfor %}
    </table>

<h3>File Contents</h3>

    <div class='program' id="file_contents">
        {{ file_contents|safe }}
        
        <br/><br/>
    </div>

{% endblock contents %}
