

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Web Services &mdash; CRDS 7.1.7 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/stsci.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CRDS 7.1.7 documentation" href="index.html"/>
        <link rel="next" title="CRDS Rules (Mappings)" href="rmap_syntax.html"/>
        <link rel="prev" title="Using the CRDS Web Site" href="web_site_use.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="index.html" class="icon icon-home"> CRDS
            
            <img src="_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
              <div class="version">
                7.1
              </div>
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_use.html">Best References Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_tools.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_site_use.html">Using the CRDS Web Site</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Web Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#context-information">Context Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#centralized-default">Centralized Default</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipeline-echo">Pipeline Echo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#context-history">Context History</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#file-information">File Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#single-file-metadata">Single File Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-file-metadata">Multiple File Metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-references">Best References</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#single-header">Single Header</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-headers">Multiple Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selection-parameters">Selection Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#valid-dataset-ids">Valid Dataset IDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#matching-parameters-by-id">Matching Parameters By ID</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aui-interface-for-best-references">AUI Interface for Best References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-for-calibration-s-w-versions">Interface for Calibration S/W Versions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jsonrpc-protocol">JSONRPC Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sample-url-s">Sample URL’s</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#jwst-url">JWST URL</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hst-url">HST URL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#generic-request">Generic Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generic-response">Generic Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#demo-page">Demo Page</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rmap_syntax.html">CRDS Rules (Mappings)</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_use.html">Library Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference_conventions.html">Reference File Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">CRDS Database Access</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">CRDS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Web Services</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/web_services.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="web-services">
<h1>Web Services<a class="headerlink" href="#web-services" title="Permalink to this headline">¶</a></h1>
<p>The CRDS servers support a JSONRPC based service mechanism which enables
remote users to make calls to the CRDS server without installing the CRDS
Python based client library.   See <a class="reference external" href="http://json-rpc.org/wiki/specification">http://json-rpc.org/wiki/specification</a>
for more details on the JSONRPC protocol.</p>
<p>Users of the CRDS client library can access these JSONRPC functions using
the crds.client module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">crds</span> <span class="k">import</span> <span class="n">client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">get_default_context</span><span class="p">(</span><span class="s1">&#39;jwst&#39;</span><span class="p">)</span>
<span class="go">&#39;jwst_0101.pmap&#39;</span>
</pre></div>
</div>
<div class="section" id="context-information">
<h2>Context Information<a class="headerlink" href="#context-information" title="Permalink to this headline">¶</a></h2>
<p>The CRDS context is the version of CRDS rules used to select reference files.
The default CRDS context is maintained on the CRDS server and reported by
the function <em>get_default_context()</em>.   Institutional pipelines which are operating
decoupled from the CRDS server can post their actual cached context to the CRDS
server for retrieval by <em>get_remote_context()</em>.</p>
<div class="section" id="centralized-default">
<h3>Centralized Default<a class="headerlink" href="#centralized-default" title="Permalink to this headline">¶</a></h3>
<p><strong>get_default_context(observatory)</strong></p>
<p>get_default_context() returns the name of the context which is
currently in use by default in the archive pipeline, e.g. ‘jwst_0001.pmap’.
This value is set and maintained on the CRDS Server.   The actual pipeline context
differs from this commanded valuer until the pipeline is synchronized with the CRDS
server using cron_sync.</p>
<p>The commanded default can be obtained using the CRDS client library as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">crds</span> <span class="k">import</span> <span class="n">client</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">get_default_context</span><span class="p">(</span><span class="s1">&#39;jwst&#39;</span><span class="p">)</span>
<span class="s1">&#39;jwst_0101.pmap&#39;</span>
</pre></div>
</div>
<p>See the explanation of JSONRPC requests and responses below for a language and library
neutral example of calling the same CRDS web service using the command line program “curl”.</p>
</div>
<div class="section" id="pipeline-echo">
<h3>Pipeline Echo<a class="headerlink" href="#pipeline-echo" title="Permalink to this headline">¶</a></h3>
<p><strong>get_remote_context(observatory, pipeline_name)</strong></p>
<p>get_remote_context() returns the name of the context last reported as
synced by the specified <em>pipeline_name</em> (e.g. ‘jwst-ops-pipeline’).  This is
the value stored in a pipeline’s CRDS cache and echoed back to the CRDS server
when the cache is synchronized.  Since this value is inapplicable if a pipeline
is run in “remote” mode computing best references on the CRDS Server, the
generally preferred value is from get_default_context() since it always
reflects the intended operational context regardless of the pipeline’s CRDS
mode.</p>
<p>The actual default context for a pipeline can be obtained as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">crds</span> <span class="k">import</span> <span class="n">client</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">get_remote_context</span><span class="p">(</span><span class="s1">&#39;jwst&#39;</span><span class="p">,</span> <span class="s1">&#39;jwst-ops-pipeline&#39;</span><span class="p">)</span>
<span class="s1">&#39;jwst_0101.pmap&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="context-history">
<h3>Context History<a class="headerlink" href="#context-history" title="Permalink to this headline">¶</a></h3>
<p>CRDS makes the history of contexts which have been activated in the pipeline as
the operational context via the get_context_history() web service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">get_context_history</span><span class="p">(</span><span class="s2">&quot;jwst&quot;</span><span class="p">)</span>
<span class="go">[(&#39;2012-09-06 00:00:00&#39;, &#39;jwst.pmap&#39;, &#39;Bootstrap mappings&#39;),</span>
<span class="go"> (&#39;2012-09-27 00:00:00&#39;,</span>
<span class="go">  &#39;jwst_0000.pmap&#39;,</span>
<span class="go">  &#39;First rules and references from jwst_gentools stub development cloning.&#39;),</span>
<span class="go"> (&#39;2013-04-13 00:00:00&#39;, &#39;jwst_0001.pmap&#39;, &#39;Linearity and dark files.&#39;),</span>
<span class="go"> (&#39;2013-07-31 00:00:00&#39;, &#39;jwst_0002.pmap&#39;, &#39;Dark and Mask files.&#39;),</span>
<span class="go"> (&#39;2013-09-04 00:00:00&#39;,</span>
<span class="go">  &#39;jwst_0003.pmap&#39;,</span>
<span class="go">  &#39;Absolute Calibration (photom) additions and replacements.&#39;),</span>
<span class="go"> (&#39;2013-11-25 09:00:03&#39;, &#39;jwst_0005.pmap&#39;, &#39;set by system&#39;),</span>
<span class="go"> (&#39;2014-03-19 10:51:19&#39;,</span>
<span class="go">  &#39;jwst_0012.pmap&#39;,</span>
<span class="go">  &#39;Updated for META.INSTRUMENT.TYPE switch to META.INSTRUMENT.NAME\r\nNew linearity files for all instruments\r\nNew saturation files and rmaps for all instruments&#39;),</span>

<span class="go">    ...</span>

<span class="go"> (&#39;2015-11-18 12:58:13&#39;,</span>
<span class="go">  &#39;jwst_0105.pmap&#39;,</span>
<span class="go">  &#39;Declared various EXP_TYPE as N/A for 15 WCS types for MIRI, NIRCAM, NIRSPEC. Replacement MIRI distortion references for ticket #238.&#39;)</span>
<span class="go">  ]</span>
</pre></div>
</div>
<p>Each entry in the context history is a list/tuple of form:  (start_date, context, description).</p>
<p>Adjacent entries are consecutive,  the start date of the one context is the end date of the previous context.</p>
<p>The context history is in first-to-last order and it is possible that the context will be regressed to a prior
version;  consequently,  there is no guarantee that context names will monotonically increase.  At times several
file submissions and created contexts are activated en masse via the last created context;  consequently,  there
is no guarantee that pmap serial numbers will increase or decrease by one.</p>
</div>
</div>
<div class="section" id="file-information">
<h2>File Information<a class="headerlink" href="#file-information" title="Permalink to this headline">¶</a></h2>
<p>The CRDS server maintains a catalog of basic metadata for the rules and reference
files managed by CRDS.   Catalog information cab be</p>
<div class="section" id="single-file-metadata">
<h3>Single File Metadata<a class="headerlink" href="#single-file-metadata" title="Permalink to this headline">¶</a></h3>
<p><strong>get_file_info(pipeline_context, filename)</strong></p>
<p>Return a dictionary of CRDS catalog information about <code class="xref py py-obj docutils literal notranslate"><span class="pre">filename</span></code>.  For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">crds</span> <span class="k">import</span> <span class="n">client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">get_file_info</span><span class="p">(</span><span class="s2">&quot;jwst&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_flat_0023.fits&quot;</span><span class="p">)</span>
<span class="go">{&#39;activation_date&#39;: &#39;2014-09-25 18:30:27&#39;,</span>
<span class="go"> &#39;aperture&#39;: &#39;none&#39;,</span>
<span class="go"> &#39;blacklisted&#39;: &#39;false&#39;,</span>
<span class="go"> &#39;change_level&#39;: &#39;severe&#39;,</span>
<span class="go"> &#39;comment&#39;: &#39;cdp-2 from fm testing&#39;,</span>
<span class="go"> &#39;creator_name&#39;: &#39;jwst build 3 team&#39;,</span>
<span class="go"> &#39;deliverer_user&#39;: &#39;homer&#39;,</span>
<span class="go"> &#39;delivery_date&#39;: &#39;2014-09-20 07:55:56&#39;,</span>
<span class="go"> &#39;derived_from&#39;: &#39;none&#39;,</span>
<span class="go"> &#39;description&#39;: &#39;all references from jwst build 3 delivery 2. update miri flats, fringes, straymasks, resets, lastframes, nirspec flat.&#39;,</span>
<span class="go"> &#39;filekind&#39;: &#39;flat&#39;,</span>
<span class="go"> &#39;instrument&#39;: &#39;miri&#39;,</span>
<span class="go"> &#39;name&#39;: &#39;jwst_miri_flat_0023.fits&#39;,</span>
<span class="go"> &#39;observatory&#39;: &#39;jwst&#39;,</span>
<span class="go"> &#39;pedigree&#39;: &#39;ground&#39;,</span>
<span class="go"> &#39;reference_file_type&#39;: &#39;flat&#39;,</span>
<span class="go"> &#39;rejected&#39;: &#39;false&#39;,</span>
<span class="go"> &#39;replaced_by_filename&#39;: &#39;&#39;,</span>
<span class="go"> &#39;sha1sum&#39;: &#39;3f0c92aae539cb67f8e8823cc6815130018948f7&#39;,</span>
<span class="go"> &#39;size&#39;: &#39;10592640&#39;,</span>
<span class="go"> &#39;state&#39;: &#39;operational&#39;,</span>
<span class="go"> &#39;type&#39;: &#39;reference&#39;,</span>
<span class="go"> &#39;uploaded_as&#39;: &#39;jwst_miri_flat_0016.fits&#39;,</span>
<span class="go"> &#39;useafter_date&#39;: &#39;2050-01-01 00:00:00&#39;}</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-file-metadata">
<h3>Multiple File Metadata<a class="headerlink" href="#multiple-file-metadata" title="Permalink to this headline">¶</a></h3>
<p><strong>get_file_info_map(observatory, files=None, fields=None)</strong></p>
<p>get_file_info_map() is a multi-file version of get_info_map() which returns
the information for several files with one call.  If <code class="xref py py-obj docutils literal notranslate"><span class="pre">files</span></code> is not specified
then get_file_info_map() returns info for all files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">crds</span> <span class="k">import</span> <span class="n">client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">get_file_info_map</span><span class="p">(</span><span class="s2">&quot;jwst&quot;</span><span class="p">)</span>
<span class="go">{&#39;jwst.pmap&#39;: {&#39;activation_date&#39;: &#39;2012-07-31 00:00:00&#39;,</span>
<span class="go"> &#39;aperture&#39;: &#39;none&#39;,</span>
<span class="go"> &#39;blacklisted&#39;: &#39;false&#39;,</span>
<span class="go"> &#39;change_level&#39;: &#39;severe&#39;,</span>
<span class="go"> &#39;comment&#39;: &#39;none&#39;,</span>
<span class="go"> &#39;creator_name&#39;: &#39;todd miller&#39;,</span>
<span class="go"> &#39;deliverer_user&#39;: &#39;crds&#39;,</span>
<span class="go"> &#39;delivery_date&#39;: &#39;2014-03-26 08:49:23&#39;,</span>
<span class="go"> &#39;derived_from&#39;: &#39;created by hand 07-31-2012&#39;,</span>
<span class="go"> &#39;description&#39;: &#39;initial mass file import&#39;,</span>
<span class="go"> &#39;filekind&#39;: &#39;&#39;,</span>
<span class="go"> &#39;history&#39;: &#39;none&#39;,</span>
<span class="go"> &#39;instrument&#39;: &#39;&#39;,</span>
<span class="go"> &#39;name&#39;: &#39;jwst.pmap&#39;,</span>
<span class="go"> &#39;observatory&#39;: &#39;jwst&#39;,</span>
<span class="go"> &#39;pedigree&#39;: &#39;&#39;,</span>
<span class="go"> &#39;reference_file_type&#39;: &#39;&#39;,</span>
<span class="go"> &#39;rejected&#39;: &#39;false&#39;,</span>
<span class="go"> &#39;replaced_by_filename&#39;: &#39;&#39;,</span>
<span class="go"> &#39;sha1sum&#39;: &#39;caf080abe09236165885f383045c59e8957a80ce&#39;,</span>
<span class="go"> &#39;size&#39;: &#39;392&#39;,</span>
<span class="go"> &#39;state&#39;: &#39;archived&#39;,</span>
<span class="go"> &#39;type&#39;: &#39;mapping&#39;,</span>
<span class="go"> &#39;uploaded_as&#39;: &#39;jwst.pmap&#39;,</span>
<span class="go"> &#39;useafter_date&#39;: &#39;2012-07-31 00:00:00&#39;},</span>
<span class="go"> ...</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Returns the info:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">filename</span> <span class="p">:</span> <span class="p">{</span> <span class="n">info</span><span class="p">,</span> <span class="o">...</span> <span class="p">},</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>on <code class="xref py py-obj docutils literal notranslate"><span class="pre">files</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">observatory</span></code>.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">fields</span></code> can be used to limit info returned to specified keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;activation_date&#39;</span><span class="p">,</span> <span class="s1">&#39;aperture&#39;</span><span class="p">,</span> <span class="s1">&#39;blacklisted&#39;</span><span class="p">,</span> <span class="s1">&#39;change_level&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">,</span>
 <span class="s1">&#39;creator_name&#39;</span><span class="p">,</span> <span class="s1">&#39;deliverer_user&#39;</span><span class="p">,</span> <span class="s1">&#39;delivery_date&#39;</span><span class="p">,</span> <span class="s1">&#39;derived_from&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span>
 <span class="s1">&#39;filekind&#39;</span><span class="p">,</span> <span class="s1">&#39;instrument&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;observatory&#39;</span><span class="p">,</span> <span class="s1">&#39;pedigree&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_file_type&#39;</span><span class="p">,</span>
 <span class="s1">&#39;rejected&#39;</span><span class="p">,</span> <span class="s1">&#39;replaced_by_filename&#39;</span><span class="p">,</span> <span class="s1">&#39;sha1sum&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span>
 <span class="s1">&#39;uploaded_as&#39;</span><span class="p">,</span> <span class="s1">&#39;useafter_date&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>If <code class="xref py py-obj docutils literal notranslate"><span class="pre">fields</span></code> is not specified then get_file_info_map() returns all fields.</p>
</div>
</div>
<div class="section" id="best-references">
<h2>Best References<a class="headerlink" href="#best-references" title="Permalink to this headline">¶</a></h2>
<div class="section" id="single-header">
<h3>Single Header<a class="headerlink" href="#single-header" title="Permalink to this headline">¶</a></h3>
<p><strong>get_best_references(context, header, reftypes)</strong></p>
<p>get_best_references() matches a set of parameters <em>header</em> against the lookup
rules specified by the pipeline mapping <em>context</em> to return a mapping of
type names onto recommended reference file names.</p>
<p>A suitable <em>context</em> string can be obtained from get_default_context() above,
although any archived CRDS context file can be specified.</p>
<p>The <em>header</em> parameter of get_best_references is nominally a JSON object which
maps CRDS parkey names onto dataset file header values.   CRDS parkey names can
be located by browsing reference mappings (.rmap’s) and looking at the <em>parkey</em>
header parameter of the rmap.</p>
<p>For JWST,  the rmap parkeys (matching parameter names) are currently specified
as JWST stpipe data model dotted identifiers.  Example JSON for the get_best_references
<em>header</em> parameter for JWST is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;meta.instrument.type&quot;</span><span class="p">:</span><span class="s2">&quot;fgs&quot;</span><span class="p">,</span>
  <span class="s2">&quot;meta.instrument.detector&quot;</span><span class="p">:</span><span class="s2">&quot;fgs1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;meta.instrument.filter&quot;</span><span class="p">:</span><span class="s2">&quot;any&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>For JWST,  it is also possible to use the equivalent FITS header keyword,  as
defined by the data model schema, to determine best references:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;instrume&quot;</span><span class="p">:</span><span class="s2">&quot;fgs&quot;</span><span class="p">,</span>
  <span class="s2">&quot;detector&quot;</span><span class="p">:</span><span class="s2">&quot;fgs1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;filter&quot;</span><span class="p">:</span><span class="s2">&quot;any&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>For HST,  GEIS or FITS header keyword names are supported.</p>
<p><em>reftypes</em> should be a json array of strings,  each naming a single desired
reference type.  If reftypes is passed as null,  recommended references for
all reference types are returned.   Reference types which are defined for an
instrument but which are not applicable to the mode defined by <em>header</em> are
returned with the value <em>NOT FOUND n/a</em>.</p>
<p>Example JSON for <em>reftypes</em> might be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;amplifier&quot;</span><span class="p">,</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Because <strong>get_best_references</strong> determines references for a list of types,  lookup
errors are reported by setting the value of a reference type to
“NOT FOUND ” + error_message.   A value of “NOT FOUND n/a” indicates that CRDS
determined that a particular reference type does not apply to the given
parameter set.</p>
</div>
<div class="section" id="multiple-headers">
<h3>Multiple Headers<a class="headerlink" href="#multiple-headers" title="Permalink to this headline">¶</a></h3>
<p><strong>get_best_references_by_header_map(context, header_map, reftypes)</strong></p>
<p>This service is an adaptation of get_best_references() to support returning
best references for multiple datasets with a single service call.  All
parameters are as for get_best_references() with the modification that <em>header</em>
above is replaced with a mapping from multiple dataset ids to their
corresponding headers, i.e. <em>header_map</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">dataset_id</span> <span class="p">:</span> <span class="n">header</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>The return value is likewise adapted to return best references for multiple
datasets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">dataset_id</span> <span class="p">:</span> <span class="n">best_references</span><span class="p">,</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>Where <em>dataset_id</em> is nominally an HST IPPPSSOOT id (e.g. ‘I9ZF01010’) or JWST
dataset identifier (TBD).  Since <em>dataset_id</em> is only a keyword not used in best
references computations, it can be any unique abstract identifier consisting of
alphanumeric characters, period, colon, hyphen, or plus sign of 128 characters
or less.</p>
</div>
<div class="section" id="selection-parameters">
<h3>Selection Parameters<a class="headerlink" href="#selection-parameters" title="Permalink to this headline">¶</a></h3>
<p><strong>get_required_parkeys(context)</strong></p>
<p>Return a mapping from instruments to lists of parameter names required to
compute bestrefs under <code class="xref py py-obj docutils literal notranslate"><span class="pre">context</span></code>,  i.e. matching header keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">instrument</span> <span class="p">:</span> <span class="p">[</span> <span class="n">matching_parkey_name</span><span class="p">,</span> <span class="o">...</span> <span class="p">],</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>In CRDS the matching parameters are defined by each set of rules, e.g. for
one HST context (hst_0366.pmap) the reference file selection parameters
for all instruments are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;acs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">,</span> <span class="s1">&#39;APERTURE&#39;</span><span class="p">,</span> <span class="s1">&#39;ATODCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;BIASCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;CCDAMP&#39;</span><span class="p">,</span> <span class="s1">&#39;CCDCHIP&#39;</span><span class="p">,</span>
     <span class="s1">&#39;CCDGAIN&#39;</span><span class="p">,</span> <span class="s1">&#39;CRCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;DARKCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;DETECTOR&#39;</span><span class="p">,</span> <span class="s1">&#39;DQICORR&#39;</span><span class="p">,</span>
     <span class="s1">&#39;DRIZCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER1&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER2&#39;</span><span class="p">,</span> <span class="s1">&#39;FLASHCUR&#39;</span><span class="p">,</span> <span class="s1">&#39;FLATCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;FLSHCORR&#39;</span><span class="p">,</span>
     <span class="s1">&#39;FW1OFFST&#39;</span><span class="p">,</span> <span class="s1">&#39;FW2OFFST&#39;</span><span class="p">,</span> <span class="s1">&#39;FWSOFFST&#39;</span><span class="p">,</span> <span class="s1">&#39;GLINCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;LTV1&#39;</span><span class="p">,</span> <span class="s1">&#39;LTV2&#39;</span><span class="p">,</span> <span class="s1">&#39;NAXIS1&#39;</span><span class="p">,</span>
     <span class="s1">&#39;NAXIS2&#39;</span><span class="p">,</span> <span class="s1">&#39;OBSTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;PCTECORR&#39;</span><span class="p">,</span> <span class="s1">&#39;PHOTCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;REFTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;RPTCORR&#39;</span><span class="p">,</span>
     <span class="s1">&#39;SHADCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;SHUTRPOS&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;XCORNER&#39;</span><span class="p">,</span> <span class="s1">&#39;YCORNER&#39;</span><span class="p">],</span>
<span class="s1">&#39;cos&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">,</span> <span class="s1">&#39;ALGNCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;BADTCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;BRSTCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;DEADCORR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DETECTOR&#39;</span><span class="p">,</span> <span class="s1">&#39;EXPTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;FLATCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUXCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;LIFE_ADJ&#39;</span><span class="p">,</span> <span class="s1">&#39;OBSMODE&#39;</span><span class="p">,</span> <span class="s1">&#39;OBSTYPE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OPT_ELEM&#39;</span><span class="p">,</span> <span class="s1">&#39;REFTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;TDSCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRCECORR&#39;</span><span class="p">,</span> <span class="s1">&#39;WALKCORR&#39;</span><span class="p">],</span>
<span class="s1">&#39;nicmos&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">,</span> <span class="s1">&#39;CAMERA&#39;</span><span class="p">,</span> <span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER&#39;</span><span class="p">,</span> <span class="s1">&#39;NREAD&#39;</span><span class="p">,</span> <span class="s1">&#39;OBSMODE&#39;</span><span class="p">,</span> <span class="s1">&#39;READOUT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;REFTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMP_SEQ&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME-OBS&#39;</span><span class="p">],</span>
 <span class="s1">&#39;stis&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">,</span> <span class="s1">&#39;APERTURE&#39;</span><span class="p">,</span> <span class="s1">&#39;BINAXIS1&#39;</span><span class="p">,</span> <span class="s1">&#39;BINAXIS2&#39;</span><span class="p">,</span> <span class="s1">&#39;CCDAMP&#39;</span><span class="p">,</span> <span class="s1">&#39;CCDGAIN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCDOFFST&#39;</span><span class="p">,</span>
      <span class="s1">&#39;CENWAVE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;DETECTOR&#39;</span><span class="p">,</span> <span class="s1">&#39;OBSTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OPT_ELEM&#39;</span><span class="p">,</span> <span class="s1">&#39;REFTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME-OBS&#39;</span><span class="p">],</span>
 <span class="s1">&#39;wfc3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">,</span> <span class="s1">&#39;APERTURE&#39;</span><span class="p">,</span> <span class="s1">&#39;ATODCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;BIASCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;BINAXIS1&#39;</span><span class="p">,</span> <span class="s1">&#39;BINAXIS2&#39;</span><span class="p">,</span> <span class="s1">&#39;CCDAMP&#39;</span><span class="p">,</span>
      <span class="s1">&#39;CCDGAIN&#39;</span><span class="p">,</span> <span class="s1">&#39;CHINJECT&#39;</span><span class="p">,</span> <span class="s1">&#39;DARKCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;DETECTOR&#39;</span><span class="p">,</span> <span class="s1">&#39;DQICORR&#39;</span><span class="p">,</span> <span class="s1">&#39;DRIZCORR&#39;</span><span class="p">,</span>
      <span class="s1">&#39;FILTER&#39;</span><span class="p">,</span> <span class="s1">&#39;FLASHCUR&#39;</span><span class="p">,</span> <span class="s1">&#39;FLATCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;FLSHCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;PHOTCORR&#39;</span><span class="p">,</span> <span class="s1">&#39;REFTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMP_SEQ&#39;</span><span class="p">,</span>
      <span class="s1">&#39;SHUTRPOS&#39;</span><span class="p">,</span> <span class="s1">&#39;SUBARRAY&#39;</span><span class="p">,</span> <span class="s1">&#39;SUBTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME-OBS&#39;</span><span class="p">],</span>
 <span class="s1">&#39;wfpc2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">,</span> <span class="s1">&#39;ATODGAIN&#39;</span><span class="p">,</span> <span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER1&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER2&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTNAM1&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTNAM2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;IMAGETYP&#39;</span><span class="p">,</span> <span class="s1">&#39;LRFWAVE&#39;</span><span class="p">,</span> <span class="s1">&#39;MODE&#39;</span><span class="p">,</span> <span class="s1">&#39;REFTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SERIALS&#39;</span><span class="p">,</span> <span class="s1">&#39;SHUTTER&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The required parkeys can be used to reduce a complete file header to only those keywords
necessary to select references under the given context.</p>
</div>
<div class="section" id="valid-dataset-ids">
<h3>Valid Dataset IDs<a class="headerlink" href="#valid-dataset-ids" title="Permalink to this headline">¶</a></h3>
<p><strong>get_dataset_ids(context, instrument)</strong></p>
<p>CRDS interacts with the archive to obtain matching parameters for to compute
best references for particular datasets.  Each parameter set corresponds to a
data set ID.  A list of the valid dataset IDs with respect to a particular CRDS
context (or date) can be obtained as follows.</p>
<p>To obtain current best references specify the context using a date:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_dataset_ids</span><span class="p">(</span><span class="s2">&quot;2016-01-01T00:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;miri&quot;</span><span class="p">)</span>
<span class="go">[&#39;JW80500017001_02101_00001.MIRIFUSHORT:JW80500017001_02101_00001.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;J80500020001_02101_00001.MIRIFUSHORT:JW80500020001_02101_00001.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00001.MIRIFUSHORT:JW80500018001_02101_00001.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;JW80500020001_02101_00001.MIRIFULONG:JW80500020001_02101_00001.MIRIFULONG&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00002.MIRIFULONG:JW80500018001_02101_00002.MIRIFULONG&#39;,</span>
<span class="go"> &#39;JW80500009001_02101_00001.MIRIMAGE:JW80500009001_02101_00001.MIRIMAGE&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00001.MIRIFULONG:JW80500018001_02101_00001.MIRIFULONG&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00002.MIRIFUSHORT:JW80500018001_02101_00002.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;JW80500003001_02101_00001.MIRIMAGE:JW80500003001_02101_00001.MIRIMAGE&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00003.MIRIFUSHORT:JW80500018001_02101_00003.MIRIFUSHORT&#39;]</span>
</pre></div>
</div>
<p>Alternately the abstract default context can be specified as “&lt;project&gt;-operational”, as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_dataset_ids</span><span class="p">(</span><span class="s2">&quot;jwst-operational&quot;</span><span class="p">,</span> <span class="s2">&quot;miri&quot;</span><span class="p">)</span>
<span class="go">[&#39;JW80500017001_02101_00001.MIRIFUSHORT:JW80500017001_02101_00001.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;J80500020001_02101_00001.MIRIFUSHORT:JW80500020001_02101_00001.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00001.MIRIFUSHORT:JW80500018001_02101_00001.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;JW80500020001_02101_00001.MIRIFULONG:JW80500020001_02101_00001.MIRIFULONG&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00002.MIRIFULONG:JW80500018001_02101_00002.MIRIFULONG&#39;,</span>
<span class="go"> &#39;JW80500009001_02101_00001.MIRIMAGE:JW80500009001_02101_00001.MIRIMAGE&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00001.MIRIFULONG:JW80500018001_02101_00001.MIRIFULONG&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00002.MIRIFUSHORT:JW80500018001_02101_00002.MIRIFUSHORT&#39;,</span>
<span class="go"> &#39;JW80500003001_02101_00001.MIRIMAGE:JW80500003001_02101_00001.MIRIMAGE&#39;,</span>
<span class="go"> &#39;JW80500018001_02101_00003.MIRIFUSHORT:JW80500018001_02101_00003.MIRIFUSHORT&#39;]</span>
</pre></div>
</div>
<p>Dataset IDs have a grammar like this for HST:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">product_id</span><span class="o">&gt;</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">exposure_id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Dataset IDs currently have a grammar like this for JWST:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span>     <span class="p">:</span><span class="o">=</span>  <span class="o">&lt;</span><span class="n">whole</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">part</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">whole</span><span class="o">&gt;</span>  <span class="p">:</span><span class="o">=</span>  <span class="o">&lt;</span><span class="n">filesetname</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">detector</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">part</span><span class="o">&gt;</span>   <span class="p">:</span><span class="o">=</span>  <span class="o">&lt;</span><span class="n">filesetname</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">detector</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>As can be seen above, currently JWST IDs are redundant and &lt;whole&gt; and &lt;part&gt;
are identical.  However, conceptually the IDs have that relationship and may be
further elaborated and differentiated in later builds (post-jwst-build-7).  In
such a case,  several exposure level IDs (&lt;parts&gt;’s) might have an identical
common root (&lt;whole&gt;).</p>
<p>In both cases it’s possible to specify either half of an ID returned by
get_dataset_ids() to request matching parameters or best references using the
services below.</p>
<p>For HST requesting parameters using only the &lt;product_id&gt; returns the
parameters associated with the full two part ID for every exposure of the
product.  Requesting the parameters using only the &lt;exposure_id&gt; returns the
references associated with processing that exposure.</p>
<p>For JWST, conceptually the same behavior will be preserved, so while either
half of an ID will currently return the same parameters, at a future date the
&lt;whole&gt; part may return all references associated with all exposures of a
single high level product, and the &lt;part&gt; component will only return the
references associated with processing that particular exposure.</p>
</div>
<div class="section" id="matching-parameters-by-id">
<h3>Matching Parameters By ID<a class="headerlink" href="#matching-parameters-by-id" title="Permalink to this headline">¶</a></h3>
<p><strong>get_dataset_headers_by_id(context_specifier, ids, datasets_since)</strong></p>
<p>CRDS fetches best reference matching parameters indirectly from the archive database.
The <em>get_dataset_headers_by_id()</em> function can be used to return the parameters required
to compute best references associated with the specified dataset ids:</p>
<p><em>context_specifier</em> is a date-based CRDS context specifier,  e.g.:  jwst_0192.pmap, 2015-05-25T00:00:27, jwst-operational</p>
<p><em>ids</em> is a list of archive dataset id strings as shown above.   A maximum of 200 IDs should be requested per call.</p>
<p><em>datasets_since</em> is an optional cut-off date for datasets.  If specified, only datasets acquired after that date are returned.</p>
<p>An example call using the CRDS Python client is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_dataset_headers_by_id</span><span class="p">(</span><span class="s2">&quot;2016-01-01&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;JW96090001004_03101_00001.NRCB2&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
<span class="go">{&#39;JW96090001004_03101_00001.NRCB2&#39;: {&#39;META.EXPOSURE.READPATT&#39;: &#39;BRIGHT1&#39;,</span>
<span class="go"> &#39;META.EXPOSURE.TYPE&#39;: &#39;NRC_IMAGE&#39;,</span>
<span class="go"> &#39;META.INSTRUMENT.CHANNEL&#39;: &#39;SHORT&#39;,</span>
<span class="go"> &#39;META.INSTRUMENT.DETECTOR&#39;: &#39;NRCB2&#39;,</span>
<span class="go"> &#39;META.INSTRUMENT.FILTER&#39;: &#39;F150W2&#39;,</span>
<span class="go"> &#39;META.INSTRUMENT.NAME&#39;: &#39;NIRCAM&#39;,</span>
<span class="go"> &#39;META.INSTRUMENT.PUPIL&#39;: &#39;CLEAR&#39;,</span>
<span class="go"> &#39;META.SUBARRAY.NAME&#39;: &#39;FULL&#39;}}</span>
</pre></div>
</div>
</div>
<div class="section" id="aui-interface-for-best-references">
<h3>AUI Interface for Best References<a class="headerlink" href="#aui-interface-for-best-references" title="Permalink to this headline">¶</a></h3>
<p><strong>get_aui_best_references(date, ids)</strong></p>
<p>The CRDS server can compute the best references for a list of data set ids
using the <em>get_aui_best_references()</em> function.  The dataset ids must be
compatible with those returned by <em>get_dataset_ids()</em> above.  Examples below
are fully functional at this time but actual IDs and parameter sets may change
during the course of development; use get_dataset_ids() documented above to
obtain up-to-date example IDs.</p>
<p><em>date</em> is a date-based CRDS context specifier, e.g.: jwst_0192.pmap,
2015-05-25T00:00:27, jwst-operational</p>
<p><em>ids</em> is a list of valid archive dataset ids.  For JWST it’s currently natural
and supported to use either half (currently identical) of the dataset IDs as
specified in get_dataset_ids() above.  Using a “half-ID” is shown below.
Ultimately the first half will identify a group of exposures and the second
half will identify a single exposure in the group.  A maximum of 200 ids should
be requested per call.</p>
<p>An examople call using the CRDS Python client is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_aui_best_references</span><span class="p">(</span><span class="s2">&quot;2016-01-01&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;JW82500001003_02102_00001.NRCA1&#39;</span><span class="p">,</span><span class="s1">&#39;JW82500001003_02102_00001.NRCA3&#39;</span><span class="p">])</span>
<span class="go">{&#39;JW82500001003_02102_00001.NRCA1&#39;: [True,</span>
<span class="go">  [&#39;jwst_nircam_ipc_0001.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_linearity_0020.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_distortion_0001.asdf&#39;,</span>
<span class="go">   &#39;jwst_nircam_drizpars_0001.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_area_0001.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_flat_0000.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_saturation_0030.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_photom_0031.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_dark_0030.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_gain_0000.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_mask_0010.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_readnoise_0000.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_superbias_0001.fits&#39;]],</span>
<span class="go"> &#39;JW82500001003_02102_00001.NRCA3&#39;: [True,</span>
<span class="go">  [&#39;jwst_nircam_ipc_0003.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_linearity_0022.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_distortion_0003.asdf&#39;,</span>
<span class="go">   &#39;jwst_nircam_drizpars_0001.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_area_0001.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_flat_0003.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_saturation_0032.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_photom_0033.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_dark_0032.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_gain_0002.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_mask_0012.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_readnoise_0002.fits&#39;,</span>
<span class="go">   &#39;jwst_nircam_superbias_0003.fits&#39;]],</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>The value returned is a mapping from dataset ids to a pair of values.  The
first value of the id result pair is a boolean with the sense “completed
successfully”.</p>
<p>The second value has a variable type depending on the boolean value.  If the ID
was successful, the second value of the pair is a list of file names.  If the
ID was unsuccessful, the second value of the pair is a string describing the
error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_aui_best_references</span><span class="p">(</span><span class="s2">&quot;2016-01-01&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;JW96090001004_03101_00001.NRCB5&#39;</span><span class="p">])</span>
<span class="go">{&#39;JW96090001004_03101_00001.NRCB5&#39;: [False,</span>
<span class="go">  &quot;NOT FOUND dataset ID does not exist &#39;JW96090001004_03101_00001.NRCB5&#39;&quot;]}</span>
</pre></div>
</div>
<p>Although it is possible for errors to occur on a per-type basis, for this
interface specific types which result in lookup errors (e.g. flat) are dropped
from the results.  The net effect is that the list of files returned includes
only those types that could be successfully assigned with the given context
(date) and parameter set. Types which are assigned the value N/A are also
silently dropped.</p>
<p>Under the hood the <em>get_aui_best_references()</em> function is a language agnostic JSONRPC call
which can be called from the UNIX command line by e.g. “curl” as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;method&quot;: &quot;get_aui_best_references&quot;, &quot;params&quot;: [&quot;2016-01-01&quot;, [&quot;JW80500017001_02101_00001.MIRIFUSHORT&quot;]], &quot;id&quot;: 1}&#39;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jwst</span><span class="o">-</span><span class="n">crds</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">json</span><span class="o">/</span>
<span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">25</span> <span class="n">Jul</span> <span class="mi">2016</span> <span class="mi">20</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">13</span> <span class="n">GMT</span>
<span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<span class="n">X</span><span class="o">-</span><span class="n">Frame</span><span class="o">-</span><span class="n">Options</span><span class="p">:</span> <span class="n">SAMEORIGIN</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">rpc</span>
<span class="n">Via</span><span class="p">:</span> <span class="mf">1.1</span> <span class="n">jwst</span><span class="o">-</span><span class="n">crds</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span>
<span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>

<span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;JW80500017001_02101_00001.MIRIFUSHORT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">true</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;jwst_miri_ipc_0005.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_fringe_0018.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_linearity_0010.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_distortion_0010.asdf&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_specwcs_0003.asdf&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_drizpars_0001.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_v2v3_0003.asdf&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_wavelengthrange_0001.asdf&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_regions_0003.asdf&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_wcsregions_0001.json&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_flat_0036.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_saturation_0013.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_photom_0011.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_dark_0031.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_gain_0004.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_straymask_0006.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_reset_0018.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_lastframe_0018.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_mask_0013.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;jwst_miri_readnoise_0005.fits&quot;</span><span class="p">]]}}</span>
</pre></div>
</div>
</div>
<div class="section" id="interface-for-calibration-s-w-versions">
<h3>Interface for Calibration S/W Versions<a class="headerlink" href="#interface-for-calibration-s-w-versions" title="Permalink to this headline">¶</a></h3>
<p><strong>get_system_versions(master_version, context)</strong></p>
<p>The versions of calibration software components for a particular s/w release
will nominally be recorded in CRDS as reference files with type CALVER looked
up from a corresponding rmap using a master version string.  The function of
this service is really independent of that representation,  but nominally
one reference file will describe versions for components of one s/w release.</p>
<p>This <em>get_system_versions()</em> service will return a JSON object corresponding to
the contents of the s/w versions reference file.  This interface should not
however be construed as the definition of the file contents.</p>
<p><em>master_version</em> is a string naming the overall version number for a
calibration software release and used to select a particular versions reference
file within a CRDS context.</p>
<p><em>context</em> is a CRDS context name which is used to interpret <em>master_version</em> to
define the versions reference file corresponding to an overall s/w
release. Typically the string “null” should be used to select the current CRDS
versions translation context in use in the JWST pipeline.  It is anticipated
that the definitions of software versions should be relatively stable and
additive as new contexts are generated.</p>
<p>An example call using the CRDS Python client shows the conceptual
nature of the interface,  the functional inputs and outputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">versions_obj</span> <span class="o">=</span> <span class="n">get_system_versions</span><span class="p">(</span><span class="s2">&quot;0.6.0noop.dev307&quot;</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Printing the Python client return object in JSON format gives a more
language agnostic view of the conceptual return value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">versions_obj</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="go">{</span>
<span class="go">&quot;CAL_VER&quot;: &quot;0.6.0noop.dev307&quot;,</span>
<span class="go">&quot;author&quot;: &quot;Warren J. Hack&quot;,</span>
<span class="go">&quot;descrip&quot;: &quot;JWST calibration processing step version reference file&quot;,</span>
<span class="go">&quot;history&quot;: &quot;Created by cal_ver_steps version 0.7.0.dev&quot;,</span>
<span class="go">&quot;instrument&quot;: &quot;SYSTEM&quot;,</span>
<span class="go">&quot;reftype&quot;: &quot;CALVER&quot;,</span>
<span class="go">&quot;versions&quot;: {</span>
<span class="go">     &quot;AlignRefsStep&quot;: null,</span>
<span class="go">     &quot;AmiAnalyzeStep&quot;: &quot;0.7.0.dev&quot;,</span>
<span class="go">     &quot;AmiAverageStep&quot;: &quot;0.7.0.dev&quot;,</span>
<span class="go">     &quot;AmiNormalizeStep&quot;: &quot;0.7.0.dev&quot;,</span>
<span class="go">     &quot;AssignWcsStep&quot;: null,</span>
<span class="go">      ...</span>
<span class="go">     },</span>
<span class="go"> ...</span>
<span class="go">}</span>
</pre></div>
</div>
<p>where … indicates that the full contents of the object are not being
displayed.</p>
<p>The alternative abstract context identifier “jwst-versions” may be used en lieu
of “null”.  The translation of the “jwst-versions” identifier is maintained on
the CRDS server as a more literal context name such as “jwst_0059.pmap”.  The
value associated with “jwst-versions” or “null” will nominally be updated on
the CRDS server whenever a new master version is defined.</p>
<p>The intended purpose of the “jwst-versions” tag is to name the most capable
context for use in translating calibration master versions.  Unlike the
abstract name “jwst-operational” that describes the default context used to
define calibration references, it is anticipated that “jwst-versions” will
never or rarely ever revert to older versions of CRDS rules.  This is because
“version facts” should not in general change once they’re defined, 0.6.0 should
mean the same thing in every epoch, whereas it’s valid for calibration
reference assignments to change over time.</p>
<p>Nevertheless, in the case of anomalous situations related to CAL_VER, alternate
CRDS contexts may be explicitly named to specify different rules by which to
translate master version names.  Alternately, the value associated with
“jwst-versions” (or “null”) can be redefined on the CRDS server.</p>
<p>The following curl command line shows the full expansion of the same service
example wrapped in the JSONRPC protocol in a language agnostic way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;method&quot;: &quot;get_system_versions&quot;, &quot;params&quot;: [&quot;0.6.0noop.dev307&quot;,&quot;null&quot;], &quot;id&quot;: 1}&#39;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jwst</span><span class="o">-</span><span class="n">crds</span><span class="o">-</span><span class="n">dit</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">json</span><span class="o">/</span>
<span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">24</span> <span class="n">Aug</span> <span class="mi">2016</span> <span class="mi">22</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">04</span> <span class="n">GMT</span>
<span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<span class="n">X</span><span class="o">-</span><span class="n">Frame</span><span class="o">-</span><span class="n">Options</span><span class="p">:</span> <span class="n">SAMEORIGIN</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">rpc</span>
<span class="n">Via</span><span class="p">:</span> <span class="mf">1.1</span> <span class="n">jwst</span><span class="o">-</span><span class="n">crds</span><span class="o">-</span><span class="n">dit</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span>
<span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>

<span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reftype&quot;</span><span class="p">:</span> <span class="s2">&quot;CALVER&quot;</span><span class="p">,</span> <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Warren J. Hack&quot;</span><span class="p">,</span> <span class="s2">&quot;versions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;TweakRegStep&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;SubtractImagesStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;RSCD_Step&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;CubeBuildStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;Extract1dStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;AmiAnalyzeStep&quot;</span><span class="p">:</span> <span class="s2">&quot;0.7.0.dev&quot;</span><span class="p">,</span> <span class="s2">&quot;Extract2dStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;BackgroundStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;SuperBiasStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;DarkCurrentStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;Combine1dStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;SaturationStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;LinearityStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;DQInitStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;ImprintStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;OutlierDetectionStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;AssignWcsStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;KlipStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;StackRefsStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;TweakregCatalogStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;SourceCatalogStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;PersistenceStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;StraylightStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;IPCStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;FlatFieldStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;ResetStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;RefPixStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;ResampleStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;AmiAverageStep&quot;</span><span class="p">:</span> <span class="s2">&quot;0.7.0.dev&quot;</span><span class="p">,</span> <span class="s2">&quot;FringeStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;AlignRefsStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;LastFrameStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;JumpStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;EmissionStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;WfsCombineStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;AmiNormalizeStep&quot;</span><span class="p">:</span> <span class="s2">&quot;0.7.0.dev&quot;</span><span class="p">,</span> <span class="s2">&quot;SkyMatchStep&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;PhotomStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;RampFitStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;HlspStep&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">},</span> <span class="s2">&quot;instrument&quot;</span><span class="p">:</span> <span class="s2">&quot;SYSTEM&quot;</span><span class="p">,</span> <span class="s2">&quot;descrip&quot;</span><span class="p">:</span> <span class="s2">&quot;JWST calibration processing step version reference file&quot;</span><span class="p">,</span> <span class="s2">&quot;CAL_VER&quot;</span><span class="p">:</span> <span class="s2">&quot;0.6.0noop.dev307&quot;</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="s2">&quot;Created by cal_ver_steps version 0.7.0.dev&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>This example shows the structure of a response string for a query with an error,
“result” is set to null and “error” describes the problem in more detail,  most
notably with the response.error.message string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;method&quot;: &quot;get_system_versions&quot;, &quot;params&quot;: [&quot;an,invalid(version)&quot;,&quot;null&quot;], &quot;id&quot;: 1}&#39;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jwst</span><span class="o">-</span><span class="n">crds</span><span class="o">-</span><span class="n">dit</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">json</span><span class="o">/</span>
<span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">24</span> <span class="n">Aug</span> <span class="mi">2016</span> <span class="mi">22</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mi">11</span> <span class="n">GMT</span>
<span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<span class="n">X</span><span class="o">-</span><span class="n">Frame</span><span class="o">-</span><span class="n">Options</span><span class="p">:</span> <span class="n">SAMEORIGIN</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">rpc</span>
<span class="n">Via</span><span class="p">:</span> <span class="mf">1.1</span> <span class="n">jwst</span><span class="o">-</span><span class="n">crds</span><span class="o">-</span><span class="n">dit</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span>
<span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>

<span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;OtherError: Invalid version string,  must be 1-128 chars of A-Z, a-z, 0-9, ., -, _&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;OtherError&quot;</span><span class="p">},</span> <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="jsonrpc-protocol">
<h2>JSONRPC Protocol<a class="headerlink" href="#jsonrpc-protocol" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sample-url-s">
<h3>Sample URL’s<a class="headerlink" href="#sample-url-s" title="Permalink to this headline">¶</a></h3>
<p>The base URL used for making CRDS JSONRPC method calls is essentially <em>/json/</em>.
All further information,  including the method name and the parameters,  are
POSTed using a JSON serialization scheme.   Example absolute server URLs are:</p>
<div class="section" id="jwst-url">
<h4>JWST URL<a class="headerlink" href="#jwst-url" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><a class="reference external" href="http://jwst-crds.stsci.edu/json/">http://jwst-crds.stsci.edu/json/</a></div></blockquote>
</div>
<div class="section" id="hst-url">
<h4>HST URL<a class="headerlink" href="#hst-url" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><a class="reference external" href="http://hst-crds.stsci.edu/json/">http://hst-crds.stsci.edu/json/</a></div></blockquote>
</div>
</div>
<div class="section" id="generic-request">
<h3>Generic Request<a class="headerlink" href="#generic-request" title="Permalink to this headline">¶</a></h3>
<p>JSONRPC requests are made by POST’ing a set of variables to the appropriate URL.</p>
<p>An example CRDS service request can be demonstrated in a language agnostic way
using the UNIX command line utility curl:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;method&quot;: &quot;get_default_context&quot;, &quot;params&quot;: [&quot;jwst&quot;], &quot;id&quot;: 1}&#39;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jwst</span><span class="o">-</span><span class="n">crds</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">json</span><span class="o">/</span>
</pre></div>
</div>
<p>The <em>jsonrpc</em> attribute is used to specify the version of the JSONRPC standard
being used,  currently 1.0 for CRDS.</p>
<p>The <em>method</em> attribute specifies the name of the service being called.</p>
<p>The <em>params</em> attribute specifies a JSON array of parameters which are passed
positionally to the CRDS method.</p>
<p>The <em>id</em> can be used to associate calls with their responses in asynchronous
environments.</p>
</div>
<div class="section" id="generic-response">
<h3>Generic Response<a class="headerlink" href="#generic-response" title="Permalink to this headline">¶</a></h3>
<p>The response returned by the server for the above request is the following JSON:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;jwst_0000.pmap&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<p>Fatal errors are handled by setting the error attribute of the result object to
an error object.   Inspect the result.error.message attribute to get descriptive
text about the error.</p>
</div>
<div class="section" id="demo-page">
<h3>Demo Page<a class="headerlink" href="#demo-page" title="Permalink to this headline">¶</a></h3>
<p>The CRDS servers support demoing the JSONRPC services and calling them interactively
by visiting the URL <em>…/json/browse/</em>.  This facility is available in development
and test environments upon request.</p>
<p>The resulting page is shown here:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/web_jsonrpc_browse.png"><img alt="jsonrpc browser demo page" src="_images/web_jsonrpc_browse.png" style="width: 662.0px; height: 890.0px;" /></a>
</div>
<p>An example dialog for get_best_references from the CRDS jsonrpc demo page is
shown here with FITS parkey names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">jsonrpc</span><span class="o">.</span><span class="n">get_best_references</span><span class="p">(</span><span class="s2">&quot;jwst_0000.pmap&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;INSTRUME&#39;</span><span class="p">:</span><span class="s1">&#39;FGS&#39;</span><span class="p">,</span><span class="s1">&#39;DETECTOR&#39;</span><span class="p">:</span><span class="s1">&#39;FGS1&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER&#39;</span><span class="p">:</span><span class="s1">&#39;ANY&#39;</span><span class="p">},</span> <span class="n">null</span><span class="p">)</span>
<span class="go">Requesting -&gt;</span>
<span class="go">{&quot;id&quot;:&quot;jsonrpc&quot;, &quot;params&quot;:[&quot;jwst_0000.pmap&quot;, {&quot;INSTRUME&quot;:&quot;FGS&quot;, &quot;DETECTOR&quot;:&quot;FGS1&quot;, &quot;FILTER&quot;:&quot;ANY&quot;}, null], &quot;method&quot;:&quot;get_best_references&quot;, &quot;jsonrpc&quot;:&quot;1.0&quot;}</span>
<span class="go">Deferred(12, unfired)</span>
<span class="go">Got -&gt;</span>
<span class="go">{&quot;error&quot;: null, &quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;id&quot;: &quot;jsonrpc&quot;, &quot;result&quot;: {&quot;linearity&quot;: &quot;jwst_fgs_linearity_0000.fits&quot;, &quot;amplifier&quot;: &quot;jwst_fgs_amplifier_0000.fits&quot;, &quot;mask&quot;: &quot;jwst_fgs_mask_0000.fits&quot;}}</span>
</pre></div>
</div>
<p>And the same query is here with JWST data model parkey names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">jsonrpc</span><span class="o">.</span><span class="n">get_best_references</span><span class="p">(</span><span class="s2">&quot;jwst_0000.pmap&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;META.INSTRUMENT.TYPE&#39;</span><span class="p">:</span><span class="s1">&#39;FGS&#39;</span><span class="p">,</span><span class="s1">&#39;META.INSTRUMENT.DETECTOR&#39;</span><span class="p">:</span><span class="s1">&#39;FGS1&#39;</span><span class="p">,</span> <span class="s1">&#39;META.INSTRUMENT.FILTER&#39;</span><span class="p">:</span><span class="s1">&#39;ANY&#39;</span><span class="p">},</span> <span class="n">null</span><span class="p">)</span>
<span class="go">Requesting -&gt;</span>
<span class="go">{&quot;id&quot;:&quot;jsonrpc&quot;, &quot;params&quot;:[&quot;jwst_0000.pmap&quot;, {&quot;META.INSTRUMENT.TYPE&quot;:&quot;FGS&quot;, &quot;META.INSTRUMENT.DETECTOR&quot;:&quot;FGS1&quot;, &quot;META.INSTRUMENT.FILTER&quot;:&quot;ANY&quot;}, null], &quot;method&quot;:&quot;get_best_references&quot;, &quot;jsonrpc&quot;:&quot;1.0&quot;}</span>
<span class="go">Deferred(14, unfired)</span>
<span class="go">Got -&gt;</span>
<span class="go">{&quot;error&quot;: null, &quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;id&quot;: &quot;jsonrpc&quot;, &quot;result&quot;: {&quot;linearity&quot;: &quot;jwst_fgs_linearity_0000.fits&quot;, &quot;amplifier&quot;: &quot;jwst_fgs_amplifier_0000.fits&quot;, &quot;mask&quot;: &quot;jwst_fgs_mask_0000.fits&quot;}}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rmap_syntax.html" class="btn btn-neutral float-right" title="CRDS Rules (Mappings)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="web_site_use.html" class="btn btn-neutral" title="Using the CRDS Web Site" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Space Telescope Science Institute.
      Last updated on Jun 06, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'7.1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>