

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CRDS Database Access &mdash; CRDS 7.1.7 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/stsci.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CRDS 7.1.7 documentation" href="index.html"/>
        <link rel="prev" title="Reference File Conventions" href="reference_conventions.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="index.html" class="icon icon-home"> CRDS
            
            <img src="_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
              <div class="version">
                7.1
              </div>
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_use.html">Best References Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_tools.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_site_use.html">Using the CRDS Web Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_services.html">Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="rmap_syntax.html">CRDS Rules (Mappings)</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_use.html">Library Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference_conventions.html">Reference File Conventions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CRDS Database Access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#json-rpc-access">JSON RPC Access</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metadata-for-a-single-file">Metadata for a single file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metadata-for-several-all-files">Metadata for several / all files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#download-crds-catalog-for-sqlite-queries">Download CRDS catalog for SQLite queries</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">CRDS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>CRDS Database Access</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/database.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="crds-database-access">
<h1>CRDS Database Access<a class="headerlink" href="#crds-database-access" title="Permalink to this headline">¶</a></h1>
<div class="section" id="json-rpc-access">
<h2>JSON RPC Access<a class="headerlink" href="#json-rpc-access" title="Permalink to this headline">¶</a></h2>
<p>CRDS supports JSON RPC access to the CRDS catalog via the crds.client API.</p>
<div class="section" id="metadata-for-a-single-file">
<h3>Metadata for a single file<a class="headerlink" href="#metadata-for-a-single-file" title="Permalink to this headline">¶</a></h3>
<p>The JSON RPC call get_file_info() will return the avalailble info for a single reference
or mapping file from the specified observatory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_file_info</span><span class="p">(</span><span class="n">observatory</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;Return a dictionary of CRDS information about `filename`.&quot;&quot;&quot;</span>

 <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">crds.client</span> <span class="k">import</span> <span class="n">api</span>

 <span class="o">&gt;&gt;&gt;</span> <span class="n">api</span><span class="o">.</span><span class="n">get_file_info</span><span class="p">(</span><span class="s2">&quot;hst&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s2">&quot;lcb12060j_drk.fits&quot;</span><span class="p">)</span>
 <span class="p">{</span><span class="s1">&#39;activation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2001-12-14 20:47:00&#39;</span><span class="p">,</span>
  <span class="s1">&#39;blacklisted&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
  <span class="s1">&#39;change_level&#39;</span><span class="p">:</span> <span class="s1">&#39;severe&#39;</span><span class="p">,</span>
  <span class="s1">&#39;delivery_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2013-07-10 11:26:23&#39;</span><span class="p">,</span>
  <span class="s1">&#39;derived_from&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
  <span class="s1">&#39;filekind&#39;</span><span class="p">:</span> <span class="s1">&#39;darkfile&#39;</span><span class="p">,</span>
  <span class="s1">&#39;instrument&#39;</span><span class="p">:</span> <span class="s1">&#39;acs&#39;</span><span class="p">,</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;lcb12060j_drk.fits&#39;</span><span class="p">,</span>
  <span class="s1">&#39;observatory&#39;</span><span class="p">:</span> <span class="s1">&#39;hst&#39;</span><span class="p">,</span>
  <span class="s1">&#39;pedigree&#39;</span><span class="p">:</span> <span class="s1">&#39;ground&#39;</span><span class="p">,</span>
  <span class="s1">&#39;rejected&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
  <span class="s1">&#39;sha1sum&#39;</span><span class="p">:</span> <span class="s1">&#39;56cfd1107bda5d82cb49a301a50edb45cb64ded6&#39;</span><span class="p">,</span>
  <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;10549440&#39;</span><span class="p">,</span>
  <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;operational&#39;</span><span class="p">,</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;reference&#39;</span><span class="p">,</span>
  <span class="s1">&#39;useafter_date&#39;</span><span class="p">:</span> <span class="s1">&#39;1992-01-01 00:00:00&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="metadata-for-several-all-files">
<h3>Metadata for several / all files<a class="headerlink" href="#metadata-for-several-all-files" title="Permalink to this headline">¶</a></h3>
<p>The JSON RPC call get_file_info_map() will return the info for multiple (or all) files
and the specified (or all) fields as a dictionary of dictionaries mapping filename onto info:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_file_info_map</span><span class="p">(</span><span class="n">observatory</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the info { filename : { info } } on `files` of `observatory`.</span>
<span class="sd">    `fields` can be used to limit info returned to specified keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="o">%</span> <span class="n">setenv</span> <span class="n">CRDS_SERVER_URL</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">hst</span><span class="o">-</span><span class="n">crds</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span>

<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">crds.client</span> <span class="k">import</span> <span class="n">api</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">api</span><span class="o">.</span><span class="n">get_file_info_map</span><span class="p">(</span><span class="s2">&quot;hst&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;lcb12060j_drk.fits&quot;</span><span class="p">,</span> <span class="s2">&quot;n3o1022fj_drk.fits&quot;</span><span class="p">],</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">,</span><span class="s2">&quot;sha1sum&quot;</span><span class="p">])</span>
<span class="p">{</span><span class="s1">&#39;lcb12060j_drk.fits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sha1sum&#39;</span><span class="p">:</span> <span class="s1">&#39;56cfd1107bda5d82cb49a301a50edb45cb64ded6&#39;</span><span class="p">,</span>
  <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;10549440&#39;</span><span class="p">,</span>
  <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;operational&#39;</span><span class="p">},</span>
 <span class="s1">&#39;n3o1022fj_drk.fits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sha1sum&#39;</span><span class="p">:</span> <span class="s1">&#39;cecf11300015df8f39913b638138d8c67de77a02&#39;</span><span class="p">,</span>
  <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;10526400&#39;</span><span class="p">,</span>
  <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;operational&#39;</span><span class="p">}}</span>
</pre></div>
</div>
<p>If files is specified as <em>None</em>,  info on all files is returned.</p>
<p>If fields are specified as <em>None</em>,  info on all available fields is returned.</p>
</div>
</div>
<div class="section" id="download-crds-catalog-for-sqlite-queries">
<h2>Download CRDS catalog for SQLite queries<a class="headerlink" href="#download-crds-catalog-for-sqlite-queries" title="Permalink to this headline">¶</a></h2>
<p>The CRDS catalog stores metadata about references not captured in the .rmap files.   It also contains
the history of CRDS context use,  the effective dates at which particular contexts where operational in
the pipeline.</p>
<p>You can download a SQLite-3 snapshot of the CRDS catalog like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">setenv</span> <span class="n">CRDS_SERVER_URL</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">hst</span><span class="o">-</span><span class="n">crds</span><span class="o">.</span><span class="n">stsci</span><span class="o">.</span><span class="n">edu</span>
<span class="o">%</span> <span class="n">setenv</span> <span class="n">CRDS_PATH</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">homer</span><span class="o">/</span><span class="n">crds_cache</span>
<span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">sqlite</span><span class="o">-</span><span class="n">db</span>
<span class="n">CRDS</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">SQLite</span> <span class="n">database</span> <span class="n">file</span> <span class="n">downloaded</span> <span class="n">to</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">homer</span><span class="o">/</span><span class="n">crds_cache</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">hst</span><span class="o">/</span><span class="n">crds_db</span><span class="o">.</span><span class="n">sqlite3</span>
</pre></div>
</div>
<p>will snapshot the current CRDS catalog on the CRDS server and download it to your local CRDS cache as a
SQLite3 database file.  The SQLite database can typically be accessed like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sqlite3</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">homer</span><span class="o">/</span><span class="n">crds_cache_dev</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">hst</span><span class="o">/</span><span class="n">crds_db</span><span class="o">.</span><span class="n">sqlite3</span>

<span class="n">sqlite</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">tables</span>
<span class="n">crds_hst_catalog</span>       <span class="n">crds_hst_context_history</span>

<span class="n">sqlite</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">mode</span> <span class="n">tabs</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">headers</span> <span class="n">on</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">crds_hst_context_history</span> <span class="n">where</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;operational&quot;</span> <span class="n">limit</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">id</span>    <span class="n">name</span>    <span class="n">start_date</span>        <span class="n">context</span>     <span class="n">state</span>          <span class="n">description</span>
<span class="mi">2</span>        <span class="mi">2013</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">53</span>    <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span>    <span class="n">operational</span>    <span class="nb">set</span> <span class="n">by</span> <span class="n">system</span>
\<span class="o">.</span>\<span class="o">.</span>\<span class="o">.</span>
</pre></div>
</div>
<p>The CRDS catalog contains the following meta-data:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="10%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Catalog Fields</th>
<th class="head">type</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>str</td>
<td>CRDS filename</td>
</tr>
<tr class="row-odd"><td>uploaded_as</td>
<td>str</td>
<td>Name of file at time of upload / generation</td>
</tr>
<tr class="row-even"><td>state</td>
<td>str</td>
<td>uploaded, delivered, submitted, archiving, archived, archiving-failed, bad</td>
</tr>
<tr class="row-odd"><td>blacklisted</td>
<td>bool/int</td>
<td>True/1 == this mapping,  and all mappings referring to it, are invalid.</td>
</tr>
<tr class="row-even"><td>rejected</td>
<td>bool/int</td>
<td>True/1 == this file is considered scientifically invalid</td>
</tr>
<tr class="row-odd"><td>replaced_by_filename</td>
<td>str</td>
<td>Succeeding reference file in chain of contexts.  Weakly defined.</td>
</tr>
<tr class="row-even"><td>instrument</td>
<td>str</td>
<td>instrument name file applies to</td>
</tr>
<tr class="row-odd"><td>filekind</td>
<td>str</td>
<td>reference type. For HST,  also keyword name for dataset headers</td>
</tr>
<tr class="row-even"><td>type</td>
<td>str</td>
<td>reference or mapping</td>
</tr>
<tr class="row-odd"><td>description</td>
<td>str</td>
<td>description given at time of delivery</td>
</tr>
<tr class="row-even"><td>comment</td>
<td>str</td>
<td>COMMENT from reference file</td>
</tr>
<tr class="row-odd"><td>aperture</td>
<td>str</td>
<td>APERTURE from reference file</td>
</tr>
<tr class="row-even"><td>derived_from</td>
<td>str</td>
<td>Name of mapping this one was derived from</td>
</tr>
<tr class="row-odd"><td>sha1sum</td>
<td>str</td>
<td>sha1sum of file to verify file integrity</td>
</tr>
<tr class="row-even"><td>size</td>
<td>int</td>
<td>length of file in bytes</td>
</tr>
<tr class="row-odd"><td>creator_name</td>
<td>str</td>
<td>author of reference or mapping file</td>
</tr>
<tr class="row-even"><td>deliverer_user</td>
<td>str</td>
<td>person who submitted the reference or mapping to CRDS</td>
</tr>
<tr class="row-odd"><td>deliverer_email</td>
<td>str</td>
<td>e-mail of person who submitted reference</td>
</tr>
</tbody>
</table>
<p><em>NOTE:</em> Reference file assignment criteria are encoded in the CRDS rules / mappings and displayed as tables on
the web site context display.   See also crds.matches for information on displaying matching criteria based on rmaps
at the command line.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="reference_conventions.html" class="btn btn-neutral" title="Reference File Conventions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Space Telescope Science Institute.
      Last updated on Mar 04, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'7.1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>