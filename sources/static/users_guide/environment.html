

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Environment Variables &mdash; CRDS 7.1.7 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/stsci.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CRDS 7.1.7 documentation" href="index.html"/>
        <link rel="next" title="Command Line Tools" href="command_line_tools.html"/>
        <link rel="prev" title="Best References Basics" href="basic_use.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="index.html" class="icon icon-home"> CRDS
            
            <img src="_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
              <div class="version">
                7.1
              </div>
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_use.html">Best References Basics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Environment Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-environment">Basic Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-cache-location-crds-path">File Cache Location (CRDS_PATH)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-on-site-crds-path">Default On Site CRDS_PATH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-local-crds-path">User Local CRDS_PATH</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#server-selection-crds-server-url">Server Selection (CRDS_SERVER_URL)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-server">Default Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hst-ops-server">HST Ops Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jwst-ops-server">JWST OPS Server</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#onsite-crds-testing">Onsite CRDS Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-hst-settings">Additional HST Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#flat-cache-layout-for-grp-crds-cache">Flat Cache Layout for <em>/grp/crds/cache</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#by-instrument-cache-layout">By-Instrument Cache Layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reorganizing-crds-references">Reorganizing CRDS References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jwst-context">JWST Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-environment">Advanced Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#crds-cache-locking">CRDS Cache Locking</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#single-shell-locking">Single Shell Locking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-based-locking">File Based Locking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restrictions-on-locking">Restrictions on Locking</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multi-project-caches">Multi-Project Caches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#single-project-caches">Single Project Caches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#miscellaneous-variables">Miscellaneous Variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line_tools.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_site_use.html">Using the CRDS Web Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_services.html">Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="rmap_syntax.html">CRDS Rules (Mappings)</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_use.html">Library Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference_conventions.html">Reference File Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">CRDS Database Access</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">CRDS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Environment Variables</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/environment.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="environment-variables">
<h1>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h1>
<p>Configuring CRDS for pipeline or offsite personal use is accomplished by setting
shell environment variables.</p>
<div class="section" id="basic-environment">
<h2>Basic Environment<a class="headerlink" href="#basic-environment" title="Permalink to this headline">¶</a></h2>
<p>By default,  onsite at STScI,  CRDS runs from a global cache with no connection
to the CRDS Server and typically no user environment setup required to do basic
best references.</p>
<p>For more personalized configurations or one designed for offsite use,  the CRDS
environment needs to define a CRDS server (CRDS_SERVER_URL) and a CRDS file
cache directory (CRDS_PATH).</p>
<div class="section" id="file-cache-location-crds-path">
<h3>File Cache Location (CRDS_PATH)<a class="headerlink" href="#file-cache-location-crds-path" title="Permalink to this headline">¶</a></h3>
<p>CRDS stores reference files, rules files, and configuration information such as the
current default context in a cache.   The location of the CRDS cache is defined by
the CRDS_PATH environment setting.</p>
<div class="section" id="default-on-site-crds-path">
<h4>Default On Site CRDS_PATH<a class="headerlink" href="#default-on-site-crds-path" title="Permalink to this headline">¶</a></h4>
<p>By default,   CRDS behaves as if you set your environment like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_PATH=/grp/crds/cache
</pre></div>
</div>
<p><em>/grp/crds/cache</em> is on the Central Store and should be accessible to all users.  It
is a readonly cache containing all rule and reference files associated with
all CRDS projects,  now HST + JWST.</p>
<p>While it is configuration free and self-maintaining, limitations of the default cache
include:</p>
<blockquote>
<div><ol class="arabic simple">
<li>A need for a direct connection to the STScI internal network</li>
<li>Weak performance when accessed by VPN over the Internet</li>
<li>Immutable files not well suited for experimentation</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="user-local-crds-path">
<h4>User Local CRDS_PATH<a class="headerlink" href="#user-local-crds-path" title="Permalink to this headline">¶</a></h4>
<p>To avoid Internet inefficiencies,  individual user’s can construct demand-based CRDS caches
appropriate to their particular datasets.    Personal CRDS caches also enable processing and
many basic functions with no network access to the CRDS server.   Rem</p>
<p>A remote or pipeline user defines a non-default CRDS cache by setting, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_PATH=$HOME/crds_cache
</pre></div>
</div>
<p>Using a personal cache also requires defining the CRDS server.</p>
</div>
</div>
<div class="section" id="server-selection-crds-server-url">
<h3>Server Selection (CRDS_SERVER_URL)<a class="headerlink" href="#server-selection-crds-server-url" title="Permalink to this headline">¶</a></h3>
<p>Since each project (and test system) is supported by a different CRDS server,
a user must define any CRDS server they wish to use.</p>
<div class="section" id="default-server">
<h4>Default Server<a class="headerlink" href="#default-server" title="Permalink to this headline">¶</a></h4>
<p>By default,  the CRDS client bestrefs functionality can run without a server
provided they have access to an up-to-date CRDS cache.</p>
<p>By <strong>default</strong> CRDS behaves as if you set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_SERVER_URL=https://crds-serverless-mode.stsci.edu
</pre></div>
</div>
<p>Serverless mode limits CRDS to basic functions (bestrefs) but requires no server connection
once the supporting CRDS cache has been synced.</p>
</div>
<div class="section" id="hst-ops-server">
<h4>HST Ops Server<a class="headerlink" href="#hst-ops-server" title="Permalink to this headline">¶</a></h4>
<p>A full featured CRDS configuration suitable supporting all server functions available for HST
can be configured like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_SERVER_URL=https://hst-crds.stsci.edu
</pre></div>
</div>
</div>
<div class="section" id="jwst-ops-server">
<h4>JWST OPS Server<a class="headerlink" href="#jwst-ops-server" title="Permalink to this headline">¶</a></h4>
<p>A full featured CRDS configuration suitable supporting all server functions available for JWST
can be configured like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_SERVER_URL=https://jwst-crds.stsci.edu
</pre></div>
</div>
<p>If CRDS cannot determine your project, and you did not specify CRDS_SERVER_URL,
CRDS_SERVER_URL will be defaulted to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_SERVER_URL=https://crds-serverless-mode.stsci.edu
</pre></div>
</div>
<p>The serverless-mode URL directs CRDS to operate from the CRDS cache without contacting
the CRDS server for updates.   This works well with the default cache at <em>/grp/crds/cache</em>
since it is kept up to date by the CRDS server.   It is not possible to do cache
updates while in serverless mode since no connection to the server is enabled.</p>
</div>
</div>
</div>
<div class="section" id="onsite-crds-testing">
<h2>Onsite CRDS Testing<a class="headerlink" href="#onsite-crds-testing" title="Permalink to this headline">¶</a></h2>
<p>For reference type development, updates are generally made and tested in the
test pipelines at STScI.  For coordinating with those tests, <strong>CRDS_PATH</strong> and
<strong>CRDS_SERVER_URL</strong> must be explicitly set to a test cache and server similar
to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_PATH=${HOME}/crds_cache_test
$ export CRDS_SERVER_URL=https://hst-crds-test.stsci.edu
</pre></div>
</div>
<p>Alternative servers for JWST I&amp;T testing are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_SERVER_URL=https://jwst-crds-b5it.stcsi.edu     # build-5
$ export CRDS_SERVER_URL=https://jwst-crds-b6it.stcsi.edu     # build-6
$ export CRDS_SERVER_URL=https://jwst-crds-dit.stcsi.edu      # build-7
$ export CRDS_SERVER_URL=https://jwst-crds-bit.stcsi.edu      # build-7
$ export CRDS_SERVER_URL=https://jwst-crds-cit.stcsi.edu      # build-7.2
</pre></div>
</div>
<p>After syncing this will provide access to CRDS test files and rules in a local cache:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch all the test rules</span>
<span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="nb">all</span>

<span class="c1"># Fetch specifically listed test references</span>
<span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="n">files</span> <span class="o">&lt;</span><span class="n">test_references_only_the_test_server_has</span><span class="o">...&gt;</span>
</pre></div>
</div>
<p>Testing reference type changes (new keywords, new values or value restrictions,
etc) may also require access to development versions of CRDS code.  In
particular, when adding parameters or changing legal parameter values, the
certify tool is modified as “code” on the servers first.  Hence distributed
versions of CRDS will not reflect ongoing type changes.  The test server
Certify Files function should generally reflect the most up-to-date knowledge
CRDS has about ongoing type changes.  To see how new reference files stack up
with changing CRDS code, try submitting the files to Certify Files on the test
server or ask what the status is on <a class="reference external" href="mailto:redcat&#37;&#52;&#48;stsci&#46;edu">redcat<span>&#64;</span>stsci<span>&#46;</span>edu</a>.</p>
<p><strong>NOTE:</strong> Without VPN or port forwarding, the test servers are not usable offsite.</p>
</div>
<div class="section" id="additional-hst-settings">
<h2>Additional HST Settings<a class="headerlink" href="#additional-hst-settings" title="Permalink to this headline">¶</a></h2>
<p>HST calibration software accesses reference files indirectly through
environment variables.  There are two forms of CRDS cache reference file
organization: flat and with instrument sub-directories.  The HST calibration
software environment variable settings depend on the CRDS cache layout.</p>
<p>JWST calibration code refers to explicit cache paths at runtime and does
not require these additional settings.</p>
<div class="section" id="flat-cache-layout-for-grp-crds-cache">
<h3>Flat Cache Layout for <em>/grp/crds/cache</em><a class="headerlink" href="#flat-cache-layout-for-grp-crds-cache" title="Permalink to this headline">¶</a></h3>
<p>The flat cache layout places all references in a single directory.  The
shared group cache at <em>/grp/crds/cache</em> has a flat organization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export iref=${CRDS_PATH}/references/hst/
export jref=${CRDS_PATH}/references/hst/
export oref=${CRDS_PATH}/references/hst/
export lref=${CRDS_PATH}/references/hst/
export nref=${CRDS_PATH}/references/hst/
export uref=${CRDS_PATH}/references/hst/
export uref_linux=$uref
</pre></div>
</div>
</div>
<div class="section" id="by-instrument-cache-layout">
<h3>By-Instrument Cache Layout<a class="headerlink" href="#by-instrument-cache-layout" title="Permalink to this headline">¶</a></h3>
<p>The default cache setup for newly created caches for HST is organized by instrument.</p>
<p>Unless you reorganize your cache using the crds.sync tool,  these are the settings
that are most likely to be appropriate for a personal HST cache.</p>
<p>For HST calibration software to use references in a CRDS cache with a by-instrument
organization, set these environment variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export iref=${CRDS_PATH}/references/hst/iref/
export jref=${CRDS_PATH}/references/hst/jref/
export oref=${CRDS_PATH}/references/hst/oref/
export lref=${CRDS_PATH}/references/hst/lref/
export nref=${CRDS_PATH}/references/hst/nref/
export uref=${CRDS_PATH}/references/hst/uref/
export uref_linux=$uref
</pre></div>
</div>
</div>
<div class="section" id="reorganizing-crds-references">
<h3>Reorganizing CRDS References<a class="headerlink" href="#reorganizing-crds-references" title="Permalink to this headline">¶</a></h3>
<p>The crds.sync tool can be used to reorganize the directory structure of an
existing CRDS cache.   These organizations determine whether or not
reference files are partitioned into instrument-specific sub-directories.</p>
<p>To switch from flat to by-instrument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="n">organize</span><span class="o">=</span><span class="n">instrument</span>
</pre></div>
</div>
<p>To switch from by-instrument to flat:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="n">organize</span><span class="o">=</span><span class="n">flat</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="jwst-context">
<h2>JWST Context<a class="headerlink" href="#jwst-context" title="Permalink to this headline">¶</a></h2>
<p>The CRDS context file defines a version of CRDS rules used to assign best references.</p>
<p>The CRDS context used to evaluate CRDS best references for JWST defaults to jwst-operational.  This
is an indirect name for the context in use or soon-to-be in use in the archive pipeline.</p>
<p>During development jwst-operational corresponds to the latest context which is
sufficiently mature for broad use.  Use of jwst-operational is automatic.</p>
<p>The context used for JWST can be overridden to some specific historical or experimental context by setting
the <strong>CRDS_CONTEXT</strong> environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_CONTEXT=jwst_0057.pmap
</pre></div>
</div>
<p><strong>CRDS_CONTEXT</strong> does not override command line switches or parameters passed explicitly to the
crds.getreferences() API function.</p>
</div>
<div class="section" id="advanced-environment">
<h2>Advanced Environment<a class="headerlink" href="#advanced-environment" title="Permalink to this headline">¶</a></h2>
<p>A number of things in CRDS are configurable with environment variables,  most important of which is the
location and structure of the file cache.</p>
<div class="section" id="crds-cache-locking">
<h3>CRDS Cache Locking<a class="headerlink" href="#crds-cache-locking" title="Permalink to this headline">¶</a></h3>
<p>CRDS cache locking has been added to support JWST association calibration multi-processing
for users who set up personal demand-based CRDS Caches.  Cache locking prevents simultaneous
transparent CRDS Cache updates from multiple JWST calibration processes.</p>
<div class="section" id="single-shell-locking">
<h4>Single Shell Locking<a class="headerlink" href="#single-shell-locking" title="Permalink to this headline">¶</a></h4>
<p>By default,  CRDS uses Python’s built in multiprocessing locks which are robust and suitable for
running multiprocesses within a single shell or terminal window:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ crds list --status
CRDS Version = &#39;7.2.0, 7.2.0, 139bbcb&#39;
...
Cache Locking = &#39;enabled, multiprocessing&#39;
...
Readonly Cache = False
</pre></div>
</div>
<p>However,  this default CRDS cache locking is not suitable for running calibrations in multiple
terminal windows or for pipeline use.</p>
</div>
<div class="section" id="file-based-locking">
<h4>File Based Locking<a class="headerlink" href="#file-based-locking" title="Permalink to this headline">¶</a></h4>
<p>Since Python’s default multiprocessing locks cannot support multiple process trees or terminal windows,
CRDS also supports file based locking by setting appropriate configuration variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CRDS_LOCKING_MODE=filelock
$ crds list --status
CRDS Version = &#39;7.2.0, 7.2.0, 139bbcb&#39;
...
Cache Locking = &#39;enabled, filelock&#39;
...
Readonly Cache = False
</pre></div>
</div>
<p>File based locking is not used by default for several reasons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">They</span> <span class="n">introduce</span> <span class="n">a</span> <span class="n">dependency</span> <span class="n">on</span> <span class="n">a</span> <span class="mi">3</span><span class="n">rd</span> <span class="n">party</span> <span class="n">package</span><span class="o">.</span>
<span class="mf">2.</span> <span class="n">File</span> <span class="n">locks</span> <span class="n">created</span> <span class="n">on</span> <span class="n">network</span> <span class="ow">or</span> <span class="n">other</span> <span class="n">virtualized</span> <span class="n">file</span> <span class="n">systems</span> <span class="n">may</span> <span class="n">be</span> <span class="n">unreliable</span><span class="o">.</span>
<span class="mf">3.</span> <span class="n">File</span> <span class="n">lock</span> <span class="n">behavior</span> <span class="ow">is</span> <span class="n">OS</span> <span class="n">dependent</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="restrictions-on-locking">
<h4>Restrictions on Locking<a class="headerlink" href="#restrictions-on-locking" title="Permalink to this headline">¶</a></h4>
<p>There are multiple conditions in CRDS that determine when locking is really used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">CRDS_READONLY_CACHE</span> <span class="n">must</span> <span class="n">be</span> <span class="n">undefined</span> <span class="ow">or</span> <span class="mi">0</span>
<span class="mf">2.</span> <span class="n">The</span> <span class="n">CRDS</span> <span class="n">cache</span> <span class="n">must</span> <span class="n">be</span> <span class="n">writable</span> <span class="k">as</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">file</span> <span class="n">system</span> <span class="n">permissions</span>
<span class="mf">3.</span> <span class="n">The</span> <span class="n">CRDS_LOCK_PATH</span> <span class="n">directory</span> <span class="p">(</span><span class="n">nominally</span> <span class="o">/</span><span class="n">tmp</span><span class="p">)</span> <span class="n">should</span> <span class="n">already</span> <span class="n">exist</span>
<span class="mf">4.</span> <span class="n">For</span> <span class="n">file</span> <span class="n">based</span> <span class="n">locking</span><span class="p">,</span>  <span class="n">a</span> <span class="n">lock</span> <span class="n">must</span> <span class="n">be</span> <span class="n">successfully</span> <span class="n">created</span>
<span class="mf">5.</span> <span class="n">CRDS_USE_LOCKING</span> <span class="n">must</span> <span class="n">be</span> <span class="n">undefined</span> <span class="ow">or</span> <span class="mi">1</span>
<span class="mf">6.</span> <span class="n">For</span> <span class="n">file</span> <span class="n">based</span> <span class="n">locking</span><span class="p">,</span>  <span class="n">the</span> <span class="n">lockfile</span> <span class="ow">or</span> <span class="n">filelock</span> <span class="n">Python</span> <span class="n">package</span> <span class="n">must</span> <span class="n">be</span> <span class="n">installed</span>
</pre></div>
</div>
<p>The readonly nature of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*/</span><span class="n">grp</span><span class="o">/</span><span class="n">crds</span><span class="o">/</span><span class="n">cache</span><span class="o">*</span>
</pre></div>
</div>
<p>prevents the use of locking for typical onsite users.  None should be required.</p>
<p>It should be noted that the existence of any lock file directory is itself a
concurrency issue, so it must be created or otherwise available before cache
synchronization takes place.</p>
<p>The CRDS command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ crds sync --clear-locks
</pre></div>
</div>
<p>can be used to remove orphan locks (due to some unexpected failure) that are
blocking processing.</p>
<p>Locking requires installation of the <em>lockfile</em> package and CRDS-7.1.4 or later.</p>
</div>
</div>
<div class="section" id="multi-project-caches">
<h3>Multi-Project Caches<a class="headerlink" href="#multi-project-caches" title="Permalink to this headline">¶</a></h3>
<p><strong>CRDS_PATH</strong> defines a cache structure for multiple projects. Each major branch of a multi-project cache
contains project specific sub-directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">cache</span>
    <span class="o">/</span><span class="n">mappings</span>
        <span class="o">/</span><span class="n">hst</span>
            <span class="n">hst</span> <span class="n">mapping</span> <span class="n">files</span><span class="o">...</span>
        <span class="o">/</span><span class="n">jwst</span>
            <span class="n">jwst</span> <span class="n">mapping</span> <span class="n">files</span><span class="o">...</span>
    <span class="o">/</span><span class="n">references</span>
        <span class="o">/</span><span class="n">hst</span>
            <span class="n">hst</span> <span class="n">reference</span> <span class="n">files</span><span class="o">...</span>
        <span class="o">/</span><span class="n">jwst</span>
            <span class="n">jwst</span> <span class="n">reference</span> <span class="n">files</span><span class="o">...</span>
    <span class="o">/</span><span class="n">config</span>
        <span class="o">/</span><span class="n">hst</span>
            <span class="n">hst</span> <span class="n">config</span> <span class="n">files</span><span class="o">...</span>
        <span class="o">/</span><span class="n">jwst</span>
            <span class="n">jwst</span> <span class="n">config</span> <span class="n">files</span><span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><em>mappings</em> contains versioned rules files for CRDS reference file assignments</li>
<li><em>references</em> contains reference files themselves</li>
<li><em>config</em> contains system configuration information like operational context and bad files</li>
</ul>
<p>Inidivdual branches of a cache can be overriden to locate that branch outside the directory
tree specified by CRDS_PATH.   The remaining directories can be overriden as well or derived
from CRDS_PATH.</p>
<p><strong>CRDS_MAPPATH</strong> can be used to override CRDS_PATH and define where
only mapping files are stored.  CRDS_MAPPATH defaults to ${CRDS_PATH}/mappings
which contains multiple observatory-specific subdirectories.</p>
<p><strong>CRDS_REFPATH</strong> can be used to override CRDS_PATH and define where
only reference files are stored.  CRDS_REFPATH defaults to ${CRDS_PATH}/references
which contains multiple observatory specific subdirectoriers.</p>
<p><strong>CRDS_CFGPATH</strong> can be used to override CRDS_PATH and define where
only configuration information is cached. CRDS_CFGPATH defaults to ${CRDS_PATH}/config
which can contain multiple observatory-spefific subdirectories.</p>
<p>Specifying CRDS_MAPPATH = /somewhere when CRDS_OBSERVATORY = hst means that
mapping files will be located in /somewhere/hst.</p>
<p>While it can be done,  it’s generally considered an error to use a multi-project cache
with different servers for the <em>same observatory</em>, e.g. both hst-test and hst-ops.</p>
</div>
<div class="section" id="single-project-caches">
<h3>Single Project Caches<a class="headerlink" href="#single-project-caches" title="Permalink to this headline">¶</a></h3>
<p><strong>CRDS_PATH_SINGLE</strong> defines a cache structure for a single project.  The component paths
implied by <strong>CRDS_PATH_SINGLE</strong>  omit the observatory subdirectory,  giving a simpler and
shallower cache structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">cache</span>
    <span class="o">/</span><span class="n">mappings</span>
        <span class="n">mapping_files</span><span class="o">...</span>
    <span class="o">/</span><span class="n">references</span>
        <span class="n">reference</span> <span class="n">files</span><span class="o">...</span>
    <span class="o">/</span><span class="n">config</span>
        <span class="n">config</span> <span class="n">files</span><span class="o">...</span>
</pre></div>
</div>
<p>It’s an error to use a single project cache with more than one project or server.  It is
inadvisable to mix multi-project (no _SINGLE) and single-project (_SINGLE) configuration
variables,  set one or the other form,  not both.</p>
<p>As with <strong>CRDS_PATH</strong>,  there are overrides for each cache branch which can locate it
independently.</p>
<p><strong>CRDS_MAPPATH_SINGLE</strong> can be used to override CRDS_PATH and define where only
mapping files are stored. CRDS_MAPPATH_SINGLE defaults to ${CRDS_PATH}/mappings
but is presumed to support only one observatory.</p>
<p><strong>CRDS_REFPATH_SINGLE</strong> can be used to override CRDS_PATH and define where
only reference files are stored.  CRDS_REFPATH_SINGLE defaults to ${CRDS_PATH}/references
but is presumed to support only one observatory.</p>
<p><strong>CRDS_CFGPATH_SINGLE</strong> can be used to override CRDS_PATH and define where
only server configuration information is cached.   CRDS_CFGPATH_SINGLE defaults to
${CRDS_PATH}/config but is presumed to support only one observatory.</p>
<p>Specifying CRDS_MAPPATH_SINGLE = /somewhere when CRDS_OBSERVATORY = hst means that
mapping files will be located in /somewhere,  not in /somewhere/hst.</p>
</div>
<div class="section" id="miscellaneous-variables">
<h3>Miscellaneous Variables<a class="headerlink" href="#miscellaneous-variables" title="Permalink to this headline">¶</a></h3>
<p><strong>CRDS_VERBOSITY</strong> enables output of CRDS debug messages.   Set to an
integer,  nominally 50.   Higher values output more information,  lower
values less information.   CRDS also has command line switches
–verbose (level=50) and –verbosity=&lt;level&gt;.   Verbosity level
ranges from 0 to 100 and defaults to 0 (no verbose output).</p>
<p><strong>CRDS_ALLOW_BAD_RULES</strong>  enable CRDS to use assigment rules which have been
designated as bad files / scientifically invalid.</p>
<p><strong>CRDS_ALLOW_BAD_REFERENCES</strong> enable CRDS to assign reference files which have
been designated as scientifically invalid after issuing a warning.</p>
<p><strong>CRDS_IGNORE_MAPPING_CHECKSUM</strong> causes CRDS to waive mapping checksums
when set to True,  useful when you’re editing them.</p>
<p><strong>CRDS_READONLY_CACHE</strong> limits tools to readonly access to the cache when set
to True.  Eliminates cache writes which occur implicitly.  This is mostly
useful in CRDS server user cases which want to ensure not modifying the server
CRDS cache but cannot write protect it effectively.</p>
<p><strong>CRDS_MODE</strong> defines whether CRDS should compute best references using
installed client software only (local),  on the server (remote),  or
intelligently “fall up” to the server (when the installed client is deemed
obsolete relative to the server) or “fall down” to the local installation
(when the server cannot be reached) (auto).   The default is auto.</p>
<p><strong>CRDS_CLIENT_RETRY_COUNT</strong> number of times CRDS will attempt a network
transaction with the CRDS server.  Defaults to 1 meaning 1 try with no retries.</p>
<p><strong>CRDS_CLIENT_RETRY_DELAY_SECONDS</strong> number of seconds CRDS waits after a failed
network transaction before trying again.  Defaults to 0 seconds,  meaning
proceed immediately after fail.</p>
<p><strong>CRDS_USE_LOCKING</strong> boolean enabling/disabling CRDS cache locking,  currently
only used for JWST and defaulting to enabled.   File locking is currently limited
to JWST calibrations so HST sync and bestrefs tools must be run in single
processes or with CRDS_READONLY_CACHE=1.</p>
<p><strong>CRDS_LOCKING_MODE</strong>  chooses between multiprocessing, filelock, or lockfile
based locks.  multiprocessing is the default.  To support multiple
terminal windows or pipeline processing,  file based locking must be used
with filelock recommended and known problems having been observed with the
lockfile package.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="command_line_tools.html" class="btn btn-neutral float-right" title="Command Line Tools" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basic_use.html" class="btn btn-neutral" title="Best References Basics" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Space Telescope Science Institute.
      Last updated on Jun 08, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'7.1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>