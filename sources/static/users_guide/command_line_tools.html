

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Command Line Tools &mdash; CRDS 7.1.7 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/stsci.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CRDS 7.1.7 documentation" href="index.html"/>
        <link rel="next" title="Using the CRDS Web Site" href="web_site_use.html"/>
        <link rel="prev" title="Overview" href="overview.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="index.html" class="icon icon-home"> CRDS
            
            <img src="_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
              <div class="version">
                7.1
              </div>
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_use.html">Best References Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Command Line Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#crds-master-program">crds master program</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specifying-file-paths">Specifying File Paths</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#in-the-crds-cache">In the CRDS cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#in-the-current-directory">In the current directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#crds-bestrefs">crds.bestrefs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-oriented-best-references">File Oriented Best References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-context">New Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lookup-parameter-sources">Lookup Parameter Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comparison-modes">Comparison Modes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#context-to-context">Context-to-Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prior-source-recommendations">Prior Source Recommendations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#output-modes">Output Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-modes">Update Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verbosity">Verbosity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bad-files">Bad Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#crds-sync">crds.sync</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crds-certify">crds.certify</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crds-diff">crds.diff</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crds-rowdiff">crds.rowdiff</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crds-uses">crds.uses</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crds-matches">crds.matches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#safe-bestrefs">safe_bestrefs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cron-sync">cron_sync</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="web_site_use.html">Using the CRDS Web Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_services.html">Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="rmap_syntax.html">CRDS Rules (Mappings)</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_use.html">Library Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference_conventions.html">Reference File Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">CRDS Database Access</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">CRDS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Command Line Tools</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/command_line_tools.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="command-line-tools">
<h1>Command Line Tools<a class="headerlink" href="#command-line-tools" title="Permalink to this headline">¶</a></h1>
<p>Using the command line tools requires a local installation of the CRDS library.
Some of the command line tools also interact with the CRDS server in order to
implement their functionality.</p>
<div class="section" id="crds-master-program">
<h2>crds master program<a class="headerlink" href="#crds-master-program" title="Permalink to this headline">¶</a></h2>
<p>The original DEPRECATED command line syntax, e.g. for the list command was:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">crds</span><span class="o">.</span><span class="n">list</span> <span class="o">--</span><span class="n">status</span>
</pre></div>
</div>
<p>This was replaced by a dNEW command line syntax, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="nb">list</span> <span class="o">--</span><span class="n">status</span>
</pre></div>
</div>
<p>The ‘crds’ wrapper hides internal structural details of the CRDS package.</p>
<p>For a list of available commands do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>for detail on a single command do, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="nb">list</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-file-paths">
<h2>Specifying File Paths<a class="headerlink" href="#specifying-file-paths" title="Permalink to this headline">¶</a></h2>
<p>The command line tools operate on CRDS reference and mapping files both inside
and outside the CRDS cache.   Files specified without a path are assumed to be
in the CRDS cache.   Files specified with an explicit absolute or relative
path can be located anywhere.   See examples below.</p>
<div class="section" id="in-the-crds-cache">
<h3>In the CRDS cache<a class="headerlink" href="#in-the-crds-cache" title="Permalink to this headline">¶</a></h3>
<p>To specify a file inside the CRDS file cache, use no path on the file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">diff</span> <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span>  <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span>  <span class="c1"># assumes paths, and nested paths, are</span>
<span class="ow">in</span> <span class="n">CRDS</span> <span class="n">cache</span>
</pre></div>
</div>
<p>This is the default and aligns with the behavior of CRDS rules files.</p>
</div>
<div class="section" id="in-the-current-directory">
<h3>In the current directory<a class="headerlink" href="#in-the-current-directory" title="Permalink to this headline">¶</a></h3>
<p>To specify a file which is not located in the CRDS cache, use an explicit
relative or absolute path:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">diff</span> <span class="o">./</span><span class="n">hst_acs_darkfile_0250</span><span class="o">.</span><span class="n">rmap</span>  <span class="o">./</span><span class="n">hst_acs_darkfile_0251</span><span class="o">.</span><span class="n">rmap</span>
</pre></div>
</div>
<p>In this example,  the ./ is critical for telling CRDS to use the file in
the current working directory.</p>
</div>
</div>
<div class="section" id="crds-bestrefs">
<h2>crds.bestrefs<a class="headerlink" href="#crds-bestrefs" title="Permalink to this headline">¶</a></h2>
<p>crds.bestrefs computes the best references with respect to a particular context or contexts
for a set of FITS files, dataset ids,  or instruments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">homer</span><span class="o">/</span><span class="n">virtenv</span><span class="o">/</span><span class="n">ssbdev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">crds</span><span class="o">/</span><span class="n">bestrefs</span><span class="o">.</span><span class="n">py</span>
       <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="n">NEW_CONTEXT</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OLD_CONTEXT</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">old</span><span class="o">-</span><span class="n">headers</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span>
       <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">]]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span> <span class="n">IDs</span> <span class="p">[</span><span class="n">IDs</span> <span class="o">...</span><span class="p">]]</span> <span class="p">[</span><span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">instruments</span><span class="p">]</span>
       <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">INSTRUMENTS</span> <span class="p">[</span><span class="n">INSTRUMENTS</span> <span class="o">...</span><span class="p">]]</span>
       <span class="p">[</span><span class="o">-</span><span class="n">t</span> <span class="n">REFERENCE_TYPES</span> <span class="p">[</span><span class="n">REFERENCE_TYPES</span> <span class="o">...</span><span class="p">]]</span>
       <span class="p">[</span><span class="o">-</span><span class="n">k</span> <span class="n">SKIPPED_REFERENCE_TYPES</span> <span class="p">[</span><span class="n">SKIPPED_REFERENCE_TYPES</span> <span class="o">...</span><span class="p">]]</span>
       <span class="p">[</span><span class="o">--</span><span class="n">diffs</span><span class="o">-</span><span class="n">only</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">datasets</span><span class="o">-</span><span class="n">since</span> <span class="n">DATASETS_SINCE</span><span class="p">]</span>
       <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="p">[</span><span class="n">LOAD_PICKLES</span> <span class="p">[</span><span class="n">LOAD_PICKLES</span> <span class="o">...</span><span class="p">]]]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span> <span class="n">SAVE_PICKLE</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">pickle</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">only</span><span class="o">-</span><span class="n">ids</span> <span class="p">[</span><span class="n">IDS</span> <span class="p">[</span><span class="n">IDS</span> <span class="o">...</span><span class="p">]]]</span> <span class="p">[</span><span class="o">-</span><span class="n">u</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span><span class="o">-</span><span class="n">details</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">references</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">update</span><span class="o">-</span><span class="n">counts</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">m</span> <span class="n">SYNC_MAPPINGS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">SYNC_REFERENCES</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="n">differences</span><span class="o">-</span><span class="n">are</span><span class="o">-</span><span class="n">errors</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">bad</span><span class="o">-</span><span class="n">rules</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">bad</span><span class="o">-</span><span class="n">references</span><span class="p">]</span>
       <span class="p">[</span><span class="o">-</span><span class="n">e</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">undefined</span><span class="o">-</span><span class="n">differences</span><span class="o">-</span><span class="n">matter</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">na</span><span class="o">-</span><span class="n">differences</span><span class="o">-</span><span class="n">matter</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="n">compare</span><span class="o">-</span><span class="n">cdbs</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">affected</span><span class="o">-</span><span class="n">datasets</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span><span class="o">-</span><span class="n">file</span> <span class="n">UNIQUE_ERRORS_FILE</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">errors</span><span class="o">-</span><span class="n">file</span> <span class="n">ALL_ERRORS_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">R</span><span class="p">]</span>
       <span class="p">[</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">V</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">J</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">H</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">stats</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">profile</span> <span class="n">PROFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">time</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">pdb</span><span class="p">]</span>
       <span class="p">[</span><span class="o">--</span><span class="n">debug</span><span class="o">-</span><span class="n">traps</span><span class="p">]</span>

<span class="o">*</span> <span class="n">Determines</span> <span class="n">best</span> <span class="n">references</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">a</span> <span class="n">context</span> <span class="ow">or</span> <span class="n">contexts</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Optionally</span> <span class="n">compares</span> <span class="n">new</span> <span class="n">results</span> <span class="n">to</span> <span class="n">prior</span> <span class="n">results</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Optionally</span> <span class="n">prints</span> <span class="n">source</span> <span class="n">data</span> <span class="n">names</span> <span class="n">affected</span> <span class="n">by</span> <span class="n">the</span> <span class="n">new</span> <span class="n">context</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Optionally</span> <span class="n">updates</span> <span class="n">the</span> <span class="n">headers</span> <span class="n">of</span> <span class="n">file</span><span class="o">-</span><span class="n">based</span> <span class="n">data</span> <span class="k">with</span> <span class="n">new</span> <span class="n">recommendations</span><span class="o">.</span>


<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">n</span> <span class="n">NEW_CONTEXT</span><span class="p">,</span> <span class="o">--</span><span class="n">new</span><span class="o">-</span><span class="n">context</span> <span class="n">NEW_CONTEXT</span>
                        <span class="n">Compute</span> <span class="n">the</span> <span class="n">updated</span> <span class="n">best</span> <span class="n">references</span> <span class="n">using</span> <span class="n">this</span> <span class="n">context</span><span class="o">.</span> <span class="n">Uses</span> <span class="n">current</span> <span class="n">operational</span> <span class="n">context</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OLD_CONTEXT</span><span class="p">,</span> <span class="o">--</span><span class="n">old</span><span class="o">-</span><span class="n">context</span> <span class="n">OLD_CONTEXT</span>
                        <span class="n">Compare</span> <span class="n">bestrefs</span> <span class="n">recommendations</span> <span class="kn">from</span> <span class="nn">two</span> <span class="n">contexts</span><span class="o">.</span>
  <span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">old</span><span class="o">-</span><span class="n">headers</span>   <span class="n">Fetch</span> <span class="n">old</span> <span class="n">headers</span> <span class="ow">in</span> <span class="n">accord</span> <span class="k">with</span> <span class="n">old</span> <span class="n">parameter</span> <span class="n">lists</span><span class="o">.</span>   <span class="n">Slower</span><span class="p">,</span>  <span class="n">avoid</span> <span class="n">unless</span> <span class="n">required</span><span class="o">.</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">compare</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">bestrefs</span>
                        <span class="n">Compare</span> <span class="n">new</span> <span class="n">bestrefs</span> <span class="n">recommendations</span> <span class="n">to</span> <span class="n">recommendations</span> <span class="kn">from</span> <span class="nn">data</span> <span class="n">source</span><span class="p">,</span>  <span class="n">files</span> <span class="ow">or</span> <span class="n">database</span><span class="o">.</span>
  <span class="o">-</span><span class="n">f</span> <span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">],</span> <span class="o">--</span><span class="n">files</span> <span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">Dataset</span> <span class="n">files</span> <span class="n">to</span> <span class="n">compute</span> <span class="n">best</span> <span class="n">references</span> <span class="k">for</span><span class="o">.</span>
  <span class="o">-</span><span class="n">d</span> <span class="n">IDs</span> <span class="p">[</span><span class="n">IDs</span> <span class="o">...</span><span class="p">],</span> <span class="o">--</span><span class="n">datasets</span> <span class="n">IDs</span> <span class="p">[</span><span class="n">IDs</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">Dataset</span> <span class="n">ids</span> <span class="n">to</span> <span class="n">consult</span> <span class="n">database</span> <span class="k">for</span> <span class="n">matching</span> <span class="n">parameters</span> <span class="ow">and</span> <span class="n">old</span> <span class="n">results</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">instruments</span>     <span class="n">Compute</span> <span class="n">best</span> <span class="n">references</span> <span class="k">for</span> <span class="n">cataloged</span> <span class="n">datasets</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">supported</span> <span class="n">instruments</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span> <span class="n">INSTRUMENTS</span> <span class="p">[</span><span class="n">INSTRUMENTS</span> <span class="o">...</span><span class="p">],</span> <span class="o">--</span><span class="n">instruments</span> <span class="n">INSTRUMENTS</span> <span class="p">[</span><span class="n">INSTRUMENTS</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">Instruments</span> <span class="n">to</span> <span class="n">compute</span> <span class="n">best</span> <span class="n">references</span> <span class="k">for</span><span class="p">,</span> <span class="nb">all</span> <span class="n">historical</span> <span class="n">datasets</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span>
  <span class="o">-</span><span class="n">t</span> <span class="n">REFERENCE_TYPES</span> <span class="p">[</span><span class="n">REFERENCE_TYPES</span> <span class="o">...</span><span class="p">],</span> <span class="o">--</span><span class="n">types</span> <span class="n">REFERENCE_TYPES</span> <span class="p">[</span><span class="n">REFERENCE_TYPES</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">A</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">reference</span> <span class="n">types</span> <span class="n">to</span> <span class="n">process</span><span class="p">,</span>  <span class="n">defaulting</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">types</span><span class="o">.</span>
  <span class="o">-</span><span class="n">k</span> <span class="n">SKIPPED_REFERENCE_TYPES</span> <span class="p">[</span><span class="n">SKIPPED_REFERENCE_TYPES</span> <span class="o">...</span><span class="p">],</span> <span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">types</span> <span class="n">SKIPPED_REFERENCE_TYPES</span> <span class="p">[</span><span class="n">SKIPPED_REFERENCE_TYPES</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">A</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">reference</span> <span class="n">types</span> <span class="n">which</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">processed</span><span class="p">,</span>  <span class="n">defaulting</span> <span class="n">to</span> <span class="n">nothing</span><span class="o">.</span>
  <span class="o">--</span><span class="n">diffs</span><span class="o">-</span><span class="n">only</span>          <span class="n">For</span> <span class="n">context</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">context</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">choose</span> <span class="n">only</span> <span class="n">instruments</span> <span class="ow">and</span> <span class="n">types</span> <span class="kn">from</span> <span class="nn">context</span> <span class="n">differences</span><span class="o">.</span>
  <span class="o">--</span><span class="n">datasets</span><span class="o">-</span><span class="n">since</span> <span class="n">DATASETS_SINCE</span>
                        <span class="n">Cut</span><span class="o">-</span><span class="n">off</span> <span class="n">date</span> <span class="k">for</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">none</span> <span class="n">earlier</span> <span class="n">than</span> <span class="n">this</span><span class="o">.</span>  <span class="n">Use</span> <span class="s1">&#39;auto&#39;</span> <span class="n">to</span> <span class="n">exploit</span> <span class="n">reference</span> <span class="n">USEAFTER</span><span class="o">.</span>
  <span class="o">-</span><span class="n">p</span> <span class="p">[</span><span class="n">LOAD_PICKLES</span> <span class="p">[</span><span class="n">LOAD_PICKLES</span> <span class="o">...</span><span class="p">]],</span> <span class="o">--</span><span class="n">load</span><span class="o">-</span><span class="n">pickles</span> <span class="p">[</span><span class="n">LOAD_PICKLES</span> <span class="p">[</span><span class="n">LOAD_PICKLES</span> <span class="o">...</span><span class="p">]]</span>
                        <span class="n">Load</span> <span class="n">dataset</span> <span class="n">headers</span> <span class="ow">and</span> <span class="n">prior</span> <span class="n">bestrefs</span> <span class="kn">from</span> <span class="nn">pickle</span> <span class="n">files</span><span class="p">,</span>  <span class="ow">in</span> <span class="n">worst</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">best</span> <span class="n">update</span> <span class="n">order</span><span class="o">.</span>  <span class="n">Can</span> <span class="n">also</span> <span class="n">load</span> <span class="o">.</span><span class="n">json</span> <span class="n">files</span><span class="o">.</span>
  <span class="o">-</span><span class="n">a</span> <span class="n">SAVE_PICKLE</span><span class="p">,</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">pickle</span> <span class="n">SAVE_PICKLE</span>
                        <span class="n">Write</span> <span class="n">out</span> <span class="n">the</span> <span class="n">combined</span> <span class="n">dataset</span> <span class="n">headers</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">pickle</span> <span class="n">file</span><span class="o">.</span>  <span class="n">Can</span> <span class="n">also</span> <span class="n">store</span> <span class="o">.</span><span class="n">json</span> <span class="n">file</span><span class="o">.</span>
  <span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">pickle</span>       <span class="n">Replace</span> <span class="n">source</span> <span class="n">bestrefs</span> <span class="k">with</span> <span class="n">CRDS</span> <span class="n">bestrefs</span> <span class="ow">in</span> <span class="n">output</span> <span class="n">pickle</span><span class="o">.</span>  <span class="n">For</span> <span class="n">setting</span> <span class="n">up</span> <span class="n">regression</span> <span class="n">tests</span><span class="o">.</span>
  <span class="o">--</span><span class="n">only</span><span class="o">-</span><span class="n">ids</span> <span class="p">[</span><span class="n">IDS</span> <span class="p">[</span><span class="n">IDS</span> <span class="o">...</span><span class="p">]]</span>
                        <span class="n">If</span> <span class="n">specified</span><span class="p">,</span> <span class="n">process</span> <span class="n">only</span> <span class="n">the</span> <span class="n">listed</span> <span class="n">dataset</span> <span class="n">ids</span><span class="o">.</span>
  <span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">bestrefs</span>
                        <span class="n">Update</span> <span class="n">sources</span> <span class="k">with</span> <span class="n">new</span> <span class="n">best</span> <span class="n">reference</span> <span class="n">recommendations</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span>      <span class="n">Print</span> <span class="n">names</span> <span class="n">of</span> <span class="n">products</span> <span class="k">for</span> <span class="n">which</span> <span class="n">the</span> <span class="n">new</span> <span class="n">context</span> <span class="n">would</span> <span class="n">assign</span> <span class="n">new</span> <span class="n">references</span> <span class="k">for</span> <span class="n">some</span> <span class="n">exposure</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span><span class="o">-</span><span class="n">details</span>
                        <span class="n">Include</span> <span class="n">instrument</span> <span class="ow">and</span> <span class="n">affected</span> <span class="n">types</span> <span class="ow">in</span> <span class="n">addition</span> <span class="n">to</span> <span class="n">compound</span> <span class="n">names</span> <span class="n">of</span> <span class="n">affected</span> <span class="n">exposures</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">references</span>
                        <span class="n">Prints</span> <span class="n">one</span> <span class="n">line</span> <span class="n">per</span> <span class="n">reference</span> <span class="n">file</span> <span class="n">change</span><span class="o">.</span>  <span class="n">If</span> <span class="n">no</span> <span class="n">comparison</span> <span class="n">requested</span><span class="p">,</span>  <span class="n">prints</span> <span class="nb">all</span> <span class="n">bestrefs</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">update</span><span class="o">-</span><span class="n">counts</span>
                        <span class="n">Prints</span> <span class="n">dictionary</span> <span class="n">of</span> <span class="n">update</span> <span class="n">counts</span> <span class="n">by</span> <span class="n">instrument</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">,</span>  <span class="n">status</span> <span class="n">on</span> <span class="n">updated</span> <span class="n">files</span><span class="o">.</span>
  <span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">remote</span><span class="o">-</span><span class="n">bestrefs</span>
                        <span class="n">Compute</span> <span class="n">best</span> <span class="n">references</span> <span class="n">on</span> <span class="n">CRDS</span> <span class="n">server</span><span class="p">,</span>  <span class="n">convenience</span> <span class="k">for</span> <span class="n">env</span> <span class="n">var</span> <span class="n">CRDS_MODE</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span>
  <span class="o">-</span><span class="n">m</span> <span class="n">SYNC_MAPPINGS</span><span class="p">,</span> <span class="o">--</span><span class="n">sync</span><span class="o">-</span><span class="n">mappings</span> <span class="n">SYNC_MAPPINGS</span>
                        <span class="n">Fetch</span> <span class="n">the</span> <span class="n">required</span> <span class="n">context</span> <span class="n">mappings</span> <span class="n">to</span> <span class="n">the</span> <span class="n">local</span> <span class="n">cache</span><span class="o">.</span>  <span class="n">Defaults</span> <span class="n">TRUE</span><span class="o">.</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SYNC_REFERENCES</span><span class="p">,</span> <span class="o">--</span><span class="n">sync</span><span class="o">-</span><span class="n">references</span> <span class="n">SYNC_REFERENCES</span>
                        <span class="n">Fetch</span> <span class="n">the</span> <span class="n">refefences</span> <span class="n">recommended</span> <span class="n">by</span> <span class="n">new</span> <span class="n">context</span> <span class="n">to</span> <span class="n">the</span> <span class="n">local</span> <span class="n">cache</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">FALSE</span><span class="o">.</span>
  <span class="o">--</span><span class="n">differences</span><span class="o">-</span><span class="n">are</span><span class="o">-</span><span class="n">errors</span>
                        <span class="n">Treat</span> <span class="n">recommendation</span> <span class="n">differences</span> <span class="n">between</span> <span class="n">new</span> <span class="n">context</span> <span class="ow">and</span> <span class="n">original</span> <span class="n">source</span> <span class="k">as</span> <span class="n">errors</span><span class="o">.</span>
  <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">bad</span><span class="o">-</span><span class="n">rules</span>     <span class="n">Only</span> <span class="n">warn</span> <span class="k">if</span> <span class="n">a</span> <span class="n">context</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">marked</span> <span class="s1">&#39;bad&#39;</span> <span class="ow">is</span> <span class="n">used</span><span class="p">,</span> <span class="n">otherwise</span> <span class="n">error</span><span class="o">.</span>
  <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">bad</span><span class="o">-</span><span class="n">references</span>
                        <span class="n">Only</span> <span class="n">warn</span> <span class="k">if</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">marked</span> <span class="n">bad</span> <span class="ow">is</span> <span class="n">recommended</span><span class="p">,</span> <span class="n">otherwise</span> <span class="n">error</span><span class="o">.</span>
  <span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="o">--</span><span class="n">bad</span><span class="o">-</span><span class="n">files</span><span class="o">-</span><span class="n">are</span><span class="o">-</span><span class="n">errors</span>
                        <span class="n">DEPRECATED</span> <span class="o">/</span> <span class="n">default</span><span class="p">;</span>  <span class="n">Recommendations</span> <span class="n">of</span> <span class="n">known</span> <span class="n">bad</span><span class="o">/</span><span class="n">invalid</span> <span class="n">files</span> <span class="n">are</span> <span class="n">errors</span><span class="p">,</span> <span class="ow">not</span> <span class="n">warnings</span><span class="o">.</span>  <span class="n">Use</span> <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">bad</span><span class="o">-...</span> <span class="n">to</span> <span class="n">override</span><span class="o">.</span>
  <span class="o">--</span><span class="n">undefined</span><span class="o">-</span><span class="n">differences</span><span class="o">-</span><span class="n">matter</span>
                        <span class="n">If</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">,</span> <span class="n">a</span> <span class="n">transition</span> <span class="kn">from</span> <span class="nn">UNDEFINED</span> <span class="n">to</span> <span class="n">anything</span> <span class="k">else</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">considered</span> <span class="n">a</span> <span class="n">difference</span> <span class="n">error</span><span class="o">.</span>
  <span class="o">--</span><span class="n">na</span><span class="o">-</span><span class="n">differences</span><span class="o">-</span><span class="n">matter</span>
                        <span class="n">If</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">,</span>  <span class="n">either</span> <span class="n">CDBS</span> <span class="ow">or</span> <span class="n">CRDS</span> <span class="n">recommending</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span> <span class="ow">is</span> <span class="n">OK</span> <span class="n">to</span> <span class="n">mismatch</span><span class="o">.</span>
  <span class="o">--</span><span class="n">compare</span><span class="o">-</span><span class="n">cdbs</span>        <span class="n">Abbreviation</span> <span class="k">for</span> <span class="o">--</span><span class="n">compare</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">bestrefs</span> <span class="o">--</span><span class="n">differences</span><span class="o">-</span><span class="n">are</span><span class="o">-</span><span class="n">errors</span> <span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span> <span class="o">--</span><span class="n">stats</span>
  <span class="o">--</span><span class="n">affected</span><span class="o">-</span><span class="n">datasets</span>   <span class="n">Abbreviation</span> <span class="k">for</span> <span class="o">--</span><span class="n">diffs</span><span class="o">-</span><span class="n">only</span> <span class="o">--</span><span class="n">datasets</span><span class="o">-</span><span class="n">since</span><span class="o">=</span><span class="n">auto</span> <span class="o">--</span><span class="n">optimize</span><span class="o">-</span><span class="n">tables</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">update</span><span class="o">-</span><span class="n">counts</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span> <span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span> <span class="o">--</span><span class="n">stats</span>
  <span class="o">-</span><span class="n">z</span><span class="p">,</span> <span class="o">--</span><span class="n">optimize</span><span class="o">-</span><span class="n">tables</span>
                        <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">apply</span> <span class="n">row</span><span class="o">-</span><span class="n">based</span> <span class="n">optimizations</span> <span class="n">to</span> <span class="n">screen</span> <span class="n">out</span> <span class="n">inconsequential</span> <span class="n">table</span> <span class="n">updates</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span>  <span class="n">Record</span> <span class="ow">and</span> <span class="n">dump</span> <span class="n">the</span> <span class="n">first</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">each</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">error</span><span class="o">.</span>
  <span class="o">--</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span><span class="o">-</span><span class="n">file</span> <span class="n">UNIQUE_ERRORS_FILE</span>
                        <span class="n">Write</span> <span class="n">out</span> <span class="n">data</span> <span class="n">names</span> <span class="p">(</span><span class="n">ids</span> <span class="ow">or</span> <span class="n">filenames</span><span class="p">)</span> <span class="k">for</span> <span class="n">first</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">unique</span> <span class="n">errors</span> <span class="n">to</span> <span class="n">specified</span> <span class="n">file</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">errors</span><span class="o">-</span><span class="n">file</span> <span class="n">ALL_ERRORS_FILE</span>
                        <span class="n">Write</span> <span class="n">out</span> <span class="nb">all</span> <span class="n">err</span><span class="s1">&#39;ing data names (ids or filenames) to specified file.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">nominal</span> <span class="n">debug</span> <span class="n">level</span><span class="o">.</span>
  <span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span>
                        <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">level</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mf">100.</span>
  <span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">readonly</span><span class="o">-</span><span class="n">cache</span>  <span class="n">Don</span><span class="s1">&#39;t modify the CRDS cache.  Not compatible with options which implicitly modify the cache.</span>
  <span class="o">-</span><span class="n">I</span><span class="p">,</span> <span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">cache</span>    <span class="n">Download</span> <span class="n">required</span> <span class="n">files</span> <span class="n">even</span> <span class="k">if</span> <span class="n">they</span><span class="s1">&#39;re already in the cache.</span>
  <span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>         <span class="n">Print</span> <span class="n">the</span> <span class="n">software</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">exit</span><span class="o">.</span>
  <span class="o">-</span><span class="n">J</span><span class="p">,</span> <span class="o">--</span><span class="n">jwst</span>            <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">JWST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">H</span><span class="p">,</span> <span class="o">--</span><span class="n">hst</span>             <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">HST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
  <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">time</span>            <span class="n">Add</span> <span class="n">date</span><span class="o">/</span><span class="n">time</span> <span class="n">to</span> <span class="n">log</span> <span class="n">messages</span><span class="o">.</span>
</pre></div>
</div>
<div class="section" id="file-oriented-best-references">
<h3>File Oriented Best References<a class="headerlink" href="#file-oriented-best-references" title="Permalink to this headline">¶</a></h3>
<p>The most common end-user use case for crds.bestrefs is to assign best references to the header keywords of
dataset FITS files.   This can be done as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">bestrefs</span> <span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">bestrefs</span> <span class="o">--</span><span class="n">sync</span><span class="o">-</span><span class="n">references</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">files</span> <span class="n">j8bt05njq_raw</span><span class="o">.</span><span class="n">fits</span> <span class="n">j8bt06o6q_raw</span><span class="o">.</span><span class="n">fits</span> <span class="n">j8bt09jcq_raw</span><span class="o">.</span><span class="n">fits</span> <span class="o">...</span>
</pre></div>
</div>
<p>which will use the CRDS rules currently operational in the pipeline and download any required CRDS rules and reference files
to your CRDS cache automatically.   No download should occur for previously cached files or the default group readonly reference
cache.</p>
<p>A specific historical set of CRDS rules can be used by specifying –new-context:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">bestrefs</span> <span class="o">--</span><span class="n">new</span><span class="o">-</span><span class="n">context</span> <span class="n">hst_0294</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">bestrefs</span> <span class="o">--</span><span class="n">sync</span><span class="o">-</span><span class="n">references</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">files</span> <span class="n">j8bt05njq_raw</span><span class="o">.</span><span class="n">fits</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="new-context">
<h3>New Context<a class="headerlink" href="#new-context" title="Permalink to this headline">¶</a></h3>
<p>crds.bestrefs always computes best references with respect to a context which can be explicitly specified with the
–new-context parameter.    If –new-context is not specified,  the default operational context is determined by
consulting the CRDS server or looking in the local cache.</p>
</div>
<div class="section" id="lookup-parameter-sources">
<h3>Lookup Parameter Sources<a class="headerlink" href="#lookup-parameter-sources" title="Permalink to this headline">¶</a></h3>
<p>The two primary modes for bestrefs involve the source of reference file matching parameters.   Conceptually
lookup parameters are always associated with particular datasets and used to identify the references
required to process those datasets.</p>
<p>The options –files, –datasets, –instruments, and –all-instruments determine the source of lookup parameters:</p>
<ol class="arabic">
<li><p class="first">To find best references for a list of files do something like this:</p>
<blockquote>
<div><p>% crds bestrefs –new-context hst.pmap –file j8bt05njq_raw.fits j8bt06o6q_raw.fits j8bt09jcq_raw.fits</p>
</div></blockquote>
</li>
</ol>
<p>the first parameter, hst.pmap,  is the context with respect to which best references are determined.</p>
<ol class="arabic" start="2">
<li><p class="first">To find best references for a list of catalog dataset ids do something like this:</p>
<blockquote>
<div><p>% crds bestrefs –new-context hst.pmap –datasets j8bt05njq j8bt06o6q j8bt09jcq</p>
</div></blockquote>
</li>
<li><p class="first">To do mass scale testing for all cataloged datasets for a particular instrument(s) do:</p>
<blockquote>
<div><p>% crds bestrefs –new-context hst.pmap –instruments acs</p>
</div></blockquote>
</li>
<li><p class="first">To do mass scale testing for all supported instruments for all cataloged datasets do:</p>
<blockquote>
<div><p>% crds bestrefs –new-context hst.pmap –all-instruments</p>
<p>or to test for differences between two contexts</p>
<p>% crds bestrefs –new-context hst_0002.pmap –old-context hst_0001.pmap –all-instruments</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="comparison-modes">
<h3>Comparison Modes<a class="headerlink" href="#comparison-modes" title="Permalink to this headline">¶</a></h3>
<p>The –old-context and –compare-source-bestrefs parameters define the best references comparison mode.  Each names
the origin of a set of prior recommendations and implicitly requests a comparison to the recommendations from
the newly computed bestrefs determined by –new-context.</p>
<div class="section" id="context-to-context">
<h4>Context-to-Context<a class="headerlink" href="#context-to-context" title="Permalink to this headline">¶</a></h4>
<p>–old-context can be used to specify a second context for which bestrefs are dynamically computed; –old-context
implies that a bestrefs comparison will be made with –new-context.   If –old-context is not specified,  it
defaults to None.</p>
</div>
<div class="section" id="prior-source-recommendations">
<h4>Prior Source Recommendations<a class="headerlink" href="#prior-source-recommendations" title="Permalink to this headline">¶</a></h4>
<p>–compare-source-bestrefs requests that the bestrefs from –new-context be compared to the bestrefs which are
recorded with the lookup parameter data,  either in the file headers of data files,  or in the catalog.   In both
cases the prior best references are recorded static values,  not dynamically computed bestrefs.</p>
</div>
</div>
<div class="section" id="output-modes">
<h3>Output Modes<a class="headerlink" href="#output-modes" title="Permalink to this headline">¶</a></h3>
<p>crds.bestrefs supports several output modes for bestrefs and comparison results to standard out.</p>
<p>If –print-affected is specified,  crds.bestrefs will print out the name of any file for which at least one update for
one reference type was recommended.   This is essentially a list of files to be reprocessed with new references.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">bestrefs</span> <span class="o">--</span><span class="n">new</span><span class="o">-</span><span class="n">context</span> <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">j8bt05njq_raw</span><span class="o">.</span><span class="n">fits</span> <span class="n">j8bt06o6q_raw</span><span class="o">.</span><span class="n">fits</span> <span class="n">j8bt09jcq_raw</span><span class="o">.</span><span class="n">fits</span> \
    <span class="o">--</span><span class="n">compare</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">bestrefs</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span>
<span class="n">j8bt05njq_raw</span><span class="o">.</span><span class="n">fits</span>
<span class="n">j8bt06o6q_raw</span><span class="o">.</span><span class="n">fits</span>
<span class="n">j8bt09jcq_raw</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
</div>
<div class="section" id="update-modes">
<h3>Update Modes<a class="headerlink" href="#update-modes" title="Permalink to this headline">¶</a></h3>
<p>crds.bestrefs initially supports one mode for updating the best reference recommendations recorded in data files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">bestrefs</span> <span class="o">--</span><span class="n">new</span><span class="o">-</span><span class="n">context</span> <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">j8bt05njq_raw</span><span class="o">.</span><span class="n">fits</span> <span class="n">j8bt06o6q_raw</span><span class="o">.</span><span class="n">fits</span> <span class="n">j8bt09jcq_raw</span><span class="o">.</span><span class="n">fits</span> \
    <span class="o">--</span><span class="n">compare</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">bestrefs</span> <span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="n">bestrefs</span>
</pre></div>
</div>
</div>
<div class="section" id="verbosity">
<h3>Verbosity<a class="headerlink" href="#verbosity" title="Permalink to this headline">¶</a></h3>
<p>crds.bestrefs has –verbose and –verbosity=N parameters which can increase the amount of informational
and debug output.</p>
</div>
<div class="section" id="bad-files">
<h3>Bad Files<a class="headerlink" href="#bad-files" title="Permalink to this headline">¶</a></h3>
<p>CRDS files can be designated as scientifically invalid on the CRDS server by the CRDS team.   Knowledge of bad
files is synchronized to remote caches by crds.bestrefs and crds.sync.  By default, attempting to use bad rules or
assign bad references will generate errors and fail.   crds.bestrefs supports two command line switches,
<em>—allow-bad-rules</em> and <em>—allow-bad-references</em> to override the default handling of bad files and enable their
use with warnings.  Environment variables <strong>CRDS_ALLOW_BAD_RULES</strong> and <strong>CRDS_ALLOW_BAD_REFERENCES</strong> can also be
set to 1 to establish warnings rather than errors as the default.</p>
</div>
</div>
<div class="section" id="crds-sync">
<h2>crds.sync<a class="headerlink" href="#crds-sync" title="Permalink to this headline">¶</a></h2>
<p>The CRDS sync tool is used to download CRDS rules and references from the CRDS server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">homer</span><span class="o">/</span><span class="n">homer_ureka</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">crds</span><span class="o">/</span><span class="n">sync</span><span class="o">.</span><span class="n">py</span>
      <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">contexts</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="o">...</span><span class="p">]]]</span> <span class="p">[</span><span class="o">--</span><span class="nb">range</span> <span class="n">MIN</span><span class="p">:</span><span class="n">MAX</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">all</span><span class="p">]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">last</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">contexts</span> <span class="n">N</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">files</span> <span class="p">[</span><span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">]]]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">dataset</span><span class="o">-</span><span class="n">files</span> <span class="p">[</span><span class="n">DATASET</span> <span class="p">[</span><span class="n">DATASET</span> <span class="o">...</span><span class="p">]]]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">dataset</span><span class="o">-</span><span class="n">ids</span> <span class="p">[</span><span class="n">DATASET</span> <span class="p">[</span><span class="n">DATASET</span> <span class="o">...</span><span class="p">]]]</span> <span class="p">[</span><span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">references</span><span class="p">]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">references</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">mappings</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">k</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">rejected</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">blacklisted</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">sqlite</span><span class="o">-</span><span class="n">db</span><span class="p">]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">organize</span> <span class="p">[</span><span class="n">NEW_SUBDIR_MODE</span><span class="p">]]</span> <span class="p">[</span><span class="o">--</span><span class="n">organize</span><span class="o">-</span><span class="n">delete</span><span class="o">-</span><span class="n">junk</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">R</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">V</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">J</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">H</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">stats</span><span class="p">]</span>
      <span class="p">[</span><span class="o">--</span><span class="n">profile</span> <span class="n">PROFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">time</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">pdb</span><span class="p">]</span>

<span class="n">Synchronize</span> <span class="n">local</span> <span class="n">mapping</span> <span class="ow">and</span> <span class="n">reference</span> <span class="n">caches</span> <span class="k">for</span> <span class="n">the</span> <span class="n">given</span> <span class="n">contexts</span> <span class="n">by</span>
<span class="n">downloading</span> <span class="n">missing</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">CRDS</span> <span class="n">server</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">archive</span><span class="o">.</span>
</pre></div>
</div>
<p>optional arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">--</span><span class="n">contexts</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="o">...</span><span class="p">]]</span>
                      <span class="n">Specify</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">CRDS</span> <span class="n">mappings</span> <span class="n">to</span> <span class="n">operate</span> <span class="n">on</span><span class="p">:</span> <span class="o">.</span><span class="n">pmap</span><span class="p">,</span> <span class="o">.</span><span class="n">imap</span><span class="p">,</span> <span class="ow">or</span> <span class="o">.</span><span class="n">rmap</span> <span class="ow">or</span> <span class="n">date</span><span class="o">-</span><span class="n">based</span> <span class="n">specification</span>
<span class="o">--</span><span class="nb">range</span> <span class="n">MIN</span><span class="p">:</span><span class="n">MAX</span>       <span class="n">Operate</span> <span class="k">for</span> <span class="n">pipeline</span> <span class="n">context</span> <span class="n">ids</span> <span class="p">(</span><span class="o">.</span><span class="n">pmaps</span><span class="p">)</span> <span class="n">between</span> <span class="o">&lt;</span><span class="n">MIN</span><span class="o">&gt;</span> <span class="ow">and</span> <span class="o">&lt;</span><span class="n">MAX</span><span class="o">&gt;.</span>
<span class="o">--</span><span class="nb">all</span>                 <span class="n">Operate</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">known</span> <span class="n">CRDS</span> <span class="n">contexts</span><span class="o">.</span>
<span class="o">--</span><span class="n">last</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">contexts</span> <span class="n">N</span>   <span class="n">Operate</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">the</span> <span class="n">last</span> <span class="n">N</span> <span class="n">contexts</span><span class="o">.</span>
<span class="o">--</span><span class="n">files</span> <span class="p">[</span><span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">]]</span>
                      <span class="n">Explicitly</span> <span class="nb">list</span> <span class="n">files</span> <span class="n">to</span> <span class="n">be</span> <span class="n">synced</span><span class="o">.</span>
<span class="o">--</span><span class="n">dataset</span><span class="o">-</span><span class="n">files</span> <span class="p">[</span><span class="n">DATASET</span> <span class="p">[</span><span class="n">DATASET</span> <span class="o">...</span><span class="p">]]</span>
                      <span class="n">Cache</span> <span class="n">references</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">datasets</span> <span class="n">FITS</span> <span class="n">files</span><span class="o">.</span>
<span class="o">--</span><span class="n">dataset</span><span class="o">-</span><span class="n">ids</span> <span class="p">[</span><span class="n">DATASET</span> <span class="p">[</span><span class="n">DATASET</span> <span class="o">...</span><span class="p">]]</span>
                      <span class="n">Cache</span> <span class="n">references</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">dataset</span> <span class="n">ids</span><span class="o">.</span>
<span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">references</span>    <span class="n">Cache</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">references</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">contexts</span><span class="o">.</span>
<span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">references</span>    <span class="n">Remove</span> <span class="n">reference</span> <span class="n">files</span> <span class="ow">not</span> <span class="n">referred</span> <span class="n">to</span> <span class="n">by</span> <span class="n">contexts</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">cache</span><span class="o">.</span>
<span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">mappings</span>      <span class="n">Remove</span> <span class="n">mapping</span> <span class="n">files</span> <span class="ow">not</span> <span class="n">referred</span> <span class="n">to</span> <span class="n">by</span> <span class="n">contexts</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">cache</span><span class="o">.</span>
<span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span>             <span class="n">Don</span><span class="s1">&#39;t remove purged files, or repair files,  just print out their names.</span>
<span class="o">-</span><span class="n">k</span><span class="p">,</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">files</span>     <span class="n">Check</span> <span class="n">cached</span> <span class="n">files</span> <span class="n">against</span> <span class="n">the</span> <span class="n">CRDS</span> <span class="n">database</span> <span class="ow">and</span> <span class="n">report</span> <span class="n">anomalies</span><span class="o">.</span>
<span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">sha1sum</span>   <span class="n">For</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">files</span><span class="p">,</span>  <span class="n">also</span> <span class="n">verify</span> <span class="n">file</span> <span class="n">sha1sums</span><span class="o">.</span>
<span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">repair</span><span class="o">-</span><span class="n">files</span>    <span class="n">Repair</span> <span class="ow">or</span> <span class="n">re</span><span class="o">-</span><span class="n">download</span> <span class="n">files</span> <span class="n">noted</span> <span class="k">as</span> <span class="n">bad</span> <span class="n">by</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">files</span>
<span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">rejected</span>      <span class="n">Purge</span> <span class="n">files</span> <span class="n">noted</span> <span class="k">as</span> <span class="n">rejected</span> <span class="n">by</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">files</span>
<span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">blacklisted</span>   <span class="n">Purge</span> <span class="n">files</span> <span class="p">(</span><span class="ow">and</span> <span class="n">their</span> <span class="n">mapping</span> <span class="n">anscestors</span><span class="p">)</span> <span class="n">noted</span> <span class="k">as</span> <span class="n">blacklisted</span> <span class="n">by</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">files</span>
<span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">sqlite</span><span class="o">-</span><span class="n">db</span>     <span class="n">Download</span> <span class="n">a</span> <span class="n">sqlite3</span> <span class="n">version</span> <span class="n">of</span> <span class="n">the</span> <span class="n">CRDS</span> <span class="n">file</span> <span class="n">catalog</span><span class="o">.</span>
<span class="o">--</span><span class="n">organize</span> <span class="p">[</span><span class="n">NEW_SUBDIR_MODE</span><span class="p">]</span>
                      <span class="n">Migrate</span> <span class="n">cache</span> <span class="n">to</span> <span class="n">specified</span> <span class="n">structure</span><span class="p">,</span> <span class="s1">&#39;flat&#39;</span> <span class="ow">or</span> <span class="s1">&#39;instrument&#39;</span><span class="o">.</span> <span class="n">Perform</span> <span class="n">only</span> <span class="n">on</span> <span class="n">idle</span> <span class="n">caches</span><span class="o">.</span>
<span class="o">--</span><span class="n">organize</span><span class="o">-</span><span class="n">delete</span><span class="o">-</span><span class="n">junk</span>
                      <span class="n">When</span> <span class="o">--</span><span class="n">organize</span><span class="s1">&#39;ing, delete obstructing files or directories CRDS discovers.</span>
<span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">nominal</span> <span class="n">debug</span> <span class="n">level</span><span class="o">.</span>
<span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span>
                      <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">level</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mf">100.</span>
<span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">readonly</span><span class="o">-</span><span class="n">cache</span>  <span class="n">Don</span><span class="s1">&#39;t modify the CRDS cache.  Not compatible with options which implicitly modify the cache.</span>
<span class="o">-</span><span class="n">I</span><span class="p">,</span> <span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">cache</span>    <span class="n">Download</span> <span class="n">required</span> <span class="n">files</span> <span class="n">even</span> <span class="k">if</span> <span class="n">they</span><span class="s1">&#39;re already in the cache.</span>
<span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>         <span class="n">Print</span> <span class="n">the</span> <span class="n">software</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">exit</span><span class="o">.</span>
<span class="o">-</span><span class="n">J</span><span class="p">,</span> <span class="o">--</span><span class="n">jwst</span>            <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">JWST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
<span class="o">-</span><span class="n">H</span><span class="p">,</span> <span class="o">--</span><span class="n">hst</span>             <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">HST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
<span class="o">--</span><span class="n">stats</span>               <span class="n">Track</span> <span class="ow">and</span> <span class="nb">print</span> <span class="n">timing</span> <span class="n">statistics</span><span class="o">.</span>
<span class="o">--</span><span class="n">profile</span> <span class="n">PROFILE</span>     <span class="n">Output</span> <span class="n">profile</span> <span class="n">stats</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">file</span><span class="o">.</span>
<span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">time</span>            <span class="n">Add</span> <span class="n">date</span><span class="o">/</span><span class="n">time</span> <span class="n">to</span> <span class="n">log</span> <span class="n">messages</span><span class="o">.</span>
<span class="o">--</span><span class="n">pdb</span>                 <span class="n">Run</span> <span class="n">under</span> <span class="n">pdb</span><span class="o">.</span>
</pre></div>
</div>
<ul>
<li><p class="first">Dry-Running Cache Changes</p>
<blockquote>
<div><p>Since CRDS cache operations can involve significant network downloads,  as a general note,
crds.sync can be run with <em>—readonly-cache —verbose</em> switches to better determine what
the effects of any command should be.   This can be used to gauge download sizes or list
files before deleting them.</p>
</div></blockquote>
</li>
<li><p class="first">Syncing Specific Files</p>
<blockquote>
<div><p>Downloading an explicit list of files can be done by like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span>  <span class="o">--</span><span class="n">files</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_acs_darkfile_0037</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>this will download only those two files.</p>
</div></blockquote>
</li>
<li><p class="first">Syncing Rules</p>
<blockquote>
<div><p>Typically syncing CRDS files is done with respect to particular CRDS contexts:</p>
<p>Synced contexts can be explicitly listed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_0002</span><span class="o">.</span><span class="n">pmap</span>
</pre></div>
</div>
<p>this will recursively download all the mappings referred to by .pmaps 0001 and 0002.</p>
<p>Synced contexts can be specified as a numerical range:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="nb">range</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span>
</pre></div>
</div>
<p>this will also recursively download all the mappings referred to by .pmaps 0001, 002, 0003.</p>
<p>Synced contexts can be specified as –all contexts:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="nb">all</span>
</pre></div>
</div>
<p>this will recursively download all CRDS mappings for all time.</p>
</div></blockquote>
</li>
<li><p class="first">Syncing References By Context</p>
<blockquote>
<div><p>Because complete reference downloads can be enormous,  you must explicitly specify when
you wish to fetch the references which are enumerated in particular CRDS rules:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_0002</span><span class="o">.</span><span class="n">pmap</span>  <span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">references</span>
</pre></div>
</div>
<p>will download all the references mentioned by contexts 0001 and 0002.</p>
<p>This can be a huge (1T+) network download and should generally only be
used by institutions,  not individual researchers.</p>
<p><strong>NOTE:</strong> the contexts synced can be for particular instruments or types rather than
the entire pipeline,  e.g. hst_cos_0002.imap or hst_cos_proftab_0001.rmap</p>
</div></blockquote>
</li>
<li><p class="first">Removing Unused Files</p>
<blockquote>
<div><p>CRDS rules from <strong>unspecified</strong> contexts can be removed like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0004</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_0005</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">mappings</span>
</pre></div>
</div>
<p>while this would remove references which are <em>not</em> in contexts 4 or 5:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0004</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_0005</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">purge</span><span class="o">-</span><span class="n">references</span>
</pre></div>
</div>
<p>Again, both of these commands remove cached files which are not specified or implied.</p>
</div></blockquote>
</li>
<li><p class="first">References for Dataset Files</p>
<blockquote>
<div><p>References required by particular dataset files can be cached like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_0002</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">dataset</span><span class="o">-</span><span class="n">files</span>  <span class="o">&lt;</span><span class="n">dataset_files</span><span class="o">...&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">acs_J8D219010</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>This will fetch all the references required to support the listed datasets for contexts 0001 and 0002.</p>
<p>This mode does not update dataset file headers.  See also crds.bestrefs for similar functionality with header updates.</p>
</div></blockquote>
</li>
<li><p class="first">References for Dataset Ids</p>
<blockquote>
<div><p>References for particular dataset ids can be cached like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_0002</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">dataset</span><span class="o">-</span><span class="n">ids</span>  <span class="o">&lt;</span><span class="n">ids</span><span class="o">...&gt;</span>  <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">J6M915030</span>
</pre></div>
</div>
<p>This will fetch all the references required to support the listed dataset ids for contexts 0001 and 0002.</p>
</div></blockquote>
</li>
<li><p class="first">Checking and Repairing Large Caches</p>
<blockquote>
<div><p>Large Institutional caches can be checked and/or repaired like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">fetch</span><span class="o">-</span><span class="n">references</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">sha1sum</span> <span class="o">--</span><span class="n">repair</span><span class="o">-</span><span class="n">files</span>
</pre></div>
</div>
<p>will download all the files in hst_0001.pmap not already present.</p>
<p>Both mappings and references would then be checked for correct length, sha1sum, and status.</p>
<p>Any files with bad length or checksum would then be deleted and re-downloaded.   This is really intended
for a large <em>existing</em> cache.</p>
<p>File checksum verification is optional because it is time consuming.  Verifying the contents of the current
HST shared cache requires 8-10 hours.   In contrast, doing simple length, existence, and status checks
takes 5-10 minutes,  sufficient for a quick check but not foolproof.</p>
</div></blockquote>
</li>
<li><p class="first">Checking Smaller Caches,  Identifying Foreign Files</p>
<blockquote>
<div><p>The simplest approach for “repairing” a small cache is to delete it and resync.   One might do this
after making temporary modifications to cached files to return to the archived version:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>% rm -rf $CRDS_PATH
% crds sync  -- ...  # repeat whatever syncs you did to cache files of interest
</pre></div>
</div>
<p>A more complicated but also more precise approach can operate only on files already in the CRDS cache:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>% crds sync --repair-files --check-sha1sum --files `crds list --all --cached-mappings --cached-references`
</pre></div>
</div>
<p>This approach works by using the crds.list command to dump the file names of all files in the CRDS cache
and then using the crds.sync command to check exactly those files.</p>
<p>Since crds.list will print the name of any file in the cache,  not just files from CRDS,  the second approach can
also be used to detect (most likely test) files which are not from CRDS.</p>
<p>For smaller caches <em>–check-sha1sum</em> is likekly to be less of a performance/runtime issue and should be used
to detect files which have changed in contents but not in length.</p>
</div></blockquote>
</li>
<li><p class="first">Removing Blacklisted or Rejected Files</p>
<blockquote>
<div><p>crds.sync can be used to remove the files from specific contexts which have been marked as “bad”.</p>
<blockquote>
<div><p>% crds sync –contexts hst_0001.pmap –fetch-references –check-files –purge-rejected –purge-blacklisted</p>
</div></blockquote>
<p>would first sync the cache downloading all the files in hst_0001.pmap.  Both mappings and references would then
be checked for correct length.   Files reported as rejected or blacklisted by the server would be removed.</p>
</div></blockquote>
</li>
<li><p class="first">Reorganizing Cache Structure</p>
<blockquote>
<div><p>CRDS now supports two cache structures for organizing references: flat and instrument.  <em>flat</em> places all references
for a telescope in a single directory,  e.g. references/hst.   <em>instrument</em> segregates references into subdirectories
which name instruments or legacy environment variables,  e.g. acs or jref.</p>
<p>Newly created caches will default to the <em>instrument</em> organization.  To migrate a legacy cache with a flat single
directory layout to the new structure,  sync with –organize=instrument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="n">organize</span><span class="o">=</span><span class="n">instrument</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>To migrate to the flat structure,  use –organize=flat:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">sync</span> <span class="o">--</span><span class="n">organize</span><span class="o">=</span><span class="n">flat</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>While reorganizing, if CRDS makes note of “junk files” in your cache which are
obstructing the process of reorganizing, you can allow CRDS to delete the junk
by adding –organize-delete-junk.</p>
<p>The –organize switches are intended to be used only on inactive file caches
when calibration software is not running and actively using CRDS.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="crds-certify">
<h2>crds.certify<a class="headerlink" href="#crds-certify" title="Permalink to this headline">¶</a></h2>
<p>crds.certify checks a reference or mapping file against constraints on legal
matching parameter values.   For reference files,  crds.certify also performs checks
of the FITS format and when given a context,  and will compare the given file against
the file it replaces looking for new or missing table rows.</p>
<ul>
<li><p class="first">crds certify –help yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">homer</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">workspace_crds</span><span class="o">/</span><span class="n">CRDS</span><span class="o">/</span><span class="n">crds</span><span class="o">/</span><span class="n">certify</span><span class="o">.</span><span class="n">py</span>
   <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">e</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="n">COMPARISON_CONTEXT</span><span class="p">]</span>
   <span class="p">[</span><span class="o">-</span><span class="n">y</span> <span class="n">COMPARISON_REFERENCE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span><span class="p">]</span>
   <span class="p">[</span><span class="o">--</span><span class="n">unique</span><span class="o">-</span><span class="n">errors</span><span class="o">-</span><span class="n">file</span> <span class="n">UNIQUE_ERRORS_FILE</span><span class="p">]</span>
   <span class="p">[</span><span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">errors</span><span class="o">-</span><span class="n">file</span> <span class="n">ALL_ERRORS_FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">R</span><span class="p">]</span>
   <span class="p">[</span><span class="o">-</span><span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">V</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">J</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">H</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">stats</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">profile</span> <span class="n">PROFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">time</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">pdb</span><span class="p">]</span>
   <span class="p">[</span><span class="o">--</span><span class="n">debug</span><span class="o">-</span><span class="n">traps</span><span class="p">]</span>
   <span class="n">files</span> <span class="p">[</span><span class="n">files</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first">Checks a CRDS reference or mapping file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">Verifies</span> <span class="n">basic</span> <span class="n">file</span> <span class="nb">format</span><span class="p">:</span> <span class="o">.</span><span class="n">fits</span><span class="p">,</span> <span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="o">.</span><span class="n">yaml</span><span class="p">,</span> <span class="o">.</span><span class="n">asdf</span><span class="p">,</span> <span class="o">.</span><span class="n">pmap</span><span class="p">,</span> <span class="o">.</span><span class="n">imap</span><span class="p">,</span> <span class="o">.</span><span class="n">rmap</span>
<span class="mf">2.</span> <span class="n">Checks</span> <span class="n">references</span> <span class="k">for</span> <span class="n">required</span> <span class="n">keywords</span> <span class="ow">and</span> <span class="n">values</span><span class="p">,</span> <span class="n">where</span> <span class="n">constraints</span> <span class="n">are</span> <span class="n">defined</span><span class="o">.</span>
<span class="mf">3.</span> <span class="n">Checks</span> <span class="n">CRDS</span> <span class="n">rules</span> <span class="k">for</span> <span class="n">permissible</span> <span class="n">values</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">defined</span> <span class="n">reference</span> <span class="n">constraints</span><span class="o">.</span>
<span class="mf">4.</span> <span class="n">Checks</span> <span class="n">CRDS</span> <span class="n">rules</span> <span class="k">for</span> <span class="n">accidental</span> <span class="n">file</span> <span class="n">reversions</span> <span class="ow">or</span> <span class="n">duplicate</span> <span class="n">lines</span><span class="o">.</span>
<span class="mf">5.</span> <span class="n">Checks</span> <span class="n">CRDS</span> <span class="n">rules</span> <span class="k">for</span> <span class="n">noteworthy</span> <span class="n">version</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">version</span> <span class="n">changes</span> <span class="n">such</span> <span class="k">as</span> <span class="n">new</span> <span class="ow">or</span> <span class="n">removed</span> <span class="n">match</span> <span class="n">cases</span><span class="o">.</span>
<span class="mf">6.</span> <span class="n">Checks</span> <span class="n">tables</span> <span class="k">for</span> <span class="n">deleted</span> <span class="ow">or</span> <span class="n">duplicate</span> <span class="n">rows</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">a</span> <span class="n">comparison</span> <span class="n">table</span><span class="o">.</span>
<span class="mf">7.</span> <span class="n">Finds</span> <span class="n">comparison</span> <span class="n">references</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">old</span> <span class="n">CRDS</span> <span class="n">contexts</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first">positional arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">files</span>
</pre></div>
</div>
</li>
<li><p class="first">optional arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">--</span><span class="n">deep</span>            <span class="n">Certify</span> <span class="n">reference</span> <span class="n">files</span> <span class="n">referred</span> <span class="n">to</span> <span class="n">by</span> <span class="n">mappings</span> <span class="n">have</span> <span class="n">valid</span> <span class="n">contents</span><span class="o">.</span>
<span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">dont</span><span class="o">-</span><span class="n">recurse</span><span class="o">-</span><span class="n">mappings</span>   <span class="n">Do</span> <span class="ow">not</span> <span class="n">load</span> <span class="ow">and</span> <span class="n">validate</span> <span class="n">mappings</span> <span class="n">recursively</span><span class="p">,</span>  <span class="n">checking</span> <span class="n">only</span> <span class="n">directly</span> <span class="n">specified</span> <span class="n">files</span><span class="o">.</span>
<span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">--</span><span class="n">dont</span><span class="o">-</span><span class="n">parse</span>      <span class="n">Skip</span> <span class="n">slow</span> <span class="n">mapping</span> <span class="n">parse</span> <span class="n">based</span> <span class="n">checks</span><span class="p">,</span>  <span class="n">including</span> <span class="n">mapping</span> <span class="n">duplicate</span> <span class="n">entry</span> <span class="n">checking</span><span class="o">.</span>
<span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="o">--</span><span class="n">exist</span>           <span class="n">Certify</span> <span class="n">reference</span> <span class="n">files</span> <span class="n">referred</span> <span class="n">to</span> <span class="n">by</span> <span class="n">mappings</span> <span class="n">exist</span><span class="o">.</span>
<span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">provenance</span>  <span class="n">Dump</span> <span class="n">provenance</span> <span class="n">keywords</span><span class="o">.</span>
<span class="o">-</span><span class="n">x</span> <span class="n">COMPARISON_CONTEXT</span><span class="p">,</span> <span class="o">--</span><span class="n">comparison</span><span class="o">-</span><span class="n">context</span> <span class="n">COMPARISON_CONTEXT</span>   <span class="n">Pipeline</span> <span class="n">context</span> <span class="n">defining</span> <span class="n">comparison</span> <span class="n">files</span><span class="o">.</span>  <span class="n">Defaults</span> <span class="n">to</span> <span class="n">operational</span> <span class="n">context</span><span class="p">,</span>  <span class="n">use</span> <span class="s1">&#39;none&#39;</span> <span class="n">to</span> <span class="n">suppress</span><span class="o">.</span>
<span class="o">-</span><span class="n">y</span> <span class="n">COMPARISON_REFERENCE</span><span class="p">,</span> <span class="o">--</span><span class="n">comparison</span><span class="o">-</span><span class="n">reference</span> <span class="n">COMPARISON_REFERENCE</span>  <span class="n">Comparison</span> <span class="n">reference</span> <span class="k">for</span> <span class="n">tables</span> <span class="n">certification</span><span class="o">.</span>
<span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">--</span><span class="n">sync</span><span class="o">-</span><span class="n">files</span>      <span class="n">Fetch</span> <span class="nb">any</span> <span class="n">missing</span> <span class="n">files</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">difference</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">CRDS</span> <span class="n">server</span><span class="o">.</span>
<span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">nominal</span> <span class="n">debug</span> <span class="n">level</span><span class="o">.</span>
<span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span> <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">level</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mf">100.</span>
<span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">readonly</span><span class="o">-</span><span class="n">cache</span>  <span class="n">Don</span><span class="s1">&#39;t modify the CRDS cache.  Not compatible with options which implicitly modify the cache.</span>
</pre></div>
</div>
</li>
<li><p class="first">crds.certify is normally invoked like e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">certify</span> <span class="o">--</span><span class="n">comparison</span><span class="o">-</span><span class="n">context</span><span class="o">=</span><span class="n">hst_0027</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">run</span><span class="o">-</span><span class="n">fitsverify</span> <span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">provenance</span> <span class="o">./</span><span class="n">some_reference</span><span class="o">.</span><span class="n">fits</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">certify</span> <span class="o">./</span><span class="n">hst_acs_darkfile_00250</span><span class="o">.</span><span class="n">rmap</span>
</pre></div>
</div>
</li>
<li><p class="first">To run crds.certify on a reference(s) to verify basic file format and parameter constraints:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">certify</span> <span class="o">--</span><span class="n">comparison</span><span class="o">-</span><span class="n">context</span><span class="o">=</span><span class="n">hst_0027</span><span class="o">.</span><span class="n">pmap</span>   <span class="o">./</span><span class="n">some_reference</span><span class="o">.</span><span class="n">fits</span><span class="o">...</span>
</pre></div>
</div>
<p>If some_reference.fits is a table,  a comparison table will be found in the comparison context, if appropriate.</p>
</li>
<li><p class="first">For recursively checking CRDS rules do this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">certify</span> <span class="n">hst_0311</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">comparison</span><span class="o">-</span><span class="n">context</span><span class="o">=</span><span class="n">hst_0312</span><span class="o">.</span><span class="n">pmap</span>
</pre></div>
</div>
<p>If a comparison context is defined, checked mappings will be compared against their peers (if they exist) in
the comparison context.  Many classes of mapping differences will result in warnings.</p>
</li>
<li><p class="first">For reference table checks,  a comparison reference can also be specified directly rather than inferred from context:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">certify</span> <span class="o">./</span><span class="n">some_reference</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="n">comparison</span><span class="o">-</span><span class="n">reference</span><span class="o">=</span><span class="n">old_reference_version</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="n">run</span><span class="o">-</span><span class="n">fitsverify</span> <span class="o">--</span><span class="n">dump</span><span class="o">-</span><span class="n">provenance</span>
</pre></div>
</div>
</li>
<li><p class="first">For more information on the checks being performed,  use –verbose or –verbosity=N where N &gt; 50.</p>
<p>% crds certify ./some_reference.fits –comparison-reference=old_reference_version.fits –run-fitsverify –dump-provenance –verbose</p>
</li>
<li><p class="first">Invoking crds.certify on a context mapping recursively certifies all sub-mappings.</p>
</li>
</ul>
</div>
<div class="section" id="crds-diff">
<h2>crds.diff<a class="headerlink" href="#crds-diff" title="Permalink to this headline">¶</a></h2>
<p>crds.diff compares two reference or mapping files and reports differences.  For
references crds.diff is currently a thin wrapper around fitsdiff but may expand.</p>
<p>For CRDS mappings crds.diff performs a recursive logical difference which shows
the full match path to each bottom level change.   crds.diff –help yields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Difference</span> <span class="n">CRDS</span> <span class="n">mapping</span> <span class="ow">or</span> <span class="n">reference</span> <span class="n">files</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">old_file</span>              <span class="n">Prior</span> <span class="n">file</span> <span class="n">of</span> <span class="n">difference</span><span class="o">.</span>
  <span class="n">new_file</span>              <span class="n">New</span> <span class="n">file</span> <span class="n">of</span> <span class="n">difference</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">P</span><span class="p">,</span> <span class="o">--</span><span class="n">primitive</span><span class="o">-</span><span class="n">diffs</span>
                        <span class="n">Fitsdiff</span> <span class="n">replaced</span> <span class="n">reference</span> <span class="n">files</span> <span class="n">when</span> <span class="n">diffing</span> <span class="n">mappings</span><span class="o">.</span>
  <span class="o">-</span><span class="n">T</span><span class="p">,</span> <span class="o">--</span><span class="n">mapping</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">diffs</span>
                        <span class="n">In</span> <span class="n">addition</span> <span class="n">to</span> <span class="n">CRDS</span> <span class="n">mapping</span> <span class="n">logical</span> <span class="n">differences</span><span class="p">,</span>  <span class="n">run</span> <span class="n">UNIX</span> <span class="n">context</span> <span class="n">diff</span> <span class="k">for</span> <span class="n">mappings</span><span class="o">.</span>
  <span class="o">-</span><span class="n">K</span><span class="p">,</span> <span class="o">--</span><span class="n">check</span><span class="o">-</span><span class="n">diffs</span>     <span class="n">Issue</span> <span class="n">warnings</span> <span class="n">about</span> <span class="n">new</span> <span class="n">rules</span><span class="p">,</span> <span class="n">deletions</span><span class="p">,</span> <span class="ow">or</span> <span class="n">reversions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">files</span>
                        <span class="n">Rather</span> <span class="n">than</span> <span class="n">printing</span> <span class="n">diffs</span> <span class="k">for</span> <span class="n">mappings</span><span class="p">,</span>  <span class="nb">print</span> <span class="n">the</span> <span class="n">names</span> <span class="n">of</span> <span class="n">new</span> <span class="ow">or</span> <span class="n">replacement</span> <span class="n">files</span><span class="o">.</span>  <span class="n">Excludes</span> <span class="n">intermediaries</span><span class="o">.</span>
  <span class="o">-</span><span class="n">A</span><span class="p">,</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">files</span>
                        <span class="n">Print</span> <span class="n">the</span> <span class="n">names</span> <span class="n">of</span> <span class="n">every</span> <span class="n">new</span> <span class="ow">or</span> <span class="n">replacement</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">diffs</span> <span class="n">between</span> <span class="n">old</span> <span class="ow">and</span> <span class="n">new</span><span class="o">.</span>  <span class="n">Includes</span> <span class="n">intermediaries</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">--</span><span class="n">include</span><span class="o">-</span><span class="n">header</span><span class="o">-</span><span class="n">diffs</span>
                        <span class="n">Include</span> <span class="n">mapping</span> <span class="n">header</span> <span class="n">differences</span> <span class="ow">in</span> <span class="n">logical</span> <span class="n">diffs</span><span class="p">:</span> <span class="n">sha1sum</span><span class="p">,</span> <span class="n">derived_from</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
  <span class="o">-</span><span class="n">B</span><span class="p">,</span> <span class="o">--</span><span class="n">hide</span><span class="o">-</span><span class="n">boring</span><span class="o">-</span><span class="n">diffs</span>
                        <span class="n">Include</span> <span class="n">mapping</span> <span class="n">header</span> <span class="n">differences</span> <span class="ow">in</span> <span class="n">logical</span> <span class="n">diffs</span><span class="p">:</span> <span class="n">sha1sum</span><span class="p">,</span> <span class="n">derived_from</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span><span class="o">-</span><span class="n">instruments</span>
                        <span class="n">Print</span> <span class="n">out</span> <span class="n">the</span> <span class="n">names</span> <span class="n">of</span> <span class="n">instruments</span> <span class="n">which</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">,</span>  <span class="n">rather</span> <span class="n">than</span> <span class="n">diffs</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span><span class="o">-</span><span class="n">types</span>
                        <span class="n">Print</span> <span class="n">out</span> <span class="n">the</span> <span class="n">names</span> <span class="n">of</span> <span class="n">instruments</span> <span class="ow">and</span> <span class="n">types</span> <span class="n">which</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">,</span>  <span class="n">rather</span> <span class="n">than</span> <span class="n">diffs</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">affected</span><span class="o">-</span><span class="n">modes</span>
                        <span class="n">Print</span> <span class="n">out</span> <span class="n">the</span> <span class="n">names</span> <span class="n">of</span> <span class="n">instruments</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="ow">and</span> <span class="n">matching</span> <span class="n">parameters</span><span class="p">,</span>  <span class="n">rather</span> <span class="n">than</span> <span class="n">diffs</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">nominal</span> <span class="n">debug</span> <span class="n">level</span><span class="o">.</span>
  <span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span>
                        <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">level</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mf">100.</span>
  <span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">readonly</span><span class="o">-</span><span class="n">cache</span>  <span class="n">Don</span><span class="s1">&#39;t modify the CRDS cache.  Not compatible with options which implicitly modify the cache.</span>
  <span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>         <span class="n">Print</span> <span class="n">the</span> <span class="n">software</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">exit</span><span class="o">.</span>
  <span class="o">-</span><span class="n">J</span><span class="p">,</span> <span class="o">--</span><span class="n">jwst</span>            <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">JWST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">H</span><span class="p">,</span> <span class="o">--</span><span class="n">hst</span>             <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">HST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>

<span class="n">Reference</span> <span class="n">files</span> <span class="n">are</span> <span class="n">nominally</span> <span class="n">differenced</span> <span class="n">using</span> <span class="n">FITS</span><span class="o">-</span><span class="n">diff</span> <span class="ow">or</span> <span class="n">diff</span><span class="o">.</span>

<span class="n">Mapping</span> <span class="n">files</span> <span class="n">are</span> <span class="n">differenced</span> <span class="n">using</span> <span class="n">CRDS</span> <span class="n">machinery</span> <span class="n">to</span> <span class="n">recursively</span> <span class="n">compare</span> <span class="n">too</span> <span class="n">mappings</span> <span class="ow">and</span>
<span class="n">their</span> <span class="n">sub</span><span class="o">-</span><span class="n">mappings</span><span class="o">.</span>

<span class="n">Differencing</span> <span class="n">two</span> <span class="n">mappings</span> <span class="n">will</span> <span class="n">find</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">logical</span> <span class="n">differences</span> <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">contexts</span>
<span class="ow">and</span> <span class="nb">any</span> <span class="n">nested</span> <span class="n">mappings</span><span class="o">.</span>

<span class="n">By</span> <span class="n">specifying</span> <span class="o">--</span><span class="n">mapping</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">diffs</span><span class="p">,</span>  <span class="n">UNIX</span> <span class="n">diff</span> <span class="n">will</span> <span class="n">be</span> <span class="n">run</span> <span class="n">on</span> <span class="n">mapping</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">addition</span> <span class="n">to</span>
<span class="n">CRDS</span> <span class="n">logical</span> <span class="n">diffs</span><span class="o">.</span>

<span class="n">By</span> <span class="n">specifying</span> <span class="o">--</span><span class="n">primitive</span><span class="o">-</span><span class="n">diffs</span><span class="p">,</span>  <span class="n">FITS</span> <span class="n">diff</span> <span class="n">will</span> <span class="n">be</span> <span class="n">run</span> <span class="n">on</span> <span class="nb">all</span> <span class="n">references</span> <span class="n">which</span> <span class="n">are</span> <span class="n">replaced</span>
<span class="ow">in</span> <span class="n">the</span> <span class="n">logical</span> <span class="n">differences</span> <span class="n">between</span> <span class="n">two</span> <span class="n">mappings</span><span class="o">.</span>

<span class="n">For</span> <span class="n">example</span><span class="p">:</span>

    <span class="o">%</span> <span class="n">crds</span> <span class="n">diff</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span>  <span class="n">hst_0005</span><span class="o">.</span><span class="n">pmap</span>  <span class="o">--</span><span class="n">mapping</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">diffs</span> <span class="o">--</span><span class="n">primitive</span><span class="o">-</span><span class="n">diffs</span>

<span class="n">Will</span> <span class="n">recursively</span> <span class="n">produce</span> <span class="n">logical</span><span class="p">,</span> <span class="n">textual</span><span class="p">,</span> <span class="ow">and</span> <span class="n">FITS</span> <span class="n">diffs</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">changes</span> <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">contexts</span><span class="o">.</span>

    <span class="n">NOTE</span><span class="p">:</span> <span class="n">mapping</span> <span class="n">logical</span> <span class="n">differences</span> <span class="p">(</span><span class="n">the</span> <span class="n">default</span><span class="p">)</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">compare</span> <span class="n">CRDS</span> <span class="n">mapping</span> <span class="n">headers</span><span class="p">,</span>  <span class="n">use</span>
    <span class="o">--</span><span class="n">include</span><span class="o">-</span><span class="n">header</span><span class="o">-</span><span class="n">diffs</span> <span class="n">to</span> <span class="n">get</span> <span class="n">those</span> <span class="k">as</span> <span class="n">well</span><span class="o">.</span>
</pre></div>
</div>
<p>For standard CRDS filenames,  crds.diff can guess the observatory.   For
non-standard names,  the observatory needs to be specified.  crds.diff can be
invoked like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">diff</span>   <span class="o">./</span><span class="n">jwst_nircam_dark_0010</span><span class="o">.</span><span class="n">fits</span>  <span class="o">./</span><span class="n">jwst_nircam_dark_0011</span><span class="o">.</span><span class="n">fits</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">diff</span>  <span class="n">jwst_0001</span><span class="o">.</span><span class="n">pmap</span>   <span class="n">jwst_0002</span><span class="o">.</span><span class="n">pmap</span>
<span class="p">((</span><span class="s1">&#39;hst.pmap&#39;</span><span class="p">,</span> <span class="s1">&#39;hst_0004.pmap&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;hst_acs.imap&#39;</span><span class="p">,</span> <span class="s1">&#39;hst_acs_0004.imap&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;hst_acs_darkfile.rmap&#39;</span><span class="p">,</span> <span class="s1">&#39;hst_acs_darkfile_0003.rmap&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;WFC&#39;</span><span class="p">,</span> <span class="s1">&#39;A|ABCD|AD|B|BC|C|D&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5|1.0|1.4|2.0&#39;</span><span class="p">),</span> <span class="s1">&#39;2011-03-16 23:34:35&#39;</span><span class="p">,</span> <span class="s2">&quot;replaced &#39;v441434ej_drk.fits&#39; with &#39;hst_acs_darkfile_0003.fits&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="crds-rowdiff">
<h2>crds.rowdiff<a class="headerlink" href="#crds-rowdiff" title="Permalink to this headline">¶</a></h2>
<p>Modules that are based on FITSDiff, such as crds.diff, compare
tabular data on a column-by-column basis. Rowdiff compares tabular data
on a row-by-row basis, producing UNIX diff-like output instead.
Non-tabular extensions are ignored.</p>
<blockquote>
<div><dl class="docutils">
<dt>usage: rowdiff.py [-J] [-H]</dt>
<dd>[–ignore-fields IGNORE_FIELDS]
[–fields FIELDS]
[–mode-fields MODE_FIELDS] old_file new_file</dd>
</dl>
<p>Perform FITS table difference by rows</p>
<dl class="docutils">
<dt>positional arguments:</dt>
<dd>old_file                First FITS table to compare
new_file                Second FITS table to compare</dd>
<dt>optional arguments:</dt>
<dd><table class="first last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--ignore-fields <var>IGNORE_FIELDS</var></span></kbd></td>
</tr>
<tr><td>&#160;</td><td>List of fields to ignore</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--fields <var>FIELDS</var></span></kbd></td>
</tr>
<tr><td>&#160;</td><td>List of fields to compare</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--mode-fields <var>MODE_FIELDS</var></span></kbd></td>
</tr>
<tr><td>&#160;</td><td>List of fields to do a mode compare</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-J</span>, <span class="option">--jwst</span></kbd></td>
<td>Force observatory to JWST for determining header conventions.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-H</span>, <span class="option">--hst</span></kbd></td>
<td>Force observatory to HST for determining header conventions.</td></tr>
</tbody>
</table>
</dd>
</dl>
</div></blockquote>
<p>The FITS data to be compared are required to be similar: they must have
the same number of extensions and the types of extensions must match.</p>
<p>The parameters –fields and –ignore-fields define which columns
are compared between each table extension. These are mutually
exclusive parameters and an error will generate if both are specified.</p>
<p>First a summary of the changes between the table extension is given.
Then, row-by-row difference is given, using unified diff syntax.</p>
<p>The parameter –mode-fields initiates a different algorithm.
Here, it is presumed the tabular data contains columns that can essentially
be treated as keys upon with rows are selected. The fields specified are those
key columns.</p>
<p>All possible coombinations of values are determined be examining both
extensions. Then, each table is compared against both this list and between
each other, looking for multiply specified combinations, missing combinations,
and, for the common combinations between the tables, whether the rest of the
rows are equivalent or not.</p>
<p>Examples:</p>
<blockquote>
<div><p>% crds rowdiff s9m1329lu_off.fits s9518396u_off.fits</p>
<p>% crds rowdiff s9m1329lu_off.fits s9518396u_off.fits –mode-fields=detchip,obsdate</p>
</div></blockquote>
</div>
<div class="section" id="crds-uses">
<h2>crds.uses<a class="headerlink" href="#crds-uses" title="Permalink to this headline">¶</a></h2>
<p>crds.uses searches the files in the local cache for mappings which refer to the
specified files.  Since the <strong>local cache</strong> is used only mappings present in the
local cache will be included in the results given.  crds.uses is invoked as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">uses</span> <span class="o">&lt;</span><span class="n">observatory</span><span class="o">=</span><span class="n">hst</span><span class="o">|</span><span class="n">jwst</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">mapping</span> <span class="ow">or</span> <span class="n">reference</span><span class="o">&gt;...</span>
</pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Prints</span> <span class="n">out</span> <span class="n">the</span> <span class="n">mappings</span> <span class="n">which</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">mappings</span> <span class="ow">or</span> <span class="n">references</span><span class="o">.</span>

<span class="n">Prints</span> <span class="n">out</span> <span class="n">the</span> <span class="n">datasets</span> <span class="n">which</span> <span class="n">historically</span> <span class="n">used</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">reference</span> <span class="k">as</span> <span class="n">defined</span> <span class="n">by</span> <span class="n">DADSOPS</span><span class="o">.</span>

<span class="n">IMPORTANT</span><span class="p">:</span>
   <span class="mf">1.</span> <span class="n">You</span> <span class="n">must</span> <span class="n">specify</span> <span class="n">references</span> <span class="n">on</span> <span class="n">which</span> <span class="n">to</span> <span class="n">operate</span> <span class="k">with</span> <span class="o">--</span><span class="n">files</span><span class="o">.</span>
   <span class="mf">2.</span> <span class="n">You</span> <span class="n">must</span> <span class="nb">set</span> <span class="n">CRDS_PATH</span> <span class="ow">and</span> <span class="n">CRDS_SERVER_URL</span> <span class="n">to</span> <span class="n">give</span> <span class="n">crds</span><span class="o">.</span><span class="n">uses</span> <span class="n">access</span> <span class="n">to</span> <span class="n">CRDS</span> <span class="n">mappings</span> <span class="ow">and</span> <span class="n">databases</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">files</span> <span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">References</span> <span class="k">for</span> <span class="n">which</span> <span class="n">to</span> <span class="n">dump</span> <span class="n">using</span> <span class="n">mappings</span> <span class="ow">or</span> <span class="n">datasets</span><span class="o">.</span>
  <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">datasets</span>  <span class="n">Print</span> <span class="n">the</span> <span class="n">ids</span> <span class="n">of</span> <span class="n">datasets</span> <span class="n">last</span> <span class="n">historically</span> <span class="n">using</span> <span class="n">a</span> <span class="n">reference</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">--</span><span class="n">include</span><span class="o">-</span><span class="n">used</span>    <span class="n">Include</span> <span class="n">the</span> <span class="n">used</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">output</span> <span class="k">as</span> <span class="n">the</span> <span class="n">first</span> <span class="n">column</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">nominal</span> <span class="n">debug</span> <span class="n">level</span><span class="o">.</span>
  <span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span>
                        <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">level</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mf">100.</span>
  <span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">readonly</span><span class="o">-</span><span class="n">cache</span>  <span class="n">Don</span><span class="s1">&#39;t modify the CRDS cache.  Not compatible with options which implicitly modify the cache.</span>
  <span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>         <span class="n">Print</span> <span class="n">the</span> <span class="n">software</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">exit</span><span class="o">.</span>
  <span class="o">-</span><span class="n">J</span><span class="p">,</span> <span class="o">--</span><span class="n">jwst</span>            <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">JWST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">H</span><span class="p">,</span> <span class="o">--</span><span class="n">hst</span>             <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">HST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>

<span class="n">crds</span><span class="o">.</span><span class="n">uses</span> <span class="n">can</span> <span class="n">be</span> <span class="n">invoked</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">uses</span> <span class="o">--</span><span class="n">files</span> <span class="n">n3o1022ij_drk</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="n">hst</span>
<span class="n">hst</span><span class="o">.</span><span class="n">pmap</span>
<span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span>
<span class="n">hst_0002</span><span class="o">.</span><span class="n">pmap</span>
<span class="n">hst_0003</span><span class="o">.</span><span class="n">pmap</span>
<span class="o">...</span>
<span class="n">hst_0041</span><span class="o">.</span><span class="n">pmap</span>
<span class="n">hst_acs</span><span class="o">.</span><span class="n">imap</span>
<span class="n">hst_acs_0001</span><span class="o">.</span><span class="n">imap</span>
<span class="n">hst_acs_0002</span><span class="o">.</span><span class="n">imap</span>
<span class="n">hst_acs_0003</span><span class="o">.</span><span class="n">imap</span>
<span class="o">...</span>
<span class="n">hst_acs_0008</span><span class="o">.</span><span class="n">imap</span>
<span class="n">hst_acs_darkfile</span><span class="o">.</span><span class="n">rmap</span>
<span class="n">hst_acs_darkfile_0001</span><span class="o">.</span><span class="n">rmap</span>
<span class="n">hst_acs_darkfile_0002</span><span class="o">.</span><span class="n">rmap</span>
<span class="n">hst_acs_darkfile_0003</span><span class="o">.</span><span class="n">rmap</span>
<span class="o">...</span>
<span class="n">hst_acs_darkfile_0005</span><span class="o">.</span><span class="n">rmap</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">uses</span> <span class="o">--</span><span class="n">files</span> <span class="n">n3o1022ij_drk</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">datasets</span> <span class="o">--</span><span class="n">hst</span>
<span class="n">J8BA0HRPQ</span>
<span class="n">J8BA0IRTQ</span>
<span class="n">J8BA0JRWQ</span>
<span class="n">J8BA0KT4Q</span>
<span class="n">J8BA0LIJQ</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">uses</span> <span class="o">--</span><span class="n">files</span> <span class="nd">@dropped</span> <span class="o">--</span><span class="n">hst</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">datasets</span> <span class="o">--</span><span class="n">include</span><span class="o">-</span><span class="n">used</span>
<span class="n">vb41934lj_bia</span><span class="o">.</span><span class="n">fits</span> <span class="n">JA7P21A2Q</span>
<span class="n">vb41934lj_bia</span><span class="o">.</span><span class="n">fits</span> <span class="n">JA7P21A4Q</span>
<span class="n">vb41934lj_bia</span><span class="o">.</span><span class="n">fits</span> <span class="n">JA7P21A6Q</span>
</pre></div>
</div>
</div>
<div class="section" id="crds-matches">
<h2>crds.matches<a class="headerlink" href="#crds-matches" title="Permalink to this headline">¶</a></h2>
<p>crds.matches reports the match patterns which are associated with the given
reference files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">matches</span><span class="o">.</span><span class="n">py</span>
       <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">contexts</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="o">...</span><span class="p">]]]</span>
       <span class="p">[</span><span class="o">--</span><span class="n">files</span> <span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">]]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span>

<span class="n">Prints</span> <span class="n">out</span> <span class="n">the</span> <span class="n">selection</span> <span class="n">criteria</span> <span class="n">by</span> <span class="n">which</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">references</span> <span class="n">are</span> <span class="n">matched</span>
<span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">context</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">contexts</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="p">[</span><span class="n">CONTEXT</span> <span class="o">...</span><span class="p">]]</span>
                        <span class="n">Specify</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">CRDS</span> <span class="n">mappings</span> <span class="n">to</span> <span class="n">operate</span> <span class="n">on</span><span class="p">:</span> <span class="o">.</span><span class="n">pmap</span><span class="p">,</span> <span class="o">.</span><span class="n">imap</span><span class="p">,</span> <span class="ow">or</span> <span class="o">.</span><span class="n">rmap</span> <span class="ow">or</span> <span class="n">date</span><span class="o">-</span><span class="n">based</span> <span class="n">specification</span>
  <span class="o">--</span><span class="nb">range</span> <span class="n">MIN</span><span class="p">:</span><span class="n">MAX</span>       <span class="n">Operate</span> <span class="k">for</span> <span class="n">pipeline</span> <span class="n">context</span> <span class="n">ids</span> <span class="p">(</span><span class="o">.</span><span class="n">pmaps</span><span class="p">)</span> <span class="n">between</span> <span class="o">&lt;</span><span class="n">MIN</span><span class="o">&gt;</span> <span class="ow">and</span> <span class="o">&lt;</span><span class="n">MAX</span><span class="o">&gt;.</span>
  <span class="o">--</span><span class="nb">all</span>                 <span class="n">Operate</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">known</span> <span class="n">CRDS</span> <span class="n">contexts</span><span class="o">.</span>
  <span class="o">--</span><span class="n">last</span> <span class="n">N</span>              <span class="n">Operate</span> <span class="k">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">the</span> <span class="n">last</span> <span class="n">N</span> <span class="n">contexts</span><span class="o">.</span>
  <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">cache</span>    <span class="n">Download</span> <span class="n">required</span> <span class="n">files</span> <span class="n">even</span> <span class="k">if</span> <span class="n">they</span><span class="s1">&#39;re already in the cache.</span>
  <span class="o">--</span><span class="n">files</span> <span class="n">FILES</span> <span class="p">[</span><span class="n">FILES</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">References</span> <span class="k">for</span> <span class="n">which</span> <span class="n">to</span> <span class="n">dump</span> <span class="n">selection</span> <span class="n">criteria</span><span class="o">.</span>
  <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">--</span><span class="n">brief</span><span class="o">-</span><span class="n">paths</span>     <span class="n">Don</span><span class="s1">&#39;t the instrument and filekind.</span>
  <span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="o">--</span><span class="n">omit</span><span class="o">-</span><span class="n">parameter</span><span class="o">-</span><span class="n">names</span>
                        <span class="n">Hide</span> <span class="n">the</span> <span class="n">parameter</span> <span class="n">names</span> <span class="n">of</span> <span class="n">the</span> <span class="n">selection</span> <span class="n">criteria</span><span class="p">,</span>  <span class="n">just</span> <span class="n">show</span> <span class="n">the</span> <span class="n">values</span><span class="o">.</span>
  <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="nb">tuple</span><span class="o">-</span><span class="nb">format</span>    <span class="n">Print</span> <span class="n">the</span> <span class="n">match</span> <span class="n">info</span> <span class="k">as</span> <span class="n">Python</span> <span class="n">tuples</span><span class="o">.</span>
  <span class="o">-</span><span class="n">d</span> <span class="n">DATASETS</span> <span class="p">[</span><span class="n">DATASETS</span> <span class="o">...</span><span class="p">],</span> <span class="o">--</span><span class="n">datasets</span> <span class="n">DATASETS</span> <span class="p">[</span><span class="n">DATASETS</span> <span class="o">...</span><span class="p">]</span>
                        <span class="n">Dataset</span> <span class="n">ids</span> <span class="k">for</span> <span class="n">which</span> <span class="n">to</span> <span class="n">dump</span> <span class="n">matching</span> <span class="n">parameters</span> <span class="kn">from</span> <span class="nn">DADSOPS</span> <span class="ow">or</span> <span class="n">equivalent</span> <span class="n">database</span><span class="o">.</span>
  <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">--</span><span class="n">condition</span><span class="o">-</span><span class="n">values</span>
                        <span class="n">When</span> <span class="n">dumping</span> <span class="n">dataset</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">first</span> <span class="n">apply</span> <span class="n">CRDS</span> <span class="n">value</span> <span class="n">conditioning</span> <span class="o">/</span> <span class="n">normalization</span><span class="o">.</span>
  <span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">--</span><span class="n">minimize</span><span class="o">-</span><span class="n">header</span>
                        <span class="n">When</span> <span class="n">dumping</span> <span class="n">dataset</span> <span class="n">parameters</span><span class="p">,</span>  <span class="n">limit</span> <span class="n">them</span> <span class="n">to</span> <span class="n">matching</span> <span class="n">parameters</span><span class="p">,</span> <span class="ow">not</span> <span class="n">historical</span> <span class="n">bestrefs</span><span class="o">.</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="kc">True</span><span class="p">,</span>  <span class="n">nominal</span> <span class="n">debug</span> <span class="n">level</span><span class="o">.</span>
  <span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span>
                        <span class="n">Set</span> <span class="n">log</span> <span class="n">verbosity</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">level</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mf">100.</span>
  <span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">readonly</span><span class="o">-</span><span class="n">cache</span>  <span class="n">Don</span><span class="s1">&#39;t modify the CRDS cache.  Not compatible with options which implicitly modify the cache.</span>
  <span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>         <span class="n">Print</span> <span class="n">the</span> <span class="n">software</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">exit</span><span class="o">.</span>
  <span class="o">-</span><span class="n">J</span><span class="p">,</span> <span class="o">--</span><span class="n">jwst</span>            <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">JWST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
  <span class="o">-</span><span class="n">H</span><span class="p">,</span> <span class="o">--</span><span class="n">hst</span>             <span class="n">Force</span> <span class="n">observatory</span> <span class="n">to</span> <span class="n">HST</span> <span class="k">for</span> <span class="n">determining</span> <span class="n">header</span> <span class="n">conventions</span><span class="o">.</span>
</pre></div>
</div>
<p>crds.matches can dump reference file match cases with respect to particular contexts:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">matches</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span>
<span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="p">:</span> <span class="n">ACS</span> <span class="n">PFLTFILE</span> <span class="n">DETECTOR</span><span class="o">=</span><span class="s1">&#39;WFC&#39;</span> <span class="n">CCDAMP</span><span class="o">=</span><span class="s1">&#39;A|ABCD|AC|AD|B|BC|BD|C|D&#39;</span> <span class="n">FILTER1</span><span class="o">=</span><span class="s1">&#39;F625W&#39;</span> <span class="n">FILTER2</span><span class="o">=</span><span class="s1">&#39;POL0V&#39;</span> <span class="n">DATE</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;1997-01-01&#39;</span> <span class="n">TIME</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;00:00:00&#39;</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">matches</span> <span class="o">--</span><span class="n">contexts</span> <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="n">omit</span><span class="o">-</span><span class="n">parameter</span><span class="o">-</span><span class="n">names</span> <span class="o">--</span><span class="n">brief</span><span class="o">-</span><span class="n">paths</span>
<span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="p">:</span>  <span class="s1">&#39;WFC&#39;</span> <span class="s1">&#39;A|ABCD|AC|AD|B|BC|BD|C|D&#39;</span> <span class="s1">&#39;F625W&#39;</span> <span class="s1">&#39;POL0V&#39;</span> <span class="s1">&#39;1997-01-01&#39;</span> <span class="s1">&#39;00:00:00&#39;</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">matches</span> <span class="o">--</span><span class="n">contexts</span> <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="nb">tuple</span><span class="o">-</span><span class="nb">format</span>
<span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="p">:</span> <span class="p">((</span><span class="s1">&#39;OBSERVATORY&#39;</span><span class="p">,</span> <span class="s1">&#39;HST&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;INSTRUMENT&#39;</span><span class="p">,</span> <span class="s1">&#39;ACS&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;FILEKIND&#39;</span><span class="p">,</span> <span class="s1">&#39;PFLTFILE&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;DETECTOR&#39;</span><span class="p">,</span> <span class="s1">&#39;WFC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CCDAMP&#39;</span><span class="p">,</span> <span class="s1">&#39;A|ABCD|AC|AD|B|BC|BD|C|D&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;FILTER1&#39;</span><span class="p">,</span> <span class="s1">&#39;F625W&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;FILTER2&#39;</span><span class="p">,</span> <span class="s1">&#39;POL0V&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;1997-01-01&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;00:00:00&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>crds.matches can dump database matching parameters for specified datasets with respect to specified contexts:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">matches</span> <span class="o">--</span><span class="n">datasets</span> <span class="n">JBANJOF3Q</span> <span class="o">--</span><span class="n">minimize</span><span class="o">-</span><span class="n">headers</span> <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0048</span><span class="o">.</span><span class="n">pmap</span> <span class="n">hst_0044</span><span class="o">.</span><span class="n">pmap</span>
<span class="n">JBANJOF3Q</span> <span class="p">:</span> <span class="n">hst_0044</span><span class="o">.</span><span class="n">pmap</span> <span class="p">:</span> <span class="n">APERTURE</span><span class="o">=</span><span class="s1">&#39;WFC1-2K&#39;</span> <span class="n">ATODCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">BIASCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">CCDAMP</span><span class="o">=</span><span class="s1">&#39;B&#39;</span> <span class="n">CCDCHIP</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span> <span class="n">CCDGAIN</span><span class="o">=</span><span class="s1">&#39;2.0&#39;</span> <span class="n">CRCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">DARKCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">DATE</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;2010-01-31&#39;</span> <span class="n">DETECTOR</span><span class="o">=</span><span class="s1">&#39;WFC&#39;</span> <span class="n">DQICORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">DRIZCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">FILTER1</span><span class="o">=</span><span class="s1">&#39;F502N&#39;</span> <span class="n">FILTER2</span><span class="o">=</span><span class="s1">&#39;F660N&#39;</span> <span class="n">FLASHCUR</span><span class="o">=</span><span class="s1">&#39;OFF&#39;</span> <span class="n">FLATCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">FLSHCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">FW1OFFST</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span> <span class="n">FW2OFFST</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span> <span class="n">FWSOFFST</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span> <span class="n">GLINCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">INSTRUME</span><span class="o">=</span><span class="s1">&#39;ACS&#39;</span> <span class="n">LTV1</span><span class="o">=</span><span class="s1">&#39;-2048.0&#39;</span> <span class="n">LTV2</span><span class="o">=</span><span class="s1">&#39;-1.0&#39;</span> <span class="n">NUMCOLS</span><span class="o">=</span><span class="s1">&#39;UNDEFINED&#39;</span> <span class="n">NUMROWS</span><span class="o">=</span><span class="s1">&#39;UNDEFINED&#39;</span> <span class="n">OBSTYPE</span><span class="o">=</span><span class="s1">&#39;INTERNAL&#39;</span> <span class="n">PCTECORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">PHOTCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">REFTYPE</span><span class="o">=</span><span class="s1">&#39;UNDEFINED&#39;</span> <span class="n">SHADCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">SHUTRPOS</span><span class="o">=</span><span class="s1">&#39;B&#39;</span> <span class="n">TIME</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;01:07:14.960000&#39;</span> <span class="n">XCORNER</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span> <span class="n">YCORNER</span><span class="o">=</span><span class="s1">&#39;2072.0&#39;</span>
<span class="n">JBANJOF3Q</span> <span class="p">:</span> <span class="n">hst_0048</span><span class="o">.</span><span class="n">pmap</span> <span class="p">:</span> <span class="n">APERTURE</span><span class="o">=</span><span class="s1">&#39;WFC1-2K&#39;</span> <span class="n">ATODCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">BIASCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">CCDAMP</span><span class="o">=</span><span class="s1">&#39;B&#39;</span> <span class="n">CCDCHIP</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span> <span class="n">CCDGAIN</span><span class="o">=</span><span class="s1">&#39;2.0&#39;</span> <span class="n">CRCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">DARKCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">DATE</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;2010-01-31&#39;</span> <span class="n">DETECTOR</span><span class="o">=</span><span class="s1">&#39;WFC&#39;</span> <span class="n">DQICORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">DRIZCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">FILTER1</span><span class="o">=</span><span class="s1">&#39;F502N&#39;</span> <span class="n">FILTER2</span><span class="o">=</span><span class="s1">&#39;F660N&#39;</span> <span class="n">FLASHCUR</span><span class="o">=</span><span class="s1">&#39;OFF&#39;</span> <span class="n">FLATCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">FLSHCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">FW1OFFST</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span> <span class="n">FW2OFFST</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span> <span class="n">FWSOFFST</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span> <span class="n">GLINCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">INSTRUME</span><span class="o">=</span><span class="s1">&#39;ACS&#39;</span> <span class="n">LTV1</span><span class="o">=</span><span class="s1">&#39;-2048.0&#39;</span> <span class="n">LTV2</span><span class="o">=</span><span class="s1">&#39;-1.0&#39;</span> <span class="n">NAXIS1</span><span class="o">=</span><span class="s1">&#39;2070.0&#39;</span> <span class="n">NAXIS2</span><span class="o">=</span><span class="s1">&#39;2046.0&#39;</span> <span class="n">OBSTYPE</span><span class="o">=</span><span class="s1">&#39;INTERNAL&#39;</span> <span class="n">PCTECORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">PHOTCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">REFTYPE</span><span class="o">=</span><span class="s1">&#39;UNDEFINED&#39;</span> <span class="n">SHADCORR</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span> <span class="n">SHUTRPOS</span><span class="o">=</span><span class="s1">&#39;B&#39;</span> <span class="n">TIME</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;01:07:14.960000&#39;</span> <span class="n">XCORNER</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span> <span class="n">YCORNER</span><span class="o">=</span><span class="s1">&#39;2072.0&#39;</span>
</pre></div>
</div>
<p>crds.matches can be invoked in various ways with different output formatting:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">crds</span> <span class="n">matches</span>  <span class="o">--</span><span class="n">contexts</span> <span class="n">hst_0001</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span>
<span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="p">:</span> <span class="n">ACS</span> <span class="n">PFLTFILE</span> <span class="n">DETECTOR</span><span class="o">=</span><span class="s1">&#39;WFC&#39;</span> <span class="n">CCDAMP</span><span class="o">=</span><span class="s1">&#39;A|ABCD|AC|AD|B|BC|BD|C|D&#39;</span> <span class="n">FILTER1</span><span class="o">=</span><span class="s1">&#39;F625W&#39;</span> <span class="n">FILTER2</span><span class="o">=</span><span class="s1">&#39;POL0V&#39;</span> <span class="n">DATE</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;1997-01-01&#39;</span> <span class="n">TIME</span><span class="o">-</span><span class="n">OBS</span><span class="o">=</span><span class="s1">&#39;00:00:00&#39;</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">matches</span> <span class="o">--</span><span class="n">contexts</span> <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="n">omit</span><span class="o">-</span><span class="n">parameter</span><span class="o">-</span><span class="n">names</span> <span class="o">--</span><span class="n">brief</span><span class="o">-</span><span class="n">paths</span>
<span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="p">:</span>  <span class="s1">&#39;WFC&#39;</span> <span class="s1">&#39;A|ABCD|AC|AD|B|BC|BD|C|D&#39;</span> <span class="s1">&#39;F625W&#39;</span> <span class="s1">&#39;POL0V&#39;</span> <span class="s1">&#39;1997-01-01&#39;</span> <span class="s1">&#39;00:00:00&#39;</span>

<span class="o">%</span> <span class="n">crds</span> <span class="n">matches</span> <span class="o">--</span><span class="n">contexts</span> <span class="n">hst</span><span class="o">.</span><span class="n">pmap</span> <span class="o">--</span><span class="n">files</span> <span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="o">--</span><span class="nb">tuple</span><span class="o">-</span><span class="nb">format</span>
<span class="n">lc41311jj_pfl</span><span class="o">.</span><span class="n">fits</span> <span class="p">:</span> <span class="p">((</span><span class="s1">&#39;OBSERVATORY&#39;</span><span class="p">,</span> <span class="s1">&#39;HST&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;INSTRUMENT&#39;</span><span class="p">,</span> <span class="s1">&#39;ACS&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;FILEKIND&#39;</span><span class="p">,</span> <span class="s1">&#39;PFLTFILE&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;DETECTOR&#39;</span><span class="p">,</span> <span class="s1">&#39;WFC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CCDAMP&#39;</span><span class="p">,</span> <span class="s1">&#39;A|ABCD|AC|AD|B|BC|BD|C|D&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;FILTER1&#39;</span><span class="p">,</span> <span class="s1">&#39;F625W&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;FILTER2&#39;</span><span class="p">,</span> <span class="s1">&#39;POL0V&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;1997-01-01&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">,</span> <span class="s1">&#39;00:00:00&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="safe-bestrefs">
<h2>safe_bestrefs<a class="headerlink" href="#safe-bestrefs" title="Permalink to this headline">¶</a></h2>
<p>The <em>safe_bestrefs</em> script is a shim around <em>crds bestrefs</em> which configures it for operation in
the pipeline using a readonly cache and no connection to the server.  Typical usage might be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ export CRDS_PATH=&lt;pipeline&#39;s CRDS cache path&gt;
$ safe_bestrefs --files &lt;datasets FITS files...&gt;
</pre></div>
</div>
<p>This script is intended to be run in parallel with multiple pipeline bestrefs
and a concurrent cron_sync.  The “safe” aspect refers to not modifying the
CRDS cache itself, and to not stumbling into inconsistent cache states while
another process is updating the cache.</p>
<p>To control when information is received from the server,  and to prevent pipeline stalls
when the CRDS server is unavailable, safe_bestrefs is configured with a bad server IP address.</p>
<p>Using a readonly CRDS cache enables the use of bestrefs in a multiprocessing environment
where multiple copies of bestrefs are running simultaneously.</p>
<p>Configuring bestrefs to run with no connection to the CRDS server makes it impossible for bestrefs
to do file downloads and keeps the pipeline independent of the server during routine operations.
See <em>cron_sync</em> for more info on updating the CRDS cache in pipeline environments.</p>
</div>
<div class="section" id="cron-sync">
<h2>cron_sync<a class="headerlink" href="#cron-sync" title="Permalink to this headline">¶</a></h2>
<p>The <em>cron_sync</em> script is a wrapper around the <em>crds sync</em> tool that tunes it for updating the CRDS
cache in a highly concurrent environment where bestrefs may be running during the cache update.</p>
<p><em>cron_sync</em> uses file locks to prevent more than one copy of itself from running at the
same time, particularly if run periodically as a cron job which may take longer than the period
to fully download file updates.</p>
<p>Typical setup and execution is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ export CRDS_PATH=&lt;pipeline&#39;s CRDS cache path&gt;
$ export CRDS_SERVER_URL=&lt;project&#39;s CRDS server&gt;
$ export CRDS_LOCKS=&lt;directory for cron_sync lock files, defaults to $CRDS_PATH&gt;
$ cron_sync --all --check-files --fetch-references
</pre></div>
</div>
<p><em>cron_sync</em> co-exists with an operating copy of <em>safe_bestrefs</em> by writing out the cache configuration
information last.   The cache configuration information controls the context switch.  While files
corresponding to the new context are downloading,  the cache remains safe and continues to operate
under the old context.</p>
<p>The HST and JWST pipeline environments currently further wrap the <em>cron_sync</em> script to establish
the environment settings and required Python stack and eliminate all parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ crds_sync_wrapper.csh
</pre></div>
</div>
<p>Operators typically execute <em>crds_sync_wrapper.csh</em> rather than <em>cron_sync</em>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="web_site_use.html" class="btn btn-neutral float-right" title="Using the CRDS Web Site" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral" title="Overview" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Space Telescope Science Institute.
      Last updated on Nov 28, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'7.1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>